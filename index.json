[{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXUA08QF48，且查阅PXUA08QF48_硬件使用 已查阅了XU208-128-QF48-C10(后续简称XU208)的datasheet和参考设计 已确认PXUA08QF48 USB Audio方案性能可满足导入项目产品中  XU208 datasheet 导读 查看XU208-128-QF48-Datasheet_1.15，其描述的为XU208裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（0 °C to 70 °C） QFN-48 封装 170mA(3.3V \u0026amp; 1.0V)典型工作电流，500mW左右（固件运行） I/O 驱动能力为4mA 订购型号：XU208-128-QF48-C10； 丝印：U30870C10  电源 根据datasheet的最小系统框图，XU208的需要两路电压供应，3V3和1V0, 其中3V3提供给I/O, USB , Flash等外设使用，1V0提供给XU208逻辑核心使用。\n其两路电压时序要求为3V3先上电，稳定后，1V0后上电。\n复位检测 XU208需要外部有复位检测芯片，可以选择单独侦测 3V3或者1V0，以避免在电压不正常时，芯片无法复位来运行固件。\nFlash XU208需要外置 Flash（SPI Flash或者QSPI Flash,类似MX25l4006e或者GD25Q16C，PXUA08QF48评估板使用的是SPI Flash），其主要是存储固件，所以项目得预先烧录固件方能使用。\n   类型 管脚定义 传输速度     SPI Flash SCLK, CS, IO0, IO1, WP, HOLD 240Mbits/s   QSPI Flash SCLK, CS, IO0, IO1, IO2, IO3 480Mbits/s     PXUA08QF48使用的是SPI连接方式，推荐客户优先使用SPI Flash   使用QSPI Flash烧录器烧录需要配置QE=1，并且勾选写入配置进行烧录。以IS25LP016D型号FLASH为例，其QSPI烧录步骤如下截图：（区分于SPI Flash,SPI Flash不需要勾选写入配置，即截图步骤5勾选为空）\n I/O 映射 XU208的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子或者XMOS官方提供的的原理来选择使用特定的I/O map。\nXU208芯片DATASHEET对I/O有详细说明。\n其中9个1bit口包括1A~1D,1L~1P。\n4bit口包括4B，4C,4D,4E以及4F口。\n8bit口包括8D0~8D7，其中8D0~8D3与1bit口复用。\nIO类型可通过XU208软件编程定义，用户无需过多研究。\n时钟信号 XU208外部需要24MHz有源晶振接入作为启动晶振，接入到CLK 引脚，而音频时钟44.1KHz 和48KHz采样率及其倍频采样率仍需要一个外部的45.1584MHz、48.152MHz音频时钟晶体接入作为音频主时钟使用。\n原理图和PCB 根据我司或者XMOS官方的提供的参考原理，结合XU208的datasheet最小系统。用户可以比较轻易完成XU208的最小系统设计，包含了电源，时钟，FLASH，JTAG等。\n原理图设计 下图为PXUA08QF48的原理框图：\n从框图之中，可以简单列举为几个模块：usb接口、电源、复位电路，FLASH、时钟、JTAG以及其他通讯接口。下面进行简述。\nusb与电源设计 这里usb与电源合并一起讲，是因为XMOS有两种电源输入方式选择，对应的电路也略有不同。XMOS系统需要3.3V和1V电源提供，这两组电源可分为USB内部供电和外部电源供电。\n USB内部供电：XMOS系统需要3.3V和1V电源是由USB 的5V电源VBUS分压得到，整个XMOS系统的供电来源都由USB; 外部电源供电：即XMOS所需的两组电源由外部系统分压过来，而非USB。  注意：USB一般电流的设计额定限度是500mA，超过该限额设备将无法正常枚举通讯，所以在设计时需要注意使用USB VBUS给系统其他模块供电是否会超过限额，如果超过该限额，建议系统其他模块使用外置电源。\rXU208-128-QF48 Datasheet供电方式有如下框图说明：\n其中3V3提供给XU208及其集成的部分的 I/O供电，1V0供应XU208核心及其集成组件的核心使用。\n3V3 供应部分\n3V3电压范围（3.135 ~ 3.465 V）\n VDDIO (3V3) : Digital I/O power (left,right,top), VDDIOL,VDDIOR,VDDIOT OTP_VCC (3V3) :pins for OTP USB_VDD33 (3V3) : USB Analog power,analog supply to the USB-PHY  1V0 供应部分\n1V0电压范围（0.95 ~ 1.05 V）\n VDD pins (1V0)：Digital tile power ，for the core logic PLL_AVDD (1V0) : Analog power for PLL, pins for the PLL USB_VDD (1V0) : USB Digital tile power , supply to the USB-CORE  其电源设计如下\n 3V3由5V DC-DC转换得到，3V3先稳定后，使能另一个DC-DC转换得到1V0 ; 形成 3V3先上电，1V0后上电的时序 3V3和1V0分别供应相应的电源输入引脚，尽量保证每个电源输入引脚有个104的滤波电容，且这些电容在layout的时候，尽量靠近相应的电源引脚。 PLL_AVDD 需要一个高品质的电源，在PLL_AVDD引脚加入RC 低通滤波器，且在layout的时候，4R7电阻和104电容需要尽可能靠近PLL_AVDD引脚  复位电路 关于芯片复位，XU208-128-QF48 Datasheet 文件有如下说明：\n The device is kept in reset by driving RST_N low. When in reset, all GPIO pins have a pull-down enabled. When the device is taken out of reset by releasing RST_N the processor starts its internal reset process. After 15-150 µs (depending on the input clock) the processor boots.\r 简单来说即是，最小系统电源稳定之后，需要短时间低电平脉冲拉低芯片复位管脚，时间至少需要维持150us,然后再进行拉高，MCU进行复位操作。我司设计框图如下：\n时钟设计 XU208需要三个时钟输入:\n  24MHz有源晶振是XU208的起振时钟，接XU208 CLK脚\n  45.1584和49.152MHz晶振为音频晶振，为XU208提供时钟参考\nXU208通过软件识别当前音频采样率来进行这两个晶振的使能切换，如当前音频采样率为32bit/44.1KHz，XU208使能441_ENABLE脚，以45.1584MHz时钟为参考，16分频产生2.8224MHz的I2S_BCLK和44.1KHz的I2S_LRCLK时钟，48KHz则对应49.152MHz时钟使能，当PC播放不同采样率音频时，XU208通过端口使能控制所需时钟的使能，从而达到同步切换时钟频率的效果。其设计思路如下框图：\n   FLASH 在XU208的参考原理设计中，flash的连接方式有两种，SPI和QSPI，其中4B0~4B2决定当前启动方式为SPI还是QSPI，如图是datasheet的真值表说明\nSPI Flash模式 默认参考设计使用SPI FLASH连接方式，如下图XU208的4B0即X0D04脚上拉接3.3V\nQSPI Flash模式 QSPI与XU208的连接方式与SPI有细微差别,QSPI的CS_N，SCK脚的连接方式与SPI一样,QSPI的D0~D3脚分别与4B0~4B3脚位相连,4B0不需要上拉：\nXTAG与其他接口 XTAG XMOS的XTAG调试工具为XMOS芯片专用调试和烧录工具，包含JTAG，复位，在线调试和烧录程序，还有高级调试，xtag对于XMOS芯片开发都必不可少的。\n木瓜电子提供转接板主要是是为了减小XTAG的占用面积，建议用户在硬件设计的时候使用2x5 1.27mm的端子来代替XTAG的2X10 2.54mm的大端子，以减小PCBA面积和减少layout走线。\n转接原理如下图\n其实物如下图，用户需要自行焊接转接板的端子，并且遵循其搭建过程\n其他接口 其他接口如I2S,I2C,UART,SPDIF,MIDI等需要与我司技术进行定义，优先使用1bit口，如1E、1F，1M；4 bit口尽量用于同个功能定义，如4D驱动4个LED.\n其他注意事项   关于XMOS最小系统的阻容设计，必须根据木瓜电子提供的参考设计进行设计，阻容值不能随意更改，客户在设计及贴板时务必检查清楚。特别需要注意的是4.7Ω，43.2Ω不能随意更改。\n  用户将电路板交给木瓜电子调试软件之前，需要对硬件做初步检查\n  确认5V/3.3V/1V电源是否正常，是否短路在所有电源检测正常的情况下，木瓜电子会提供一个flash烧录固件，首次烧录flash固件，用户需准备flash编程器，(可在淘宝搜索“硕飞编程器 SP8-B专业版”，其他型号烧录器需要支持硬件所使用的FALSH烧写)。 用户烧入固件后，用USB连接PC或者其他系统，查看USB设备是否枚举正常。\n  用户烧入固件以后如果发现USB设备无法正常枚举，需要做以下检查\n检查表 Check List    24M时钟晶振起振是否正常 如果采用SPI的连接方式，首先检查XU208 12脚位（X0D04）电压是否正常 检查XU208的USB_VBUS脚位5V电压是否正常 检查USB_DP,USB_DN与XU208是否接反 检查XU208 PLL_AVDD脚位电压是否正常 检查XU208 USB_RIUNE脚位是否接地 检查XU208 RST复位引脚是否被拉住（低电平复位） 检查阻容器件焊接以及阻容值对否正确（特别注意43.2Ω，4.7Ω，1nf） 检查49pin是否接地  服务 XU208的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计（PXUA08QF48评估板）， datasheet文档完成设计。\n木瓜电子可以提供XU208-128-QF48-C10 , 麦克风和Codec芯片供应服务。\n","description":"基于XU208-128-QF48-C10的硬件设计","id":0,"section":"docs","tags":null,"title":"PXUA08QF48_硬件设计","uri":"https://docs.pawpaw.ltd/docs/pxua08qf48/pxua08qf48_hw_deseign/"},{"content":"固件命名 XMOS固件命名方式参考如下，如2i0o2xsxxxd_dfu.bin，该固件表示Audio Class 2，输入通道数为0，输出通道数为2，不支持MIDI，支持SPDIF OUT，不支持SPDIF IN,ADAT,支持DSD输出。\n Audio Class: 1 or 2\nInput enabled: i (channelcount)\nOutput enabled: o (channelcount)\nMIDI enabled: m, disabled: x\nSPDIF out enabled: s, disabled: x\nSPDIF in enabled: s, disabled: x\nADAT out enabled: a, disabled: x\nADAT in enabled: a, disabled: x\nDSD out enabled: d, disabled: x\n 固件列表   2i0o2xsxxxd_dfu.bin(HIFI 声卡)\n PCM44.1KHz~768KHz@32bit DSD64~DSD512，DOP64~DOP256 SPDIF OUT 192KHz@24bit    2i2o2mxxxxx_dfu.bin(专业录音声卡)\n 立体声输入输出，PCM44.1KHz~192KHz@24bit MIDI IN/MIDI OUT    2i8o8xxxxxx_dfu.bin(多通道)\n TDM8进8出，44.1KHz~96KHz    固件I/O说明 PXUA08QF48评估板两侧引出排针，提供每个固件所需要的IO给用户连接，个别IO口在不同的固件中所表示的信号有所不同。\n  2i0o2xsxxxd_dfu.bin(HIFI 声卡)\n  1L (MCLK)\n  1C (LRCLK/DSDL)\n  1A (BCLK/DSD CLK)\n  1O (DAC_DATA/DSDR)\n  1D (SPDIF OUT)\n    2i2o2mxxxxx_dfu.bin（专业录音声卡）\n  1L (MCLK)\n  1C (LRCLK)\n  1A (BCLK)\n  1O (DAC_DATA)\n  1P (ADC_DATA)\n  1N (MIDI IN)\n  4E0 (MIDI OUT)\n    2i8o8xxxxxx_dfu.bin（多通道应用）\n  1L (MCLK)\n  1C (LRCLK)\n  1A (BCLK)\n  O (DAC_DATA)\n  P (ADC_DATA)\n    固件测试软件 PXUA08QF48评估板固件测试需要使用PC上的播放软件和录音软件测试，这里以foobar2000和Audacity为例。\n1.foobar2000安装（可到foobar2000官网https://www.foobar2000.org/下载或者直接在木瓜官网下载）\n 下载好foobar2000安装包以后，点击打开，按默认安装方式一直点击Next即可    软件安装成功以后，需要安装foobar驱动以及安装ASIO插件\n  驱动安装:打开ASIOProxyInstall-0.7.1.2.exe文件，按默认一直点击next\n  插件安装：打开foobar2000软件，\n    打开foobar，点击file\u0026mdash;\u0026gt;Preferences\u0026mdash;\u0026gt;Components\u0026mdash;\u0026gt;Install。\n 在弹出安装指示框中将双击这两个插件，添加需安装插件列表，添加完毕点击Apply，foobar将自行重启，插件添加成功   安装完插件以后需要对foobar进行设置  ​\t打开foobar，点击file\u0026mdash;\u0026gt;Preferences\u0026mdash;\u0026gt;Output\u0026mdash;\u0026gt;Device栏选择foo_dsd_asio\n​\t点击file\u0026mdash;\u0026gt;preferences\u0026mdash;\u0026gt;output\u0026mdash;\u0026gt;ASIO\u0026mdash;\u0026gt;双击foo_dsd_asio弹出指示框\u0026mdash;\u0026gt;ASIO Driver选择TUSBAudio ASIO Driver\n​\tDSD Playback Method选择ASIO Native\n​\t点击file\u0026mdash;\u0026gt;preferences\u0026mdash;\u0026gt;tools\u0026mdash;\u0026gt;SACD\u0026mdash;\u0026gt;ASIO Driver Mode选择DSD\n 完成所有设置以后直接把测试音频复制到foobar2000里面就可以进行测试了  Audacity的安装方法比较简单，直接网上搜索Audacity下载安装包默认安装即可。  固件测试  2i0o2xsxxxd_dfu.bin  声卡设置：\n  I2S信号测试\nPC通过USB连接PXUA08QF48评估板，PC正常识别USB设备以后，打开foobar2000，按照上述设置foobar完毕以后直接测试音频，\n测试44.1KHz~768KHz音频，DSD64~DSD512，由于该评估板仅输出数字信号，用户可使用示波器查看LRCLK,BCLK和DAC_DATA信号输出是否正常即可，如需出声，需搭配木瓜电子PXUA08QF48-9038模拟板或者用户自行将数字信号接到其他模拟板。\n  SPDIF信号测试\nSPDIF(1D)信号测试需外接SPDIF解码器进行测试。\n   2i2o2mxxxxx_dfu.bin\n该固件测试需进行声音控制面板设置，打开电脑右下角小喇叭的声音控制面板，右击打开扬声器属性\n  打开声音控制面板\u0026mdash;\u0026gt;播放\u0026mdash;\u0026gt;右键点击扬声器打开属性栏\u0026mdash;\u0026gt;Enhancements\u0026mdash;\u0026gt;点击Disable all enhancements\u0026mdash;\u0026gt;应用\n打开声音控制面板\u0026mdash;\u0026gt;播放\u0026mdash;\u0026gt;右键点击扬声器打开属性栏\u0026mdash;\u0026gt;高级\u0026mdash;\u0026gt;选择采样率\u0026mdash;\u0026gt;应用\n同样的，打开录音属性，选择Disable all enhancements并点击应用，打开高级设置，选择和扬声器相同的采样率\n注意：扬声器和录音机采样率设置必须保持一致。\n  I2S信号测试\n该固件可使用评估板进行自测，将评估板子DAC_DATA(1O)和ADC_DATA(1P)用一根杜邦线短接，\n打开播放软件，可以用酷狗或者网易云之类的播放软件（不能使用foobar，foobar会独占USB设备）\n打开Audacity，进行设置\n  点击第五步录音\n  MIDI测试\n可使用评估板进行自测，也可外接midi设备。评估板短接MIDI OUT（4E）和MIDI IN（1N）。\n下载安装MIDI Editor和MIDI Player。\n打开midi player，点击设置，查看枚举是否正常，导入MIDI音频文件，播放\n  打开midi editor，点击midi\u0026mdash;\u0026gt;midi setting\u0026mdash;\u0026gt;勾选MIDI IN\u0026mdash;\u0026gt;点击录制\n2i8o8xxxxxx_dfu.bin  测试分为两部分，录音测试以及播放测试，测试之前需要完成基本设置。\n1、基本设置\n首先安装驱动，连接设备，将声卡设置为8通道（电脑设置即为7.1环绕），且设置播放与录制选项属性必须在同一采样率，本测试实例以统一设置44.1KHz采样率为例。\n电脑设置声卡为8通道\n播放与录音设置同一采样率（以44100Hz为例说明）\n播放采样率设置\n录音采样率设置\n2、audacity播放录音自测\n完成上面基本设置后，将播放通道座子与录音通道座子短接，进行播放-录音自测，audacity设置windows WASAPI、XMOS声卡线路设备、通道数8、采样率，然后点击录音。\n下图为电脑自带7.1声道环绕测试说得到的录音数据。（得到下图的录音波形说明播放录音正常，但是audacity并不支持多通道的音频播放，该测试只是用于快速测试播放录音功能。）\n其中自带7.1声道环绕测试，在电脑设置为7.1环绕下方，点击测试即可\n2、使用Adobe Audition CC 2018录音播放测试\n上面讲到audacity并不支持多通道的音频播放，这时可以使用专业支持多通道录音我和播放的软件进行测试。\nAudition新建多轨会话,设置采样率，主控通道数，此时Audition最多只能选择5.1声道，即是6通道的录音，剩余的两个通道需要我们手动添加\n添加2次单声道音轨，最终得到8通道音轨\n对每个轨道进行设置，设置对应轨道录音以及播放轨道所在设备的实际通道\n所有通道设置好了之后，打开录音准备，再进行录音，电脑播放端播放自带7.1环绕测试，录音完毕后可以对录音文件进行多通道播放测试。\n","description":"PXUA08QF48固件说明","id":1,"section":"docs","tags":null,"title":"PXUA08QF48固件说明","uri":"https://docs.pawpaw.ltd/docs/pxua08qf48/pxua08qf48_firmware_desc/"},{"content":"用户需要确认以下内容，以方便阅读下文\n 已拥有PXUA08QF48评估板，并且已经查阅了PXUA08QF48_硬件使用 已了解熟悉USB Audio方案 已有或已了解熟悉USB Audio驱动（参考XMOS USB Audio驱动说明文档） 已有XU208软件烧录工具(XMOS专用XTAG或者flash烧录器)  概要 使用XU208-128-QF48-C10（后面统称XU208）作为USB Audio方案的主控，需要了解硬件设计和软件设计，结合木瓜已有固件，搭配PXUA08QF48评估板使用。根据我司现有的XMOS USB Audio方案，可以使用XU208来做HIFI声卡，专业录音声卡，MIDI声卡，多通道等应用。\nXU208项目导入前，根据下文的描述需要针对以下几点来进行XMOS芯片项目导入：\n  XU208硬件框架的确定\n  用户需要梳理方案的应用场景\n  USB Audio功能需求的确定\n  XU208固件的获取，烧录和更新\n  产品量产和测试\n  USB Audio ASIO 低延时驱动的获取（针对Windows系统）\n  XU208应用框架确定 针对XMOS USB Audio方案应用中，需要基本了解XU208芯片特性和USB Audio方案的应用场景，一般会应用到如下几个应用场景，其中包括但不限于：USB HiFi声卡，专业录音声卡，USB多通道声卡等应用，用户需要根据需求来选择对应的应用框架进行项目导入。\nXU208芯片特性 XU208芯片基本特性如下，其中USB Audio协议和I2S,TDM,S/PDIF 等音频接口，和逻辑控制的功能属于软件编程定义内容，datasheet仅表示XU208的硬件特性。\n 商用温度等级（0 °C to 70 °C） 3V3 \u0026amp; 1V0 双路电源供应 8个实时逻辑核心，128KB内部SRAM 芯片内部集成USB PHY 2.0，完全符合USB 2.0规范 QFN48封装 170mA 典型工作电流（3V3\u0026amp;1V0）  USB HIFI声卡 USB Hi-Fi 声卡的产品形态类似如，数字功放，桌面解码器，便携式高清播放器等等，一般使用USB数据线来传输和解析高质量，高采样率的音频文件进行解码播放。\nUSB HIFI声卡的大体硬件框图如下，\n其中使用PXUA08QF48评估板评估板搭配固件为app_*2i0o2xsxxxd_dfu.bin*：\n针对如上框图，需要做如下说明：\n PC通过USB线和XU208 USB Audio声卡设备连接, USB 使用UAC2.0 协议来传输PC/PHONE的音频输出信号（注：如需支持苹果手机，需苹果官方OTG线） XU208芯片通过I2S协议和后端DAC连接通讯， 并且输出I2S数字音频给DAC, DAC输出高质量，高保真模拟信号 USB HIFI声卡2通道立体声输出时，能够支持PCM44.1KHz~768KHz@32bit，支持DSD64~DSD512,DOP64~256 音频格式 USB HIFI声卡SPDIF OUT 输出时，支持PCM44.1KHz~192KHz@24bit  专业录音声卡 专业录音声卡产品使用USB Audio 方案能够完成多种音频接口扩展，如AUX, RCA, MIDI , S/PDFI接口的扩展，同时提供高采样率，高质量的录音声卡。专业录音声卡产品类似如网红直播声卡，录音棚专业录音设备。\n专业录音声卡的大体硬件框图如下，\n其中使用PXUA08QF48评估板搭配固件为2i2o2msxxxx_dfu.bin：\n USB连接PC和XU208,USB上行下行传输音频数字信号 XU208通过I2S连接ADC/DAC 2通道立体声输入和输出，支持PCM44.1KHz~192KHz@24bit 提供MIDI接口，连接电子乐器  多通道应用 多通道声卡产品形态如，调音台，\n多通道声卡的大体硬件框图如下，\n其中使用PXUA08QF48评估板搭配固件为评估板搭配固件2i8o8xxxxxx_dfu.bin）：\n XU208芯片通过TDM协议和后端DAC/ADC连接通讯 8通道输入/输出，支持PCM44.1KHz~96KHz@24bit 可提供midi接口 如有更多通道数需求，需定制固件  项目导入 用户已了解熟悉了上述框架，并且已使用PXUA08QF48评估板进行项目评估之后，跟我司联系并确认最终需求，包括双方需要完成的工作，时间节点等等，项目最终需求确认以后我司会要求双方签订一个NDA协议，该协议是为了保护双方项目重要信息，确保双方利益不受任何损失。为了确保项目的正常启动，项目启动前用户还需了解USB Audio ASIO驱动说明，我司才最终和用户立项进行项目合作关系。\n最终用户项目量产前，我司会跟XMOS进行客户项目报备，并且最终我司为用户提供芯片供应服务，有我司销售人员对接。\n项目立项启动 项目初始阶段我司提供XU208-128-QF48-C10主控原理图参考设计，原理图仅包含XU208数字接口及其数字部分的外围电路设计，（严格来讲，需要用户参考我司的XU208硬件设计文档进行原理和PCB , 用户自行根据文档进行检查原理图，如有必要可以向我司申请复审原理图，call_center@pawpaw.hk）用户需自行完成模拟部分（ADC /DAC / 运放等）设计以及PCB layout，PCB layout完成后我司提供XU208样机固件给用户烧录到USB Audio项目样机中，以方便用户进行检查项目硬件是否能够正常运转起来，确认硬件运行正常没有问题之后，可将电路板寄给我司工程进行最终调试。\n固件说明 评估板配套提供了多个固件，主要是USB音频支持规格以及接口作为区别，其中固件命名遵循XMOS USB audio 针对固件的命名方式，例如2i2o2mxxxxx固件表示支持USB Audio Class2.0，支持通道两入两出，支持MIDI,不支持SPDIF IN/OUT,不支持ADAT IN/OUT，不支持DSD，命名方式参考下表：\n Audio Class: 1 or 2\nInput enabled: i (channelcount)\nOutput enabled: o (channelcount)\nMIDI enabled: m, disabled: x\nSPDIF out enabled: s, disabled: x\nSPDIF in enabled: s, disabled: x\nADAT out enabled: a, disabled: x\nADAT in enabled: a, disabled: x\nDSD out enabled: d, disabled: x\n 该文档只针对固件命名说明，方便用户后续烧录更新固件，详细的固件列表以及固件的使用方式请参考（固件说明）文档\n所有XU208固件由我司免费设计与提供，包括flash烧录固件和USB DFU更新固件，如需其他固件支持，可与我司工程协商是否可以提供，整个项目不收取任何额外费用（定制项目除外），后续合作我司主要以提供XMOS芯片以及其他芯片为主，包括DAC,运放，flash，等芯片用户均可与我司协商提供。\n固件烧录 XU208芯片可以使用XMOS专用XTAG烧录器烧录，也可以使用flash编程器烧录。\n木瓜电子通常会提供3种后缀命名的固件，分别为xxx.xe, xxx_flash.bin和xxx_dfu.bin。其中：\n xxx.xe固件由XMOS IDE编译生成，仅能通过XTAG调试工具烧录到XU208芯片，其烧录时间上，效率很低 xxx_flash.bin固件由xxx.xe通过XMOS IDE导出，仅能通过flash烧录器烧录，效率较高 xxx_dfu.bin更新固件由xxx.xe通过XMOS IDE结合Flash型号信息来导出，仅能通过USB dfu_usb工具进行更新固件。\n注意：该烧录方试要求flash已存储XU208正常运行的程序，如果flash内部为空或者错误程序，将只能通过其他两种方式烧录  xxx.xe的烧录方式 用户需要拥有XMOS的专用XTAG调试工具，并且下载和安装xTimecomposer IDE。\n运行其Command prompt 工具，确保上电XU208硬件和接好XTAG，键入指令\nxrun -l\r, Enter键后，查看XU208和XTAG是否握手成功\n握手成功以后键入指令\nxflash xxx.xe\r烧录.xe文件（该烧录方式仅针对部分flash型号）\n针对大部分flash型号，需键入指令\nxflash xxx.xe --spi-spec xxx.spec\r（xxx.spec文件为flash描述文件，一般由我司提供）\nxxx_flash.bin烧录方式 用户需要拥有flash烧录器，XU208默认flash参考设计为SPI Flash的连接方式，用户如果使用QSPI连接，需使用支持QSPI烧录的烧录器。\n两种连接方式在烧录上需要注意的地方是在烧录器上位机软件上的配置选项不同，这里以硕飞的烧录器（为例做简单说明：\n 检测芯片型号或者自行选择flash型号 加载xxx_flash.bin固件 打开配置选项 QSPI烧录选择QE=1,SPI烧录选择QE=0,后确定 勾选写入配置 开始烧录  xxx_dfu.bin烧录方式 该烧录方式需要评估板flash已存储可以正常运行的USB Audio固件。使用USB连接PC以及评估板，安装USB Audio驱动，待设备管理器正常枚举USB设备。\n将我司提供的XMOS官方测试版驱动解压缩，然后点击进入文件夹并打开dfu工具（XMOS_TUSBAudio_eval_v4.11.0_2017-05-16\\W10_x86\\TUSBAudioDfu.exe）\n点击Browse选择固件，加载进去并点击start，\n产品测试 用户在完成PCB layout并且已初步运行我司提供初始测试固件，电路板在操作系统上（如windows系统）已能正常枚举USB以后，针对上述每个应用框架，还需进行以下测试：\n  确认BCLK,LRCLK输出正常并有数据输出（示波器测量）\n  DAC数据对齐方式为I2S对齐\n  PCM44.1KHz~768KHz是否都能正常播放，DSD是否正常。（针对每一个框架所能最高支持采样率规格有所不同）\n  录音能否正常录入，延迟是否太高\n  音频之间的切换是否有POP音\n  产品量产 用户产品最终落地量产时，我司提供xxx_flash.bin烧录固件，由flash烧录器统一烧录到flash芯片以后再上SMT。flash的烧录可用户自行解决或者我司提供烧录服务（收费）。\n驱动说明 USB Audio ASIO驱动仅针对Windows系统，在Linux，MAC，安卓，IOS等系统下面是免驱的。驱动需用户自行跟第三方驱动公司沟通以及购买，我司与第三方驱动商没有任务商务合作，用户购买驱动以后，提供驱动VID PID给我司进行软件更改以适配最新的驱动。驱动详细说明请参考文档XMOS USB Audio 驱动说明\n","description":"基于XMOS音频处理芯片XU208-128-QF48-C10芯片设计的了解项目情况和量产规划，已导入XU208的硬件设计。","id":2,"section":"docs","tags":null,"title":"USB Audio_项目导入","uri":"https://docs.pawpaw.ltd/docs/pxua08qf48/pxua08qf48_proj_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了US516P6-KIT评估板 已详细测试了USUS516P6-KIT评估板的识别率，误识别率等，拾音距离的性能 已确认USUS516P6离线语音控制方案性能可满足导入项目产品中  概要 使用US516P6作为单麦离线语音控制方案的主控，需要了解硬件设计和，结合结构设计，才能使得产品顺利落地。US516P6项目导入前，根据下文的描述需要了解以下几点:\n US516P6的硬件框架的确定 US516P6的固件获取, 烧录和更新 US516P6的命令词定义和UART串口指令的定义 麦克风的外壳结构的声学设计 US516P6的产测需具备的设备和测试的流程  US516P 硬件基本框架 US516P6 芯片基本特性如下:\n 温度等级-20°C到 85°C QSOP24 封装 5V电源输入，60mA电流功耗 内置了16Mbit Flash 订购型号：US516P6；  US516P6 硬件系统系统如下图。根据是否需要播放播报音进行选择运放芯片。\n固件功能说明 US516P6　内置了离线语音识别模型库，支持最多150个语音命令词，最多10个唤醒词，支持语音播报，和识别后串口指令输出。\nUS516P6　内置了DSP核心和MCU核心，DSP核心主要是完成语音识别，MCU核心主要是做逻辑控制使用。绝大多是通过软件定义编程实现功能，形成可烧录的固件\n木瓜电子可以为用户定制唤醒词，语音命令词，播报音，以及串口指令，用户在向木瓜电子申请定制固件前，需要根据我司提供的《US516P6离线语音控制_用户功能需求采集.txt》文档进行补充，通过邮件call_center@pawepaw.hk返回提供给研发部\n其文档要求提供的内容有：\nUS516P6_KIT购买用户需要提供的内容\n1，唤醒词\n2，命令词\n3，播报语\n4，输出的串口指令（默认是9600波特率，可选择）\n提供完毕信息后，没有特殊的要求，一般在几个工作日内我司会安排研发人员设计固件，并且释放出来。\n语音识别性能说明 关于识别率，基于我们的测试结果，并且根据项目经验，我们能够写出的标称值为\n  高识别率：5米远距离识别，高达95%识别率\n  低误识别：\u0026lt; 1 false in 48 hours\n  但是并不是每个语音命令词都会同样的识别性能，为了能够达到比较好的识别性能，在定义和选择语音命令词的时候我们建议以下：\n  尽量不要选择叠词作为唤醒词或者语音命令，如“木瓜木瓜”，“木木瓜瓜”\n  尽量选择开音的词语做作为识别词，如ａ音，ａｏ音，ａｉ音等等，尽量不要选择闭音和鼻音的词语，其中的原因是开音的词语声音能量比较大，识别率便高\n  每个词语的长度尽量在3~5个字，太多或者太少都会不利于识别率的提高\n  词语与词语直接会存在互串的可能性，如“打开灯光”和“打开灯管”　，这样的两个词容易互相串扰识别，建议定义和选词时，能够有足够的语音区别出来。尤其是定义数字的时候，尤其需要主要，＂1＂和\u0026quot;7\u0026quot;这些区别\n  固件烧录 木瓜电子通常会提供3种后缀命名的固件，分别为uni_app_release.bin, uni_app_release_update.bin和uni_app_debug_update.bin。这三者中，uni_app_release.bin称为factory固件，uni_app_debug_update.dfu和uni_app_release_update.bin都统称为update固件，这三者的区别为：\n  uni_app_release.bin 为我司提供给用户量产的固件，使用的脱机烧录器进行烧录或者JTAG烧录，一般我司会提供已经烧录好固件的US516P6芯片供应给用户\n  uni_app_release_update.bin为我司提供给用户量产程序更新的固件，使用UniOneUpdateTool.exe工具并且通过USB转串口助手进行更新固件，这方式我司比较常用，以便客户免购买专用烧录器进行烧录固件\n  uni_app_debug_update.bin为我司提供给用户进行调试排查问题使用，使用UniOneUpdateTool.exe工具并且通过USB转串口助手进行更新固件，同时需要配合US516P6的打印功能，这个固件仅适用调试固件问题，平时不提供也不使用。\n  麦克风选型 US516P6作为单麦语音芯片，通常我们建议用户使用驻极体麦克风即可（如确实需要贴片模拟麦克风，可以参考PDF档的参考设计），通常情况下，驻极体麦克风的供应商供货方式为麦克风组件的方式，麦克风组件包括了咪头，咪头胶套，音频双绞线，1.27mm的线材公头端子。所以在硬件设计时，需要有预留1.27mm间距的2pin的麦克风端子（母座）的意识。\n如示意图\n驻极体麦克风的选型要求为\u0026gt;= -32dB SNR的麦克风为优，对供应商和其他参数指标没有太多要求，并且麦克风的设计比较建议，无须要求数字地和模拟地的区分，也不需要加麦克风屏蔽线。\n当然也可以不用麦克风组件的要求，比如麦克风使用贴片的方式放在PCBA板子上，如果选择这个方式，需要在结构外壳上配合麦克风的密封性的要求。\n结构设计 在US516P6的产品设计中，结构的设计会影响语音识别率，其整体的体现主要是结构和外壳的接触情况，这里需要遵循的标准是，麦克风需要和结构外壳无缝贴在一起，避免声音在结构内部来回发射，并且麦克风的拾音口的地方不能有很大的风速吹过。其大概的示意图如下：\n如上图所示，在硬件设计和结构设计时，应提前安排好结构设计都要求：\n 要求对麦克风做好密封性处理 避免让声音进入结构内部来回反射 麦克风咪头建议加胶套  建议在结构首版时，须要进行US516P6裸板测试和装结构测试进行对比一下性能的区别，严格上讲，裸板性能测试是最好的，装上结构会有一定的识别率下降。\n生产测试 语音模块的量产测试有几种方式，需要根据产线的配置情况来选择，并且产能也跟测试方式有关系。量产测试有很多钟方式，如下列举的方式仅作参考，由用户自行判断和选择。\n   方式 难易程度 测试内容 操作方式     人工监听 简单 上电测试喇叭是否会播报 【操作方式】让PCBA上电就能播报开机语音；通过人耳进行判断是否有声音播报出来进行判断优良，在后焊流水线上进行安排人员进行监听测试【判断程度】能够测试整个PCBA通电情况和播报情况，仅剩麦克风输入的硬件部分没有测试到   治具测试 简单 上电串口输出特定指令 【操作方式】可以制作一拖多的测试治具，治具压下则判断电流和串口接收情况，进而在治具上判断良品而亮相应的LED灯，需要在治具上花时间投入设计。【判断程度】能够判断整个PCBA通电情况和主控运作情况，剩下麦克风硬件部分没有办法测试   人工监听 复杂 上电测试是否能够语音识别和播报 【操作方式】在后焊流水线上放置喇叭重复间隔性单曲循环得进行播放唤醒词(需要2~3秒的间隔时间)，如果能识别，并且播报出来，则视为良。【判断程度】能够判断整个PCBA的通电情况，以及喇叭和麦克风全部功能都能认证通过   治具测试 复杂 上电测试是否语音识别和串口输出特定指令 【操作方式】可以制作一拖多的测试治具，在治具上设计装有专用唤醒词的音频文件进行通过Line-in的方式输入到PCBA的麦克风的接线口测试上，进而在治具上判断良品而亮相应的LED灯，需要在治具上花时间投入设计【判断程度】能够判断整个PCBA通电情况和主控运作情况，剩下后焊/后插的麦克风组件没有办法测试到    总结 木瓜电子在整个离线语音项目中，能够协助的内容为提供US516P6供应服务，供应PCBA模组，硬件参考设计，固件设计，语音识别性能优化建议。并且供货US516P6芯片时可以提前烧录好固件。\n用户需要自行根据参考设计设计原理图，根据项目需要提前安排好结构设计，量产测试设计，和语音识别性能测试。\n关于项目导入的问题，可以直接邮件联系我们call_center@pawpaw.hk\n","description":"基于云知声单麦语音芯片US516P6芯片设计的了解项目情况和量产规划，已导入US516P6的硬件设计。","id":3,"section":"docs","tags":null,"title":"US516P5_项目导入","uri":"https://docs.pawpaw.ltd/docs/us516p6-kit/us516p6_project_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了US516P6-KIT评估板，且查阅US516P6-KIT_硬件使用 已详细测试了US516P6-KIT评估板的识别率，误识别率等，拾音距离的性能 已详细了解US516P6项目情况，且已查阅US516P6-KIT_项目导入 已确认US516P6离线语音控制方案性能可满足导入项目产品中  US516P6 datasheet 导读 查看Unisound-蜂鸟M(US516P6) SOC产品手册.pdf，其US516P6描述的为裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（-20 °C to 85 °C） QSOP24 封装 60mA典型工作电流，5V供电 内置了16Mbit Flash 3V3 I/0 高电平 内部集成了LDO 和两路ADC和DAC  电源 根据datasheet得知 US516P6 仅需5V电源供应，其芯片内置部分LDO，无需在外围再添加其他电源设计\nI/O 映射 US516P6的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子原理来选择使用特定的I/O map。\n时钟信号 US516P6外部需要12MHz无源晶振接入作为启动晶振，无再需要其他晶体。\n音频 US516P6 内部集成了1路ADC 支持驻极体麦克风输入, SNR≥94db；内部集成了2路DAC ,支持Line-out是指输出播报音频\n原理图设计 US516P6外部设计比较简单，整体看需要主控芯片US516P6芯片，12MHz无源晶振，运放器件和麦克风电路即可。其参考设计如下图\n主控和PIN说明 US516P6是一个高度集成的语音芯片，有逻辑控制核心和DSP 核心运行语音识别模型。所以US516P6需要烧录对应的语音模型和逻辑控制程序固件才能完全运转起来。根据参考原理的图的说明，这里首先列举一下US516P6的PIN的说明，如下\n   PIN 脚 功能脚 软件定义 功能描述     1 GPIO_B0 US_TCK 专用JTAG烧录用的US_TCK功能脚，不建议其他用途   2 GPIO_B1 US_TMS 专用JTAG烧录用的US_TMS功能脚，不建议其他用途   3 GPIO_A25 - GPIO保留使用，可以编程定义使用   4 GPIO_A26 - GPIO保留使用，可以编程定义使用   5 GPIO_A27 - GPIO保留使用，可以编程定义使用   6 GPIO_A28 US_SPK_MUTE 喇叭的mute信号，控制运放的是使能信号   7 GPIO_B6 US_UART1_RXD US516P6的UART的RX接收引脚   8 GPIO_B7 US_UART1_TXD US516P6的UART的TX发送引脚   9 GPIO_B8 US_UART_TXD Log打印输出，便于打印使用，需要debug固件来配合   10 DAC_X - US516P6播报音line-out单声道输出   11 AVSS - 芯片系统的模拟地   12 VMID - 1.75V的电源输出，需要外部加滤波电容   - - - -   13 DAC_R - 不使用，已经有US_DAC_X作为音频输出   14 DAC_L - 不使用，已经有US_DAC_X作为音频输出   15 MIC4 - 麦克风输入，接驻极体模拟麦克风正极   16 AVDD - 模拟3V3A电源输出，用于麦克风的电源使用   17 LDOIN - 电源5V输入，整个系统电源供应   18 LDO33DO - LDO数字3V3电源输出,需要外部加滤波电容   19 LDO12O - LDO数字1V2电源输出,需要外部加滤波电容   20 DVSS - 芯片系统的数字地   21 GPIO_B2 US_GPIO_B2 板载PCBA量产时作批量烧录程序接口，建议留测试点   22 GPIO_B3 US_GPIO_B3 板载PCBA量产时作批量烧录程序接口，建议留测试点   23 GPIO_B4 XTAL_IN 无源晶振输入引脚来连接使用   24 GPIO_B5 XTAL_OUT 无源晶振输输出引脚来连接使用    针对参考原理设计图，其中需要说明的是：\n  POWER_SYS为5V电源输入，整个系统仅需要5V输入，无需要其他电源输入。并且主控内部集成了LDO，能够为外部提供3V3数字电源和3V3A模拟电源来使用。\n  LDO12O，LDO33DO，LDOIN，VMID等电源都需要加4u7和100nF的电容进行滤波，芯片内部无滤波电容\n  12MHz 无源晶振对应相应pin脚直接接入即可，XTAL_IN和XTAL_OUT需要串上个82K的电阻，可以不需要加RC的电容作为起振，如参考设计。\n  作为量产固件的烧录，建议用户保留US_GPIO_B2和US_GPIO_B3来做脱机狗烧录方式即可；而US_TCK和US_TMS是作为专用JTAG烧录使用，不适合用户使用，一般为固件提供方使用，建议保留测试点。\n  GPIO_B8是log printf打印输出引脚，保留测试点，能够接上usb转串口模块，使用波特率 57600来试试打印调试使用，需要debug固件才会有log printf打印输出，release固件没有打印输出\n  US_UART1_RXD和US_UART1_TXD为US516P6对外输出的串口指令数据，为3V3 TTL电平，波特率可以调整，我司默认是使用9600的波特率\n  麦克风和运放设计 麦克风设计 US516P6作为单麦语音芯片，通常我们建议用户使用驻极体麦克风即可（如确实需要贴片模拟麦克风，可以参考PDF档的参考设计），通常情况下，驻极体麦克风的供应商供货方式为麦克风组件的方式，麦克风组件包括了咪头，咪头胶套，音频双绞线，1.27mm的线材公头端子，\n如示意图\n针对参考原理设计图，其中需要说明的是：\n  麦克风的供应电源由AVDD引脚供应，通过电阻分压得到相应的麦克风基准电平输入到MIC4引脚，其中的电阻的和电容的数值不建议更改\n  在麦克风输入到MIC4引脚前，一定需要加上1uF的隔直电容\n  麦克风的负极需要加上滤波电容直接接地，而麦克风的模拟地和US516P6的数字地不需要做区分，直接相通即可\n  如果是使用麦克风组件的方式，需要设计一个1.27mm间距的2pin的麦克风端子（母座）\n  运放设计 US516P6 内置了DAC， 可以通过DAC_X直接通过line-out输出识别后的语音播报反馈音，但是line-out的输出难以推动3W或者更大的喇叭，需要在Line-out输出加上一个D类运放芯片加大驱动实现喇叭输出。\n针对参考原理设计图，其中需要说明的是：\n  运放芯片有多种型号，和LPA4871 Pin to pin , 用户自行选择\n  建议运放的比例为1：1（30K电阻进行比较增益）即可，同时建议选择大于10K的电阻\n  喇叭没有区分正负极，正反接仅是反相而已，没有影响正常输出。并且一般喇叭供应也是组件的方式，适当预留好2.0mm的2P母座端子\n  运放的电源供应可以是使用5V也可以使用3V3, 由于系统仅有5V作为电源供应，这里选择使用POWER_SYS作为运放的供电\n  DAC_X音频输入到运放前，一定需要加上隔直电容1uF进行隔直处理\n  检查表 Check List 框架检查   确认我司芯片供应是否是已经包含了固件，以确认是否需要预留好固件烧录接口\n  确认US516P6的UART输出对接的其他MCU是否是3V3 的I/O串口电平，已确认是否需要加上电平转换电路\n  根据产线的量产测试要求，是否已经有预留足够的测试点以配合烧录和产测\n  如设计有运放电路，5V电源供应需要满足2A的供应能力，以满足驱动3W喇叭\n  PCBA问题排查 语音唤醒时，硬件没有任何反应\n一般第一版本固件都会有开机播报音，如完成了硬件设计，并且确认固件已经烧录到语音芯片上，上电没有播报音，则说明喇叭电路或者US516P6主控设计出现了问题\n可以先使用示波器探测DAC_X引脚，在上电的完成后，是否有波形输出：\n 如果有声音波形，则说明主控已经正常运转，回来检查运放电路和喇叭的连接 如果没有声音波形，则说明主控没有正常运转，或者没有烧录固件，检查晶振设计和5V电源的电平是否正常  如果有语音播报音，喊唤醒词没有反应，则回来检查麦克风电路设计是否有问题\n识别性能不够好\n识别的性能跟很多因素有关系，建议使用裸板进行测试先，并且通过和我司的US516P6-KIT评估板进行对比测试，如果仍存在很大的区别，则是麦克风电路设计出现了偏差，或者麦克风选型上有太大的区别。驻极体麦克风的选型要求为\u0026gt;= -32dB SNR的麦克风为优。\n如果是已经装上结构测试的性能识别性能不够好，则是结构的声学没有设计好，一般需要麦克风跟结构外壳一定是没有缝隙的，且看US516P6的项目导入文档的说明\n服务 US516P6的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计，文档完成设计。\n木瓜电子可以为用户提供US516P6芯片供应服务，US516P6固件，整体设计如有技术问题，可以发邮件发call_center@pawpaw.hk 咨询。\n","description":"单麦语音芯片US516P6芯片的硬件设计指导和设计注意事项","id":4,"section":"docs","tags":null,"title":"US516P5_硬件设计","uri":"https://docs.pawpaw.ltd/docs/us516p6-kit/us516p6_hw_design/"},{"content":"概要 US516P6-KIT是基于云知声语音芯片US516P6所设计的评估板，用户能够使用US516P6-KIT进行快速测试和评估是否吻合项目需求。\nUS516P6 是云知声针对大量纯离线控制场景和产品最新推出的低成本纯离线语音识别芯片，依托于云知声在语音识别技术上的积累和算法的不断优化和创新，离线识别算法与芯片架构深度融合，为用户提供超低成本的离线语音识别方案，可广泛且快速应用于智能家居，各类智能小家电，86 盒，玩具，灯具等需要语音操控的产品。\nUS516P6-KIT支持 150 条本地指令离线识别，家居场景5米距离 95%识别率，支持带口音的普通话，低误唤醒率 (\u0026lt; 1 false in 48 hours)。\nUS516P6-KIT评估板配套了喇叭播报接口，麦克风端子，电源电子，以及UART串口端口。\n版本    产品版本 修改 发布时间     US516P6-KIT v1 初次发布 2020年4月13日    特点   高识别率：5米远距离识别，高达95%识别率\n  低误识别：\u0026lt; 1 false in 48 hours\n  支持高达150个命令词条，支持纯中文，纯英文命令词条\n  提供标准女声、甜美女声、可爱女声、台湾女声、标准男声、女童声、男童声七种音色可选\n  单麦解决方案，极简外围电路，高性价比离线语音控制方案\n  支持UART串口输出识别指令\n  规格   云知声 US516P6 主控，内置离线语音识别，语音播报音\n  单路驻极体麦克风\n  SNR 65dB\n  对灵敏度无要求\n  供电：USB 5V\n  尺寸：\n 40mmx14mm (main board)    语音播报：\n LPA4871 运放 可驱动3W 喇叭    功耗: 5V, 74mA （无播报时）\n  硬件概述  云知声 US516P6：支持多达150条语音命令词，语音播报语 Power 5V : 5V电源供电， UART TTL: UART串口接收发送，3V3 TTL电平， ETM microphone : 驻极体模拟电容麦克风端子 Speaker：喇叭端子，播报音输出，不分正负 Unisound JTAG：云知声专用烧录接口，一般出厂烧录时候使用，用户使用的可能性较小  应用场合  语音遥控器 语音灯具 智能小家电（空调，风扇，油烟机，晾衣架）  开始使用 体验 US516P6-KIT评估板使用比较简单，配套提供了USB 5V供电线材和驻极体麦克风组件，以及喇叭组件。用户找到US516P6-KIT PCBA底部有丝印标注（POWER, UART_RX,UART_TX, GND）,这些丝印与P1端口的引脚脚序对应，分别是5V电源，US516P6的UART_RX,US516P6_TX, GND 。其整体连接图如下\n其中\n 5V，GND 和 UART的RX和TX有黑色Type-A USB先连接，直接插入电脑或者USB设配器即可供电 麦克风组件包含了 端子，双绞线，咪头，胶套，为整个PCBA的声音入口 喇叭组件包含了喇叭单元，音频线，为语音命令词识别后的播报反馈语播放 建议用户自行配备USB转串口模块（类似），以配合在PC上调试和打印串口数据  使用过程如下：\n 确认喇叭和电源都已经连接好，上电时候，会有声音提示，代表上电正常及可以进行唤醒。 唤醒， 使用唤醒词唤醒，如“木瓜 ，你好” “你好，木瓜”，一般默认唤醒在10秒之后便进入睡眠状态 语音命令词， 使用语音命令词进行控制，如“打开设备”，“打开灯光” 查看播报语, 喇叭会播放对应命令词的播报反馈语 查看串口数据， 用户使用USB串口助手工具查看串口数据，一般串口通讯格式为 9600 ,8 ,0,1 ,HEX  固件和升级 US516P6-KIT评估板配套多个固件，可以使用USB转串口模块进行固件升级和切换\n固件列表    固件名称 中/英 描述     uni_app_release_update_default_zh.bin 中 默认内置空调，电视，灯光，晾衣架，风扇   uni_app_release_update_light_en_.bin 英 内置灯光控制相关语音命令词   \u0026hellip; - -待提供更多    固件更新 在US516P6-KIT资料包上，在文件Hummingbird-M-Update-Tool找到UniOneUpdateTool.exe工具，在windows系统上运行，进行更新相应的固件。\n 前提是用户需要具备USB转串口模块，并且安装了其驱动，如图片\n   US516P6-KIT的UART_RX接 USB转串口的TX , UART_TX接USB转串口的RX。\n其操作步骤如下图，其中：\n  选择uni_app_release_update_xxx.bin，固件路径不能有中文\n  点击烧录，US516P6-KIT需要重新上电才能开始进行烧录，建议烧录前先不接US516P6-KIT的Power接口\n  等到烧录完毕即可\n  固件定制 用户需要在我司商城购买定制固件服务，并且按照提供的《US516P6离线语音控制_用户功能需求采集.txt》文件，我们会安排公司的研发人员提供固件给到用户进行更新固件。\n需要主意的是：\n 命令词和唤醒次最高不能超过总数不能超过150个 中文和英文不能同时存在，需分开不同的固件 不提供串口指令，则使用默认的串口指令  资源下载 US516P6-KIT资料包全部的资料(点击下载)\n支持和商务 US516P6-KIT支持的商务服务有：\n PCBA定制服务，提供批量PCBA US516P6芯片供应服务  任何的技术支持和商务合作，可以直接邮箱联系我们：call_center@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: 可以实现自定义唤醒词和命令词吗 这里有提供两种方式，进行定制唤醒词和命令词：\n一：使用更新固件的方式进行更换语音命令词，前提是进行需要预先根据《US516P6离线语音控制_用户功能需求采集.txt》文档提供给我们进行第一次定制语音命令词\n二：在用户要求下，我们提供语音命令词提供的替换的方式，改方式是得前提前面第一种方式，并且根据语音提示进行更换操作，比如使用 “打开电视” 替换 “ 打开设备 ”，该功能我们固件默认不打开，如用户没有强烈要求的情况下。\nQ2: 更换其他麦克风会改变拾音距离吗 US516P6-KIT评估板对麦克风没有太大的要求，满足-32dB SRN以上的驻极体模拟麦克风对拾音距离没有太大影响，并且对麦克风品牌没有太大的要求\nQ3 : 使用UniOneUpdateTool.exe工具在更新固件时，一直没有更新进度改变 使用UniOneUpdateTool.exe工具更新时，前提是US516P6-KIT评估板需要和USB转串口模块连接，确认US516P6-KIT评估板的UART_TX是接USB转串口模块的RX 。同时US516P6-KIT评估板先不上当，点击烧录后，在进行上电。\n","description":"基于云知声单麦语音芯片US516P6芯片设计的单麦离线语音控制的评估板，能够实现5米拾音，识别率高达95%，低误识别，支持150个命令词条，支持中英文识别,外围简单。","id":5,"section":"docs","tags":null,"title":"US516P5-KIT_硬件使用","uri":"https://docs.pawpaw.ltd/docs/us516p6-kit/us516p6-kit_usage/"},{"content":"概要 PXUA216MB-DL2-M是通过UAC 2.0（USB Audio Class 2.0）协议把多路音轨传输到操作系统（下文简称为\u0026quot;host主机\u0026quot;），host主机需要相应的上位机实时解析UAC 2.0的音频流。\n评估板各路麦克风为独立音轨，并且保持高一致性，极小的相位差。用户根据自行的声学研究，把例程相关代码添加进入到上位机工程中使用，例程仅实现到UAC 2.0实时解析和存储，不做其他处理。\n例程包含了Windows,Linux和Android系统的例程，根据项目需求自行选择，下文主要以下windows例程为例做简单讲解，其他平台简单提示。\nWindows平台 在附件中 app_demo/windows 目录下，Pawpaw_16mic_cap_demo文件夹为例程工程，请使用 Microsoft Visual Studio 打开，打开后显示如下界面：\n打开后，例程的主函数在pa_devs.c文件中，直接点击运行即可得到下图的执行和界面\n注意此份代码使用是portaudio开源库实现，在使用该代码前，务必自行了解一下portaudio的使用（这很重要），此采集框架是开源代码。 代码工程生成的app tool会自动扫描出PXUA216MB-DL2-M评估板声卡设备，然后选择对应的输入和输出设备ID号。\n设备进入测试过程，这个时候如果PXUA216MB-DL2-M评估板的Line-out接了喇叭音箱，喇叭音箱会播放冰雨这首歌。同时也可通过命令行对音乐进行播放和暂停。同时在代码的跟目录下会生成前4个通道的声音并保存为文件.\nxmos_record1.pcm\rxmos_record2.pcm\rxmos_record3.pcm\rxmos_record4.pcm\r这里几个录音文件为演示作用，下面重点说明一下，portaudio的录音的回调函数。在record.c文件中\n1 2 3 4 5 6 7 8 9 10 11 12  for( i=0; i\u0026lt;framesPerBuffer; i++ ) { #if (DATA_TEST == 1) \tfor(j =0; j \u0026lt; 18; j++) { data-\u0026gt;input_data[j] = *rptr++; } fwrite(\u0026amp;(data-\u0026gt;input_data[0]), 1, sizeof(short), file[0]); fwrite(\u0026amp;(data-\u0026gt;input_data[1]), 1, sizeof(short), file[1]); fwrite(\u0026amp;(data-\u0026gt;input_data[2]), 1, sizeof(short), file[2]); fwrite(\u0026amp;(data-\u0026gt;input_data[3]), 1, sizeof(short), file[3]); #endif   该部分代码是获得实际的录音数据的实现代码，详细的数据框架方式和相应的说明在代码中都有注释，由于篇幅的限制，请用户一定要先了解portaudio此开源代码的使用。\n如果更新了固件或者改变了通道数，采样率等音频格式信息，在audioConfig.h进行修改现有的定义\n#define SAMPLE_RATE (16000) // 采样率设置\r#define FRAMES_PER_BUFFER (256) // buffer框架设计\r/************************************************************************************************\r* 此处根据实际的选择设备的通道数目，进行定义，在这里以XMOS的板子来看\r* 输入10通道，输出2通道\r************************************************************************************************/\r#define INPUTCHANNEL (18) // 输入设备的通道数目\r#define OUTPUTCHANNEL (2) // 输出设备的通道数目\rLinux平台 评估板可直接连接上Linux平台，Linux平台下已经自带了UAC2.0 驱动，并不需要额外安装UAC 2驱动，且自带了UAC 2.0解析工具，这里以Ubuntu 14.04操作系统进行说明。评估板板子连上Linux系统后，首先需要查看声卡设备，用来确定声卡的ID号。采集代码在附件中。\n编译方式如下图显示，生成的xmoscap直接运行，即可直接生成一个18通道的.wav文件。\nLinux平台下直接采用自带的tinyalsa开源库即可解析多路麦克风原始信号，无需借助第三方开源库，关于linux的tinyasla请自行熟悉和使用。\n安卓平台 评估板可直接连接上Android平台，查看app_demo/windows 目录下的安卓支持代码如下图\n注意Android平台下并不需要安装UAC 2.0驱动（这个取决于系统），默认情况下一般能够直接支持，如果不能支持请自行询问主板厂商，如何支持USB Audio Classs 2.0的驱动。\n另外, 在部署安卓例程时, 代码需要放置在jni目录下，并使用NDK编译，如果需要配合APK使用，需要使用jni调用。\n ","description":"介绍USB 16路麦克风采集评估板 PXUA216MB-DL2-M_的上位机例程，实时解析USB传输的16个麦克风和存储的代码说明，例程包含了windows，linux等操作系统的例程。用户在做算法研究时，自行植入其他内容","id":6,"section":"docs","tags":null,"title":"PXUA216MB_上位机例程","uri":"https://docs.pawpaw.ltd/docs/pxua216mb-dl2-m/pxua216mb-dl2_app_dome/"},{"content":"概要 PXUA216MB-DL2-M是基于XMOS XU216-512-TQ128-C主控设计的 USB 16路麦克风采集评估板，能够实现通过USB UAC 2.0协议实时地，同步地传输16路麦克风原始信号到操作系统端。往下兼容其他麦克风的任何数量麦克风采集。\nPXUA216MB-DL2-M评估板能够同步采集 16 路数字 MIC 信号以及 2 路回采信号，同时支持立体声播放，所有数据均通过 USB 进行传输，评估板主要提供给具备一定算法能力的声学企业以及个人使用。\n评估板USB UAC 2.0（USB Audio Class 2.0）协议兼容 Windows、Linux 和 Android 操作系统, 16个麦克风小板做分离式设计，可移动的，麦克风小板为底部拾音。灵活实现多种麦克风阵型布置需求。\nPXUA216MB-DL2-M评估板无内置任何麦克风阵列算法，主要功能为实时地，高一致性地传输16路麦克风原始信号。同时评估板集成了line-in和Line-out端子，通过USB传输16路麦克风+2路Line-in音轨，下行播放line-out 立体声播放。\n版本    产品版本 修改 发布时间     V1 初次发布 2017年10月20日   V2 修改了麦克风小板的尺寸 2018年9月25日    特点  USB UAC 2.0协议传输，作为外置声卡使用 16 PDM 数字麦克风，分离式设计，麦克风小板可以移动 支持 16KHz/48 KHz @16bit /24bit音频采样率， 支持 1 路Line-in模拟输入和1 路Line-out 模拟输出  规格   XMOS XU216主控\n· 16 个逻辑核心\n· 高达 2000MIPS 处理速度\n· 512KB RAM\n  16路PDM 数字麦克风：SPK0641HT4H\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64.5 dBA\n  供电：USB 5V\n  尺寸：87 × 70 mm （base board）, 10 x 8 mm（MIC board）\n  line-in \u0026amp; line-out\n· Codec: CS42L51\n  音频传输：\n· USB UAC 2.0 输入输出\n· 采样率：16 KHz/48 KHz , 16 bit/24 bit\n  功耗: 5V, 180mA （Max）\n  硬件概述  XMOS XU216 ：完成16 路PDM 麦克风，2路I2S信号整合，进行UAC协议传输 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 Codec CS42L51：XU216 2路I2S的编码和解码 Line-in：Codec芯片的line-in 3.5 mm耳机孔，支持增加2路模拟输入录制 Line-out: Codec 芯片的Line-out 3.5 mm耳机孔，UAC 2.0 播放，模拟输出 MIC0~15：PDM 数字麦克风，通过接线和连接器的方式，方便移动  应用场合  麦克风阵列算法研究 全景声音采集 语音识别声音采集  第一次使用 通常情况下，用户拿到PXUA216MB-DL2-M评估板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXUA216MB-DL2-M评估板和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXUA216MB-DL2-M评估板\n如图显示的PawPaw DFU 和PawPaw Microphone array UAC 2.0 说明PXUA216MB-DL2-M评估板已经成功枚举，但是还没不能使用，需要安装UAC 2.0驱动。\n仅Windows系统系统需要按照UAC 2.0驱动，linux和MAC OS都不需要另外安装UAC 2.0驱动\n安装驱动 Windows系统：\n评估板使用 USB Audio Class 2.0 作为传输协议，因此在window系统上需要安装第三方驱动，驱动压缩包是：PawPaw_UsbAudio_v5.27.0_2021-11-03_setup.zip。\n压缩该文件后，得到的是一个.exe 文件，可以直接安装，，默认安装即可（一路点击 next，直接进行安装），UAC 2.0驱动安装完成后，windows设备管理器显示如图，则表示设备安装成功\n运行PawPaw_UsbAudio_v5.27.0_2021-11-03_setup.exe\n 确保评估板的USB已经和windows系统电脑 默认安装即可（一路点击 next，直接进行安装） 安装完成了后，则会出现类似如下图片显示 评估板在设备管理器上枚举成了 Pawpaw USB Audio Devices-\u0026gt;Pawpaw Microphone Array UAC2.0  在声音界面进行设置和确认,\n1，在播放栏项，设置Pawpaw Microphone Array UAC2.0为默认设备,确认采样率是否为16bit，16000 Hz，禁用所有增强性能\n2，在录制栏项，设置Pawpaw Microphone Array UAC2.0为默认设备,确认采样率是否为 18通道 16bit，16000 Hz，禁用所有增强性能\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nLinux系统：不需要安装驱动\nMac 系统：不需要安装驱动\nDemo 和录音 安装和使用（Audacity）第三方开源录音软件在Windows系统进行录音设置，接着使用Audacity录音。\nPXUA216MB-DL2-M评估板出厂默认固件为USB输入18ch 16kHz采样率的声源，其中ch[1-16]为16路麦克风原始信号，ch[17-18]为line-in的2路模拟信号，用户通常用来回音消除的参考信号。\n在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n固件和DFU升级 评估板配套提供了2个固件，主要是USB的音频的采样率作为区别，参考下表。\n   firmware 采样率 UAC驱动 Description     app_usb_aud_mic_array_2i18o2_LINE_IN_PawPaw_16K_V101_DFU 16000 Hz 木瓜驱动    app_usb_aud_mic_array_2i18o2_LINE_IN_PawPaw_48K_V102_DFU 48000 Hz 木瓜驱动 出厂默认固件    DFU升级 Windows系统：\nPXUA216MB-DL2-M评估板使用USB进行DFU升级的工具为TUSBAudioDfu.exe，在安装测试版驱动路径下找到\n\\PawPaw\\USB Audio Device Driver\\PawPawUsbAudioDfu\\x64\\PawPawUsbAudioDfu.exe\n双击运行PawPawUsbAudioDfu.exe ，操作如图显示的步骤：\n 确认PXUA216MB-DL2-M设备显示成功 选择xxx_dfu.bin固件 点击star 进行等到烧录完毕 退出TUSBAudioDfu.exe 并且重启评估板，确认驱动是否和固件是否对应起来。  PXUA216MB-DL2-M评估板现阶段仅支持使用Windows系统使用USB DFU进行更新。\n支持和商务 PXUA216MB-DL2-M评估板全部的资料(点击下载)\nPXUA216MB-DL2-M评估板的上位机开发例程，请发送邮件申请下载 support@pawpaw.hk\nPXUA216MB-DL2-M评估板目前不支持二次开发，并且其主控XU216芯片资源已经接近用完，所以建议用户把PXUA216MB-DL2-M当作一个声卡设备使用。在使用上遇到其他技术问题，可以邮件联系我们 support.xmos@pawpaw.hk。\nPXUA216MB-DL2-M评估板目前没有开放其设计的原理图和PCB，但是我们支持用户的定制化，小型化，和项目导入，用户需要提供详细需求，由我司评估完成后对接起来。\nFAQ Q1 : 是否支持其他采样率？ PXUA216MB-DL2-M评估板目前最高支持48 Khz采样率，期间无32 KHz和44.1 KHz采样率，做一般研究，16KHz和48KHz 采样率能够满足需求\nQ2 : 能否支持其他通道数目，且小于16个麦克风 往下兼容其他麦克风数量，不够评估映射出来的通道数目仍未18 通道，可以选择性不需要多余的通道数目\nQ3 : 录制的信号中，某个麦克风信号不正常 这个很大可能是由于麦克风板子和主板的连接线和连接端子松动造成，建议对线材重新插入和牢固即可；仍不行的话，可能是麦克风已经损坏，使用其他的麦克风板插入来判断一下。\nQ4 : 是否可以更换其他型号的麦克风 可以更换，不过需要用户自行设计和生产麦克风小板，我司提供了麦克风小板的原理和PCB资料，自行更换。\nQ5 : 更新固件之后，audacity不能录音了 更新的固件需要安装对应的驱动，建议我司提供的两个UAC 驱动都安装了，压缩该文件后，得到的是一个.exe 文件，可以直接安装，但是我司建议不要如此安装，接着对该.exe 文件再一次进行解压得到文件\nXMOS_TUSBAudio_eval_v4.13.0_2019-01-21_setup，其大体内容为，\n确保评估板的USB已经和windows系统电脑，再点击运行文件夹了里面的setup_eval.exe 安装驱动程序\n关闭重新打开audacity，并且确保audacity设置正确。\nQ6 : 两个PXUA216MB-DL2 评估板同时接入到统一台电脑是否可以？ 由于PXUA216MB-DL2 评估板有固定的USB VID 和PID , 如果两台同时接入则会则无法正常使用，建议用户联系我司技术，我们可以提供不同的固件以适应两个评估板设备同时使用，但其为枚举的情况为两个不同的声卡设备。\n","description":"介绍USB 16路麦克风采集评估板 PXUA216MB-DL2-M_的硬件使用，","id":7,"section":"docs","tags":null,"title":"PXUA216MB_硬件使用","uri":"https://docs.pawpaw.ltd/docs/pxua216mb-dl2-m/pxua216mb-dl2_usage/"},{"content":"概要 木瓜电子对外提供的 XMOS USB Audio 方案可以应用在多种产品中，其中包括但不限于HiFi随身听，HiFi桌面解码器，USB 专业录音声卡， USB 多通道调音台, USB 麦克风阵列采集。XMOS USB Audio 方案中主要使用 XMOS 的XU208-128-QF48-C10 和XU216-512-TQ128-C20 这两款芯片来作主控芯片，所有产品的一个共同点就是使用 USB UAC 2.0协议来进行音频的传输。用户需要做USB 声卡相关产品的时候需要了解XMOS USB Audio相关的驱动，本文主要讲解 USB Audio 驱动相关说明。\nXMOS USB Audio 方案介绍 XMOS USB Audio 方案的协议中兼容了 USB Audio Class 1.0（UAC 1.0）跟 USB Audio Class 2.0（UAC 2.0）协议，XMOS 的USB UAC音频传输协议都是完全遵循USB IF （USB 国际联盟） 的UAC 2.0和UAC 1.0的协议标准。\n其中XMOS 的 USB Audio 方案，能够实现的功能如下表：\n   接口 功能参数     USB USB USB 2.0 (Full-speed and High-speed)\nUSB Audio Class 1.0\nUSB Audio Class 2.0\nUSB Firmware Upgrade (DFU) 1.1\nUSB Midi Device Class 1.0   audio S/PDIF\nADAT\nDirect Stream Digital (DSD)\nPDM Microphones\nDSD Over PCM\nMIDI   sample rate 44.1, 48, 88.2, 96, 176.4, 192, 352.8, 384, 705.6, 768 KHz   bit deepth 16 bit, 24 bit , 32 bit    其中用户通常都使用XMOS 的USB Audio方案的 UAC2.0 high-speed（高速）协议以实现高采样率和多通道的音频规格需求，也才能体现出XMOS芯片方案的USB Audio的高性价比。其中UAC 1.0和UAC 2.0在传输速率和带宽的情况如下表，\n UAC 1.0 传输速率为 12Mbit/s UAC 2.0 最高传输速率达到480Mbit/s  而XMOS的USB Audio的方案中，UAC 1.0和UAC 2.0的大体的区别如下表\n   功能 UAC 1.0 UAC 2.0     应用场合 立体声、普通声卡方案 HiFi、多通道、专业声卡   Mac OS、Android、Linux、IOS 免驱动安装 免驱动安装   Windows（Win7/8/10） 免驱动安装 需安装UAC 2.0驱动   通道数量 立体声（stereo） 多通道（multichannel）   功能接口 Stereo 立体声输入输出 多通道、SPDIF、MIDI、ADAT输入输出   最高采样率 PCM 96KHz@16 bit PCM 768KHz@32 bit \u0026amp; DSD Native512    由上表所述，其中需要重点说明的是：\n UAC 2.0仅在在Windows系统是需要安装USB驱动的, 在MAC OS, Linux 和安卓都是免安装驱动的 用户产品如果有在Windows系统上使用，则需要购买UAC 2.0驱动windows的安装程序 使用XMOS的UAC 2.0 方案才能支持多通道，高采样率， SPDIF、MIDI等功能接口  Windows系统UAC 2.0 驱动说明 使用XMOS的UAC 2.0 方案时，XMOS 官方推荐了几家windows系统驱动程序提供商，这里根据我司的客户使用情况，较多使用UAC 2.0驱动提供商为Thesycon的驱动程序。根据XMOS官方文档USB Audio 2.0 Driver for Windows - Overview的说明，用户在XMOS USB Audio项目进行中，会有可能使用到Thesycon的几个驱动：Thesycon评估版驱动（Evaluation driver），XMOS 立体声驱动（XMOS Stereo Driver），Thesycon商业版驱动。其三种的区别情况如下图描述：\n其中整理部分内容加以强调说明如下表\n   - Evaluation Driver XMOS stereo Driver Thesycon Driver     获取方式 免费获取 可以申请 付费购买   最大 PCM 支持 768 KHz 768 KHz 768 KHz   DSD 支持 DOP \u0026amp; Native DSD DOP DOP \u0026amp; Native DSD   MIDI 支持 不支持 支持   通道数支持 Multichannel Stereo Multichannel    Thesycon评估版驱动（Evaluation driver） 用户在XMOS USB Audio项目进行中，我们会优先提供评估版驱动，为用户前期评估测试项目所使用的免费版驱动，跟商业版的驱动支持功能，支持 SPDIF、MIDI、multichannel，以及Stereo 立体声输出 PCM 768KHz 与 DSD Native512。\n但是评估版驱动驱动存在一个限制商业化的 bug，即在设备上电持续播放一小时以后，每隔五分钟会有一个嘟嘟声。该评估版驱动还没授权来进行商用化使用，仅提供给用户测试使用。\n并且需要注意的是，木瓜电子在评估用户的项目以及调试项目过程中将提供的是评估版驱动驱动。用户确定项目之后再考虑跟Thesycon进行商业化购买驱动。\nXMOS 立体声驱动（XMOS Stereo Driver） XMOS 立体声驱动为免费授权使用，但是该驱动仅支持立体声输入输出（Stereo in/out），支持 DOP , 但是不支持 Native DSD 播放 , 以及不支持MIDI接口。另外 XMOS 立体声驱动授权使用是有商务前提如下前提，摘取XMOS官方文档USB Audio 2.0 Driver for Windows - Overview的几点需要重点说明的地方，如下图：\n XMOS 官方驱动进行商业化时，允许客户最大出货量不能超过 10k 使用的是XMOS的USB VID，XMOS将分配一个PID，并且仅能显示设备名称为 “USB Audio 2.0” 用户跟XMOS一次性购买XMOS芯片对应数量才能申请XMOS 立体声驱动  由于XMOS芯片最小包装MOQ为490 pcs，所以木瓜电子要求用户XMOS芯片订单量满足490 pcs之后，我们才能向XMOS原厂为用户申请XMOS 立体声驱动 Thesycon 驱动（Thesycon Driver） Thesycon 驱动为商业化授权驱动，用户可以先使用Thesycon评估版驱动（Evaluation driver）后，测试产品功能性能没有问题之后，确定需要购买Thesycon 驱动（Thesycon Driver）的情况下，用户需自行联系驱动方Thesycon进行商务合作，包括功能需求，License 费用等。\n木瓜电子不参与用户与Thesycon或者其他第三方驱动公司的商务商谈。Thesycon为XMOS官方推荐合作的其中一家驱动公司，如需了解相关驱动信息，可到Thesycon官网查看：\n用户在定义产品的时候，需明确产品是否需要支持在Windows系统使用以及是否需要使用 UAC 2.0 方案。如需购买驱动，用户需自行解决驱动的事情，木瓜电子仅提供硬件设计和XMOS固件的技术支持，并不参与用户与驱动方的商务合作 驱动安装与固件更新 驱动安装 Thesycon评估版驱动（Evaluation driver）下载链接USB-Audio-Class-2.0-Evaluation-Driver-for-Windows_4.13.0.zip\n压缩该文件后，得到的是一个.exe 文件，可以直接安装，但是我司建议不要如此安装，接着对该.exe 文件再一次进行解压得到文件\nXMOS_TUSBAudio_eval_v4.13.0_2019-01-21_setup，其大体内容为，\n确保评估板的USB已经和windows系统电脑，再点击运行文件夹了里面的setup_eval.exe 安装驱动程序。进入安装过程中，默认安装即可（一路点击 next，直接进行安装），UAC 2.0驱动安装完成后，windows设备管理器显示如图，则表示设备安装成功\n 确保评估板的USB已经和windows系统电脑，运行setup_eval.exe 默认安装即可（一路点击 next，直接进行安装） 安装完成了后，则会出现类似如下图片显示 评估板在设备管理器上枚举成了 XMOS USB 2.0 Audio Devices-\u0026gt;XMOS XS1-U8 DJ(EVAL)  DFU升级 Thesycon评估版驱动支持使用USB进行DFU升级的工具为TUSBAudioDfu.exe，在安装测试版驱动路径下找到*\\Thesycon\\TUSBAudio Driver EVAL\\W10_x64\\TUSBAudioDfu.exe*\n双击运行TUSBAudioDfu.exe ，操作如图显示的步骤：\n 确认设备显示成功 选择xxx_dfu.bin固件 点击star 进行等到烧录完毕 退出TUSBAudioDfu.exe 并且重新上电产品设备，确认驱动是否和固件是否对应起来。  USB 驱动 VID 与 PID说明 USB 设备有VID 和PID 描述符，其中VID：供应商描述码 ID，； PID：产品描述码。VID和PID都是有USB IF根据品牌注册分配使用的。\n在使用XMOS USB Audio的方案时，可以选择使用Thesycon分配的VID和PID ，也可以选择自己的VID 和PID(前提得在USB IF注册，且拿到证书)。同时如果使用XMOS 立体声驱动（XMOS Stereo Driver）时，VID和PID只能遵循XMOS的要求，自动分配给用户使用。\n用户与木瓜电子进行XMOS USB Audio项目合作时，无论是购买的Thesycon 驱动还是申请XMOS 立体声驱动（XMOS Stereo Driver)，都需要向木瓜电子提供PID 与 VID 信息，因为VID和PID码需要写入XMOS芯片代码中来生成固件到产品中。\n","description":"XMOS 的 USB Audio 驱动说明，关于价格和获取方式，在哪种应用场合需要XMOS UAC 驱动","id":8,"section":"notes","tags":null,"title":"XMOS USB audio 驱动说明","uri":"https://docs.pawpaw.ltd/notes/xmos_uac_2_driver_description/"},{"content":"XMOS的XTAG调试工具为XMOS芯片专用调试和烧录工具，包含JTAG，复位，在线调试和烧录程序，还有高级调试，xtag对于XMOS芯片开发都必不可少的。\n木瓜电子提供转接板主要是是为了减小XTAG的占用面积，建议用户在硬件设计的时候使用2x5 1.27mm的端子来代替XTAG的2X10 2.54mm的大端子，以减小PCBA面积和减少layout走线。\n转接原理如下图\n其实物如下图，用户需要自行焊接转接板的端子，并且遵循其搭建过程\nXTAG硬件用户需自行购买，而XTAG转接板所需的物料器件，木瓜电子可免费提供给到用户，由用户自行焊接\n","description":"XTAG的转接板说明，主要是减小XTAG调试器接口减小面积，以及焊接，安装，使用说明","id":9,"section":"notes","tags":null,"title":"XMOS XTAG 转接板","uri":"https://docs.pawpaw.ltd/notes/xmos_xtag_adapter_board/"},{"content":"概要 XMOS 芯片现有平台内置麦克风阵列算法的芯片信号为XVF3000,XVF35000,XVF3510。内置麦克风阵列算法，包含回音消除，波束成形，语音增强，噪声抑制等算法，接口带有USB和I2S等，仅支持PDM数字麦克风。这几个芯片平台都配有相应的评估板，其中的平台区别如下文描述，用户根据需求，自行选择。\n区别    属性 XVF3000 XVF3500 XVF3510     成本 高 高 低   封装 TQFP-128 FBGA-167 QFN-60   功耗 ~700 mW ~1 W ~600 mW   Flash 内置QSPI Flash 外置QSPI Flash 外置QSPI Flash   麦克风数量 4路PDM 数字麦克风 4路PDM 数字麦克风 2路PDM 数字麦克风   阵型 圆形/线形 4麦 线形 4麦 线形 2麦   发布时间 2017 2018 2019   开源情况 代码开源，算法库形式 代码开源，算法库形式 不开源，配置的形式   二次开发 允许 允许 不允许，仅配置   完整型号 XVF3000-TQ128-CA XVF3500-FB167-C XVF3510-QF60-C   评估板 PXVF3000-KIT PXVF3500-KIT PXVF3510-KIT   算法方向 会议通话/语音识别 会议通话/语音识别 会议通话/语音识别   算法优势 会议通话 会议通话 语音识别   AEC性能 mono AEC，非常好 stereo AEC ，非常好 stereo AEC，一般   Beam-forming 有 有 有，但弱化了   点噪消除 无 无 有，抗噪能力强   DOA 有，圆形可输出360度定位角度 有，线形输出180度定位角度 无，无输出角度信息         DSP 参数调整 较多参数可调整 较多参数可调整 较少参数可调整   DSP 参数固化 需在代码固化 需在代码固化 可上位机写入固化    选型建议 根据这三个平台的区别，木瓜电子提供选型思路参考如下\n针对用途\n  语音识别用途：建议选择XVF3510 2麦阵列，其重点优化了语音识别的前端算法，对接亚马逊，谷歌，阿里，讯飞，百度等平台有较高的识别率\n  会议通话用途：建议选择XVF3000和XVF3500，有非常高的AEC 回音消除性能，并且有较多的较多的降噪DSP参数调整，能够实现非常好的全双工对讲，不建议选择XVF3510做会议通话，全双工对接方面略逊色，并且针对桌面会议和视频通话，选型推荐如下：\n     用途 选型 缘由     桌面会议 XVF3000 可以输出360度定位角度信息，mono AEC(单声道 回音消除，一个喇叭播放)可以满足需求，功耗较优化，可在产品上配置电池供电   视频通话 XVF3500 输出180度前方定位角度信息，stereo AEC 能够吻合视频播放的要求。    针对开发\nXVF300和XVF3000都是开源代码，除了麦克风阵列算法是以库的方式，其他控制和接口的代码都是开放的，可以利用XVF3500和XVF3000芯片做逻辑控制，I/O控制等，当然也是需要熟悉XMOS的开发平台。需要配置软件工程师，或者委托木瓜电子提供固件。芯片和开发成本较高些\nXVF3510不开源代码，XVF3510类似于专用芯片，通过配置的方式实现简单的I/O控制功能，接近免开发，免配置的状态。不需要配置软件工程师即可使用。芯片和开发成本最低。\n针对资源\nXVF3500较其他两者来说，拥有最多的芯片资源，麦克风阵列算法性能最优：拥有立体声 AEC , DOA定位。同时代码开源，并且配置最多I/O资源。\n总结 以上的提供建议仅供参考，如仍困，可以整理项目需求，联系木瓜电子技术部提供专业的评估和选型。根据木瓜电子的芯片出货情况，可以大体看到，桌面会议系统使用XVF3000芯片，大屏视频通话使用XVF3500芯片。新开的项目需要做语音识别，我们都推荐使用XVF3510芯片。\n","description":"XMOS 多个麦克风阵列平台，其4麦阵列和2麦阵列的主要区别描述","id":10,"section":"notes","tags":null,"title":"XMOS 麦克风阵列选型说明","uri":"https://docs.pawpaw.ltd/notes/xmos_array_microphone_selection/"},{"content":"XMOS 麦克风阵列是否内置语音唤醒词（关键词）？ 答案是：否定的\nXMOS 现有麦克风阵列方案，如XVF3000, XVF3500 ,XVF3510等麦克风阵列都没有内置唤醒词（“keyword,关键词的叫法等同”），用户在设计语音识别产品时，需要用户在操作系统端设置语音唤醒词。下文简单阐述其中缘由：\n唤醒词的定制过程 唤醒词的定制过程涉及比较深的技术点，简单通俗地描述,\n1，基于唤醒词的声学频谱分布窗，初步唤醒词的算法模型\n2，跟进硬件载体的资源情况，确定唤醒词模型所需的RAM和算力大小，理论上，模型越大，识别率越高，所需资源越多。\n3，采集足够多唤醒词声音样本，且样本需要覆盖多样化，包括地域，年龄，性别等。\n4，使用样本激励原算法模型，使其更加适应样本的声学频谱特征，提高识别率\n5，误识别管制，加大管制和判断误识别，在识别率和误识别找出一个平衡点\nXMOS 自身原因 XMOS 麦克风阵列芯片XVF3000, XVF3500 ,XVF3510仅完成语音识别整个系统的前端减噪，回音消除，语音增强功能，并且前端算法和UAC/I2S/PDM接口后，所剩下的资源（算力，RAM）不多，没有办法再实现高质量唤醒词算法。\nXMOS 目前唤醒词定制平台仍未对外开放，所以没有办法完成用户所需的唤醒词定制\n语音识别的生态情况 做语音识别引擎平台，如国外的亚马逊，谷歌等，如国内的讯飞，百度，阿里，云知声等都具备定制唤醒服务，语言识别引擎提供SDK都能够引导用户去定制语音唤醒词。\n接入语音识别引擎平台时，往往需要操作系统运行这些引擎平台的SDK, 而唤醒词恰好运行在操作系统(linux, Android)中。\n在操作系统完成唤醒词的好处 操作系统有足够的算力资源能够支持更大模型的唤醒词模型，\n操作系统有友好的编程环境，第三方提供友好的SDK\n操作系统能够提供友好的VAD，以更好判断什么时候能够截至语音输入引擎平台API.\n而如果在前端减噪芯片去实现唤醒词，往往受限于DSP芯片资源限制，并且算法移植等编程语言限制等。在DSP下端完成VAD并不是一个理想的选择，最好是由语言识别引擎API完成。\n总结 如果使用XMOS 的XVF3000,XVF3500,XVF3510做语音识别交互的应用，用户需要考虑如果在操作平台完成唤醒词的设计。\n","description":"XMOS 麦克风阵列是否内置语音唤醒词（关键词）？","id":11,"section":"notes","tags":null,"title":"麦克风阵列方案没有内置关键词","uri":"https://docs.pawpaw.ltd/notes/why_microphone_array_no_keyword/"},{"content":"概要 PXUA08QF48 是 XMOS USB Audio 高性能和多功能评估板，主要实现了UAC 2.0(USB Audio Class 2.0)输出高清解析音频, 所用的XMOS 芯片为XU208-128-QF48-C10设计成 XMOS USB AUDIO 高性能方案。\nXMOS USB Audio 方案提供兼容全速和高速的USB 2.0接口的USB AUdiO 声卡设备，基于XU208-128-QF48, PXUA08QF48评估板支持UAC 2.0和UAC 1.0 ;在USB 2.0 异步模式中，能够支持高达768 KHz的采样率\nPXUA08QF48 使用分层设计方式, 开发板主要为数字部分,没有音频模拟部分, 提供USB , I2S , TDM , DSD , MIDI ,S/PDIF等数字接口,开发预留出两排排针,以吻合多功能使用, 可以搭配木瓜电子的ES9038Q2M评估板,也可以搭配其他高端DAC 如AK4497 ,CS43198等;\nPXUA08QF48 开发板能够实现USB声卡解码输出 768KHz 采样率和支持DSD Native; 同时支持多种数字音频接口和多个通道输入输出, 配套提供使用USB 进行更新的不同功能的多个固件, 能够协助用户进行USB Audio多种项目评估.\n版本    产品版本 修改 发布时间     PXUA08QF48-9018 V1 EOL(停产) 2017年6月13日   PXUA08QF48 V2 分层氏设计, 分离出模拟音频部分,可搭配多种模拟板 2018年5月19日    特点   支持USB Audio Class 2.0（UAC 2.0）\n USB 2.0 (Full-speed and High-speed) USB Audio Class 1.0 USB Audio Class 2.0 USB Firmware Upgrade (DFU) USB Midi Device Class 1.0    支持多种音频接口\n I2S/TDM S/PDIF ADAT Direct Stream Digital (DSD) PDM Microphones MIDI    支持多种音频采样率\n PCM: 44.1kHz, 48kHz, 88.2kHz, 96kHz, 176.4kHz, 192kHz, 352.8kHz, 384kHz，705.6kHz，768KHz DSD: DSD 64 ,DSD 128, DSD 256, DSD 512 DOP: DOP 64 ,DOP 128    支持最高16通道输入输出\u0026lt;=48KHz\n  UAC 2.0协议 ,支持ASIO ,支持多种操作系统，如Windows , Linux ,Android, MAC OS 和IOS等\n  规格   XMOS XU208-128-QF48-C10主控\n· 1000 MIPS 处理速度\n· 8个逻辑核心\n· QFN-48小封装\n  供电：USB 5V\n  尺寸：30mm x 40 mm\n  UAC 2.0 音频传输：\n· USB UAC 2.0 异步模式\n  功耗: 5V, 92mA （Max）\n  硬件概述  XMOS XU208 ：集成USB PHY; 8个逻辑核心， 128K RAM Micro USB : 提供5V电源，USB Audio, DFU 接口 SPI Flash : MX25L4006E ，存储XU208固件 XMOS XTAG ：XMOS专用调试工具XA-XTAG接口，采用2x5 1.27mm端子设计 XMOS GPIO : XU208扩展GPIO ,用于I2S/TDM, DSD , MIDI ,I2S 等用途  系统连接框图 应用场合  USB 高清解码（Hi-Fi音频） 专业录音声卡 多路麦克风采集  开始 第一次使用 通常情况下，用户拿到PXUA08QF评估板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXU08QF48评估板和Windows系统电脑，需要做初步设置和确认。如PXUA08QF48配套相应的模拟板，如ES9038Q2M可以后面再接入也可以。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXU08QF48评估板，并且打开声音控制面板进行设置\n确认设备管理器-\u0026gt;音频\nUSB Audio PXUA08QF48是否成功枚举，XMOS Pawpaw DFU 是否存在枚举,但是还没不能使用，需要安装UAC 2.0驱动。\n仅Windows系统系统需要按照UAC 2.0驱动，linux和MAC OS都不需要另外安装UAC 2.0驱动 安装驱动 Windows系统：\n评估板使用 USB Audio Class 2.0 作为传输协议，因此在window系统上需要安装第三方驱动，驱动压缩包是：\nUSB-Audio-Class-2.0-Evaluation-Driver-for-Windows_4.13.0.zip。\n压缩该文件后，得到的是一个.exe 文件，可以直接安装，进入安装过程中，默认安装即可。\n另外的一种安装方式是接着对该.exe 文件再一次进行解压得到文件夹，XMOS_TUSBAudio_eval_v4.13.0_2019-01-21_setup，我们使用里面的里面的setup_eval.exe 进行安装UAC 2.0驱动。\n文件夹的其大体内容为：\n确保评估板的USB已经和windows系统电脑，再点击运行上图文件夹了里面的setup_eval.exe 安装驱动程序。进入安装过程中，默认安装即可（一路点击 next，直接进行安装），UAC 2.0驱动安装完成后，windows设备管理器显示如图，则表示设备安装成功\n运行setup_eval.exe\n 确保评估板的USB已经和windows系统电脑 默认安装即可（一路点击 next，直接进行安装） 安装完成了后，则会出现类似如下图片显示 评估板在设备管理器上枚举成了 XMOS USB 2.0 Audio Devices-\u0026gt;XMOS XS1-U8 DJ(EVAL)  在声音界面进行设置和确认,\n1，在播放栏项，设置XMOS XS1-U8 DJ(EVAL)为默认设备\n2，在录制栏项，设置XMOS XS1-U8 DJ(EVAL)为默认设备，如果更新的固件支持录制的话，同时确认播放和录制栏项的音频格式设置为一致，\nLinux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n其中测试板UAC驱动会有个BUG在驱动程序中，体现的现象为评估板每次插入windows电脑，运行超过1个小时后，每隔5分钟会有一个TUNE声。用户量产XMOS的UAC2.0方案需要自行购买Windows 系统第三方UAC2.0 ASIO驱动则无该问题。 固件和DFU升级 如果PXUA08QF48评估板的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n配套固件 评估板配套提供了多个固件，主要是USB的音频的采样率作为区别，参考下表。其中固件命名遵循XMOS USB audio 针对固件的命名方式：\n Audio Class: 1 or 2\nInput enabled: i (channelcount)\nOutput enabled: o (channelcount)\nMIDI enabled: m, disabled: x\nSPDIF out\tenabled: s, disabled: x\nSPDIF in enabled: s, disabled: x\nADAT out\tenabled: a, disabled: x\nADAT in\tenabled: a, disabled: x\nDSD out\tenabled: d, disabled: x\n To be continued !\n","description":"PXUA08QF48 评估板的使用, 其固件内容,以及DFU升级说明, 介绍USB AUDIO框架等","id":12,"section":"docs","tags":null,"title":"PXUA08QF48_硬件使用","uri":"https://docs.pawpaw.ltd/docs/pxua08qf48/pxua08qf48_usage/"},{"content":"概要 PXVF3000-KIT针对XMOS的XK-VF3100-C43 开发板进行硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-VF3100-C43 开发板，所用的DSP芯片为XVF3000，设计成等距圆形4麦阵列。\nPXVF3000-KIT为4麦阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nPXVF3000-KIT内置了单声道回音消除（AEC） , 波束成型（BF），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入桌面会议产品中。\n版本    产品版本 修改 发布时间     PXVF3000-KIT V1 EOL(停产) 2017年10月20日   PXVF3000-KIT V2 重新修改设计，简化其他硬件，且去掉蓝牙 2020年11月15日    特点   远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB HID 调试和USB DFU升级\n  4路圆形麦克风阵列\n  支持3.5mm耳机孔作为播放输出\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, Mono, Acoustic Echo Cancellation(AEC)\n· Beamforming(BF)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3000 主控，内置4麦圆形阵列算法\n  4路PDM 数字麦克风：SPK0641HT4H\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64.5 dBA\n  供电：USB 5V\n  尺寸：70mm（Circle）\n  USB播放-\u0026gt;3.5mm耳机孔模拟line-out\n· DAC: ES7154\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入输出，USB播放信号经过XVF3000作为AEC参考信号\n· 采样率：16KHz/48KHz\n  功耗: 5V, 180mA （Max）\n  硬件概述  XMOS XVF3000 ：集成了UAC1.0和4 MIC阵列算法，包含了单声道回音消除（mono AEC） , 波束成形（BF），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 DAC ES7154：USB 声卡（UAC1）音频输出解码芯片 XMOS XTAG：XMOS专用调试工具XA-XTAG接口 Phone-jack：DAC的芯片的line-out 3.5mm耳机孔 MIC0~4：PDM 数字麦克风，圆形等距分布  系统连接框图 尺寸 应用场合  桌面会议（Comms） 医疗设备（ASR） 智能管家（ASR） 智能机器人（ASR）  开始 第一个Demo 通常情况下，用户拿到PXVF3000-KIT PCBA板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXVF3000-KIT和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXVF3000-KIT，并且打开声音控制面板进行设置\n确认设备管理器-\u0026gt;音频输入和输出是否存在\nXMOS VoclalFusion SPK(uac1.0)是否成功枚举，PXVF3000-KIT作为USB Audio Class 1.0设备\n关于 于XMOS Control可以在后面需要调试时在安装驱动，初次使用时可以先跳过 在声音界面进行设置和确认\n1，在播放栏项，设置XMOS VoclalFusion SPK(uac1.0)为默认设备\n2，在录制栏项，设置XMOS VoclalFusion SPK(uac1.0)为默认设备\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nDemo 和录音 使用Audacity）第三方开源录音软件在Windows系统进行录音设置，接着使用Audacity录音。\nPXVF3000-KIT出厂默认固件为USB输入6ch 16kHz采样率处理后的声源，其中ch0为Comms信号，ch[1-4]为mic[0-3] 麦克风的原始信号，ch5为回音消除的参考信号。\n在通常的操作系统中，系统都会默认使用ch0作为ASR或者Comms来当作麦克风输入，所以PXVF3000-KIT输入6ch并不会影响实际上的使用。 在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n固件和DFU升级 如果PXVF3000-KIT的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n安装驱动 Windows系统：\nPXVF3000-KIT在操作系统中都能识别成XMOS VoclalFusion SPK(uac1.0)作为声卡输入输出，而Windows系统中的设备管理器显示的XMOS Control需要安装USB驱动，才能使用XMOS提供的dfu_usb工具进行升级和vfcrtol_usb工具进行DSP 参数控制。推荐使用第三方工具zadig进行安装XMOS Control的USB驱动。\n运行zadig，\n 在列表中选择 XMOS Control (Interface 3) 然后选择 libusb-win32 点击 Reinstall Driver 安装完成了后，则会出现类似如下图片显示  Linux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n固件列表 这里配套提供了7个固件，主要是USB的音频的通道数，算法方向和采样率作为区别，参考下表。\n   Firmware channel ch0 ch1 采样率 Description     app_vf_spk_base_cir32_1i1o2.dfu 1 Comms - 16000Hz Comms output   app_vf_spk_base_cir32_1i1o2_48khz.dfu 1 Comms - 48000Hz 48kHz Comms output   app_vf_spk_base_cir32_1i1o2_asr.dfu 1 ASR - 16000Hz ASR output   app_vf_spk_base_cir32_1i2o2.dfu 2 Comms ASR 16000Hz ch0:Comms; ch1:ASR   app_vf_spk_base_cir32_1i2o2_48khz.dfu 2 Comms ASR 48000Hz ch0:Comms; ch1:ASR   app_vf_spk_base_cir32_1i6o2.dfu 6 Comms mic-0 16000Hz default firmware ch0:Comms; ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref;   app_vf_spk_base_cir32_1i6o2_asr.dfu 6 ASR mic-0 16000Hz ch0: ASR ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref;    DFU升级 Windows系统：\nPXVF3000-KIT使用USB进行DFU升级的工具为dfu_usb.exe，打开cmd命令行终端工具，cd进入pvf3000/xvf3000_dfu文件夹，键入如下指令或者或者复制其中对于固件的指令进行运行。\ndfu_usb write_upgrade ../firmware/app_vf_spk_base_cir32_1i1o2.dfu\r执行完之后，打印出一下信息说明固件DFU升级成功\n Attempting to connect via USB: connected\rSending file size: 0x24600 padded to 0x24600\rWritten bytes: 0x24600\rdone\r其他操作系统如Mac OS和Linux的使用Terminal，键入指令和打印的内容一致。DFU升级成功后，需要对板子重启或者重新上电\ndfu_usb reboot\r在通常情况下，在windows系统DFU升级成功后，PXVF3000-KIT会遇到无法录制使用，问题可以在[FAQ](# FAQ):Q2找到答案 在其他操作系统\n需要提前编译出dfu_usb工具，进入路径pxvf3000/xvf3000_dfu/host/xmosdfu，然后执行同上的dfu_usb指令，可以得到同样的结果\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rDSP control 在线调试 上文提供的所有固件都是使用XMOS Vocal Fusion默认的DSP参数，其实PXVF3000-KIT也支持在线调试麦克风阵列DSP 算法参数。使用DSP Control工具为vfctrol_usb（exe）。在进行在线调试工作前，建议用户认真阅读XMOS的文档资料XVF3000-3100-DSP-Databrief。足够了解麦克风阵列相关算法名称和DSP 参数，才方便进行在线调试。并且下文描述内容跟XMOS提供的文档一致。\n以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值\nAcoustic Echo Cancellation (AEC)\nBeamforming(BF)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 windows系统\n确保PXVF3000-KIT在设备管理器中的XMOS Control驱动已经安装（仅windows系统需要）\nwindows系统，运行cmd，并且cd进入pxvf3000/xvf3000_control，键入类似指令以运行vfctrol_usb，便可进行在线调试\nvfctrl_usb MIN_NS\r打印输出的信息如下：\nMIN_NS:0.15\r其他操作操作系统运行Terminal终端，但是同时需要提前编译出vfctrol_usb工具，进行同样的操作即可。cd进入路径pxvf3000/xvf3000_control/host/control。\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rXVF3000里面有很多DSP参数可配置，用户根据XVF3000-3100-DSP-Databrief的介绍，可以实现通过USB HID（XMOS Control）进行在线调试参数\n在线调试的参数仅存在XVF3000 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 资源下载 PXVF3000-KIT.zip全部的资料(点击下载)\n支持和商务 PXVF3000-KIT支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：pxvf3000@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: 回音消除怎么使用\nPXVF3000-KIT的AEC的参考信号只有一个路径，即通过USB当作播放声卡，声音经过XVF3000时会保留AEC参考信号在XVF3000 RAM中，已实现AEC参考信号的提供。\nQ2: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上PXVF3000-KIT和windows PC，运行usbdeview，点击Connected栏项以列出XVF3000相关枚举情况；逐一选择XVF3000的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\n同时确保windows系统的声音面板的播放栏项和录制栏项音频格式设置为一致，并且建议关闭录音软件，再重新运行录音软件。\nQ3：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了PXVF3000-KIT和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\n","description":"介绍PXVF3000-KIT评估板的硬件参数，应用场景，性能和功能，协助用户第一次使用PXVF3000-KIT进行项目评估，和如何DFU更新固件，以及使用vfctrl进行麦克风阵列算法调整","id":13,"section":"docs","tags":null,"title":"PXVF3000-KIT_硬件使用","uri":"https://docs.pawpaw.ltd/docs/pxvf3000-kit/pxvf3000-kit_usage/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT，且查阅PXVF3000-KIT_硬件使用 已详细了解XVF3000 内置的前端算法AEC , BF , NS, AGC,，且已查阅PXVF3000-KIT_dsp_描述 已查阅本站XVF3000项目实施落地 已查阅了XVF3000的datasheet和参考设计 已确认XMOS XVF3000 4路麦克风阵列方案性能可满足导入项目产品中  XVF3000 datasheet 导读 查看XVF3000-3100-TQ128-Datasheet_15.pdf，其描述的为xvf3000裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（0 °C to 70 °C） TQ128 封装 580mA典型工作电流，700mW左右（固件运行） 内置了16Mbit QSPI Flash I/O 驱动能力为4mA  电源 根据datasheet的最小系统框图，XVF3000的需要两路电压供应，3V3和1V0, 其中3V3提供给I/O, USB , Flash等外设使用，1V0提供给XVF3000逻辑核心使用。\n其两路电压时序要求为3V3先上电，稳定后，1V0后上电。\n复位检测 XVF3000需要外部有复位检测芯片，可以选择单独侦测 3V3或者1V0，以避免在电压不正常时，芯片无法复位来运行固件。\nQSPI Flash XVF3000内置了QSPI Flash（IS25LP016D），其主要是存储XVF3000固件，所以XVF3000项目得预先烧录固件才能启动运行4路麦克风阵列算法。使用QSPI Flash烧录器烧录XVF3000需要配置QE=1的烧录方式。\nBOOT MODE XVF3000的由QSPI Flash启动，根据框图连接XVF3000和Flash时，需要确保X0D01上拉1K电阻，以实现boot mode是由XVF3000芯片读取加载内部的QSPI Flash固件。\nI/O 映射 XVF3000的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子或者XMOS官方提供的的原理来选择使用特定的I/O map。\n时钟信号 XVF3000外部需要24MHz有源晶振接入作为启动晶振，接入到CLK 引脚，而音频时钟16KHz 和48KHz采样率仍需要一个外部的12.2888MHz音频时钟或者晶体接入作为I2S或者PDM麦克风的MCLK时钟使用。\n原理图和PCB 根据我司或者XMOS官方的提供的参考原理，结合XVF3000的datasheet最小系统。用户可以比较轻易完成XVF3000的最小系统设计，包含了电源，时钟，启动上拉等。\n原理图设计 USB 接口设计 在XVF3000 圆形4路麦克风阵列方案中，USB接口除了提供5V电源供应，仍需要用来作为音频传输，DFU固件，vfctrl调试参数。\nXVF3000 芯片内部集成了USB PHY收发器，可以直接使用芯片引脚USB_DM,USB_DP,USB_VBUS,USB_RTUNE连接外部USB端子。\n遵循XVF3000 datasheet说明，USB的设计分为USB供电或者外部电源作为XVF3000芯片供电两种情况，如图为USB作为整个XVF3000系统供电原理设计\n根据XVF3000 datasheet的描述\n USB_RTUNE 需要下拉43.2 R电阻 USB_VBUS 和USB_ID 不能连接，需悬空 USB_VBUS提供5V给DC-DC 转换3V3和1V0电源提供给XVF3000和外围芯片 因为XVF3000 的ESD压力为2KV,建议用户在USB端子设计加入ESD保护电路芯片  如内部有电池或者外部供应5V给整个电源系统，则USB_VBUS的设计需要参考XVF3000 datasheet（page 19）的USB_VBUS设计。\n The 10k series resistor and 0.1uF capacitor ensure than any input transient is filtered and does not reach the device. The 47k resistor to ground is a bleeder resistor to discharge the input capacitor when VBus is not present. The 1-10uF input capacitor is required as part of the USB specification. A typical value would be 2.2uF to ensure the 1uF minimum requirement is met even under voltage bias conditions\n 如用户决定使用XVF3000使用I2S输入输出来连接host主控（ARM,BT,WiFi等芯片）代替USB作为音频传输，同时强烈建议前期保留USB端子以便进行dfu_usb和vfctrl_usb使用。后期确定量产时再去掉USB部分。\n电源设计 XVF3000 内部无DC-DC和LDO集成，需要外部提供3V3和1V0的供电。其中3V3提供给XVF3000及其集成的部分的 I/O供电，1V0供应XVF3000核心及其集成组件的核心使用。查看datasheet的Example Application Diagram的框图，得到XVF3000电源的需求情况。\n3V3 供应部分\n3V3电压范围（3.135 ~ 3.465 V）\n VDDIO (3V3) : Digital I/O power (left,right,top), VDDIOL,VDDIOR,VDDIOT OTP_VCC (3V3) :pins for OTP USB_VDD33 (3V3) : USB Analog power,analog supply to the USB-PHY  1V0 供应部分\n1V0电压范围（0.95 ~ 1.05 V）\n VDD pins (1V0)：Digital tile power ，for the core logic PLL_AVDD (1V0) : Analog power for PLL, pins for the PLL USB_VDD (1V0) : USB Digital tile power , supply to the USB-CORE  查看datasheet的Power Consumption 部分得到XVF3000的核心供电需求电流为580 mA左右（700mA MAX）, 确保DC-DC电源芯片1V0输出需要大于700mA，建议值1A的输出能力,且不能使用LDO电源芯片输出1v0,导致损耗过大。\n根据datasheet所述的3V3和1V0的上电时序要求，我们建议整体电源设计的时序为3V3先上电，然后使能（enable）1v0后上电\n其电源设计如下图，其中\n 3V3由5V DC-DC转换得到，3V3先稳定后，使能另一个DC-DC转换得到1V0 ; 形成 3V3先上电，1V0后上电的时序 3V3和1V0分别供应相应的电源输入引脚，尽量保证每个电源输入引脚有个104的滤波电容，且这些电容在layout的时候，尽量靠近相应的电源引脚。 pin 50 和 pin 65 必须悬空，不能接任何电气 PLL_AVDD 需要一个高品质的电源，在PLL_AVDD引脚加入RC 低通滤波器，且在layout的时候，4R7电阻和104电容需要尽可能靠近PLL_AVDD引脚  系统设置 XVF3000外围需要两个有源晶振，24 MHz 和 12.288 MHz。24 MHz时钟为XVF3000起振时钟，提供给内部PLL产生芯片主频，24 MHz有源晶振输出接入XVF3000的CLK 引脚。12.288 MHz时钟为XVF3000核心（Tile 0 和Tile 1）处理音频传输协议需要的音频时钟，XVF3000核心将12.288 MHz进行分频，分别生成I2S 的 LRCLK , BCLK 和 PDM 协议的CLK。 所以12.288 MHz作为MCLK分别输入到XVF3000 的pin 62(芯片定义该引脚为X0D12，即Tile 0的1E 端口) 和 pin 20（芯片定义该引脚为X1D38,即 Tile 1的1o端口）\nXTAG接口为XMOS专用的调试和烧录工具，XVF3000内置了QSPI Flash（IS25LP016D），XVF3000需要下使用XTAG烧录factoy固件了后，XVF3000才能正常运行麦克风阵列算法，在原理设计时，需要引出XTAG和QSPI Flash的烧录接口，以便样机或者量产时烧录XVF3000固件。\nXVF3000外部需要有个复位检测芯片，避免供电电压不正常时导致固件运行紊乱，根据datasheet的描述，其复位时间必须为1ms~10ms之间的拉低时间\n If your design is powered by VBUS,then RST_N should go high within 10 ms of attaching to VBUS in order to ensure that USB timings are met. RST_N should be at least 1 ms after VDDIO good to enable the built-in flash to settle.\n 其整体设计为, 其中：\n XTAG 建议接一个2x5 1.27mm的母座端子引出，方便烧录和调试,且脚位排序不变 flash point是引出使用QSPI Flash烧录器进行PCBA的方式烧录测试点。烧录前需要接5V和GND，并且RST_N拉低以确保XVF3000在烧录过程中处于复位状态。如果不是PCBA的烧录方式，不需要保留flash point这些测试点 XVF3000 pin 27需要上拉1K电阻, 确保XVF3000上电时访问的是内部的QSPI Flash 12.288 MHz有源晶振时钟分出3路时钟，分别提供Tile 0，Tile 1和Codec作为MCLK使用，如果PCBA板子布线较长，建议加个buffer logic器件加以增大驱动能力  音频I/O XVF3000 支持多路PDM麦克风，但是XMOS官方vocal Fusion算法仅支持4路麦克风阵列算法。多路PDM麦克风接口复用1个clk 时钟信号线，以确保多路麦克风信号高一致性。多路麦克风data信号线各自独立，不分L/R时序。L\nXVF3000 支持2路I2S 接口，其I2S协议为标准I2S, 64fs, 有效位可以实现16bit/24bit。 如果I2S连接ADC或者DAC, 则XVF3000 的I2S为master模式 ; 如果XVF3000 连接蓝牙/wifi/CPU, 则XVF3000都可以选择master/slave模式。两路I2S都复用MCLK , LRCLK , BCLK。\n其中XVF3000的音频接口PDM和I2S的时钟频率为：\nPDM_CLK: 3.072 MHz\nI2S_MCLK: 12.288 MHz\nI2S_BCLK: 1.024 MHz(@16KHz sample rate) I2s_LRCLK: 16 KHz(@16KHz sample rate)\nXVF3000的DAC和ADC选型设计，根据用户项目框架的需要，参考本站XVF3000项目实施落地的应用框架而确定是否都需要ADC和DAC的设计。XVF3000仅支持mono AEC（单声道 回音消除），在DAC或者ADC设计时，仅需要使用DAC的右声道输出（Right channel output）和ADC的右声道输入（Right channel input）。\n选择相应的DAC和ADC需要吻合XVF3000的I2S时序，且尽量免I2C配置，为I2S自适应的Codec，避免XVF3000固件有过多的I2C配置造成软件工程师过多投入。\n其整体设计如下图，其中\n  每个所用到的I/O都是XVF3000软件定义，由于需要配合现成的固件，所以I/O不建议更换\n  4个PDM 麦克风的LR 都需要统一拉低接地。如成本允许，单独生成3V3A干净电源提供给麦克风供电。\n  PXVF3000-KIT评估板麦克风布局为32mm的半径圆形均匀分布，如需其他圆形尺寸，麦克风的间距不小于30 mm,其最大间距由TTL受干扰限制，不建议太大，XVF3000 I/O驱动能力仅为4mA。如更改了圆形尺寸，需要通知固件方修改软件以匹配阵型\n  用户根据项目框架需要是否DAC，XVF3000仅支持mono AEC, 且DAC在右通道输出（Right channel output）\n  用户根据项目框架需要是否ADC，XVF3000仅支持mono AEC, 且ADC在右通道输入（Right channel input）,并且模拟参考信号（analog AEC ref）在播放的运放前端接入，同时建议设计分压电路，查看ADC的满框输入水平（Full Scale Input Level ）,以确定分压值\n  用户尽量选择免I2C配置的ADC和DAC，选择I2S自适应的Codec，则不需要通知固件方进行I2C配置来吻合XVF3000的I2S协议和驱动Codec\n  控制I/O XVF3000固件内部仍有小些逻辑控制资源，可以实现控制LED，按键等功能。LED的控制主要是为了实现XVF3000圆形麦克风阵列DOA（声源定位）和VAD(人声检测)指示使用，XVF3000仅支持12个LED来显示360度方位，分辨率为30度。固件的麦克风阵列算法精度取决于4路麦克风阵列信号的一致性以及阵列麦克风的几何坐标参数是否在固件有足够精准。\n按键控制建议仅用在麦克风的静音（MUTE信号）。如功能上需要用到麦克风静音功能，建议在4路PDM复用的CLK引脚加上逻辑器件，实现电气上的静音。\n其整体设计如下图，其中\n  LED12为VAD（人声检测）指示使用，建议单独放在圆形中间或者靠边地方，LED[0`11]为角度方位使用，并且建议顺时针圆形分布，需要告知固件方使能VAD且修改固件实现正确的方位指示。如不需要LED指示，可全部去掉\n  MIC_CLK拉高拉低都可以实现麦克风信号静音（MUTE）,这里建议用户增加逻辑logic器件来实现物理上MUTE。不建议在XVF3000固件来时间音量+，音量—，会涉及投入比较大的固件开发。如需要，建议直接控制运放。\n  检查表 Check List 框架检查  USB 需要做保留设计，无论是是否有使用I2S作为音频传输，USB的dfu_usb和vfctrl_usb仍需要使用 XVF3000的XTAG设计建议使用2x5母座端子，间距1.27mm；或者2x10的2.54mm的母端子，避免留出测试点接线麻烦的方式。木瓜电子可提供转接板，同时用户需要购买XTAG烧录器 XVF3000内置了QSPI Flash，需要考虑到批量生产的烧录操作，设计前需要确定好是选择PCBA烧录还是裸片烧录，以便留出flash point相关测试点，同时确保使用QSPI flash烧录方式QE=1的配置烧录 确认好AEC ref的提供给XVF3000的方式，以便确认是否ADC和DAC  原理图和PCB检查  查阅XVF30000的datasheet的Check list(page 72) 查阅XVF30000的VocalFusion Speaker Hardware Manual.pdf 复位芯片是必须要的，可以选择侦测3V3和1V0 麦克风layout布局，建议每个麦克风间距不小于30mm Layout时，USB型号尽量并行走线且不靠近I2S/PDM的时钟线 Layout时，需要考虑量产时，麦克风需要加上密封胶套来配合结构外壳，达到声学要求  PCBA问题排查 USB不能正常枚举出声卡设备\n 确认硬件的电源3V3和1V0是否正常; 确认24 MHz时钟正常进入XVF3000; 确认复位检查芯片是否拉住了XVF3000的复位 确认XVF3000是否已有固件；确认使用QSPI Flash烧录器烧录固件时，配置QE=1，并且烧录时已把配置烧录进去。XVF3000已烧录固件时，板载5V电源会在大于150mA  判断麦克风是否良好\n 烧录或者dfu_usb一个6通道固件，把麦克风原始信号在audactiy录制查看，或者使用AP分析  AEC 性能不好\n 如是模拟参考信号到ADC提供给XVF3000的方式，确认ADC接收到的模拟参考信号是否正常，是否为右声道输入，是否有作为分压输入水平不超过ADC的满框输入水平 如是USB提供参考信号给XVF3000的方式，确认是否是右声道输出给喇叭。 确认整个过程中喇叭和麦克风的相对位置没有任何变动 确认喇叭到麦克风声压不大于100dB 确认麦克风有足够好的密封性  服务 XVF3000的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计（PXVF3000-KIT 评估板），XVF3000 datasheet和VocalFusion Speaker Hardware Manual文档完成设计。\n木瓜电子可以为用户提供XVF3000 固件，整体设计如有技术问题，可以发邮件发pxvf3000@pawpaw.hk咨询。\n木瓜电子可以提供XMOS XVF3000 , 麦克风和Code芯片供应服务。\n","description":"介绍XVF3000硬件设计，涉及到sch和PCB方面的内容，包含XVF3000最小系统，AEC的ADC，DAC设计，4路麦克风阵列摆放，以及麦克风阵列量产指导","id":14,"section":"docs","tags":null,"title":"XVF3000硬件设计","uri":"https://docs.pawpaw.ltd/docs/pxvf3000-kit/xvf3000_hw_deseign/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT 已详细了解XVF3000 内置的前端算法AEC , BF , NS, AGC等 已使用PXVF3000-KIT已经通过vfctrl_usb工具调试出理想的参数 已确认XMOS XVF3000 4路麦克风阵列方案性能可满足导入项目产品中  概要 使用XVF3000作为圆形4麦阵列方案的主控，需要了解硬件设计和软件设计，结合结构设计，才能使得产品顺利落地。并且根据我司现有的XMOS麦克风阵列方案，建议使用XVF3000来做桌面会议产品(Comms 方向)\n如需要做语音识别（ASR方向）建议使用我们2麦阵列方案XVF3510方案。 XVF3000项目导入前，根据下文的描述需要了解以下几点:\n XVF3000的硬件框架的确定 熟悉USB的对产测和测试的作用 XVF3000的固件获取, 烧录和更新 XVF3000 DSP算法参数 麦克风阵列的外壳结构的声学设计 XVF3000的产测需具备的设备和测试的流程 XVF3000过认证需要提前准备的工作  XVF3000 硬件基本框架 XVF3000芯片基本特性如下:\n 商用温度等级（0 °C to 70 °C） TQ128 封装 580mA典型工作电流，700mW左右（固件运行） 内置了16Mbit QSPI Flash I/O 驱动能力为4mA 订购型号：XVF3000-TQ128-CA； 丝印：VSM01C  XVF3000 硬件系统最小系统如下图。XVF3000 圆形4路麦克风阵列根据音频传输接口的不同，大体分为如下三种硬件框架。用户根据项目需求选择其一，并且以确定硬件上是否需要设计ADC和DAC。\n使用USB连接Host | USB_in\u0026amp;out Host主机的音频传输都通过XVF3000的USB来输入输出，XVF3000作为一个USB Audio声卡设备，产品应用一般为外置的拾音设备。\n其框架如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host播放声音时通过USB声卡播放输出，XVF3000为声卡设备，XVF3000的AEC参考信号在USB协议音频传输过程中获取 XVF3000 USB UAC1.0包含传输音频输入输出、vfctrl_usb和dfu_usb，UAC输入输出的音频格式为16KHz/48KHz\n  使用USB连接Host | Analog_ref XVF3000通过USB输入声音给host主控，Host主控提供模拟AEC参考信号给XVF3000。\n其框架如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host提供播放声音的参考信号给XVF3000做回音消除的参考信号，ADC采集Host端的模拟声音传输给XVF3000 XVF3000 USB UAC1.0包含传输音频输入、vfctrl_usb和dfu_usb，UAC输入的音频格式为16KHz/48KHz  使用I2S连接Host| I2S_in\u0026amp;out 该框图不常用，仅推荐XVF3000需要连接WiFi/蓝牙时使用，并且建议Host(无线模组)的I2S需要做I2S slave模式，因为XVF3000需要音频时钟做16KHz的音频算法处理\n其框图如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过I2S接口输入给Host Host提供播放声音的参考信号给XVF3000做回音消除的参考信号，Host通过I2S传输给XVF3000 I2S协议要求16KHz/48KHz 16bit，64fs, 标准I2S，其两路I2S共用时钟线MCLK，BCLK，LRCLK 预留USB接口，方便工程样机的调试和产测。  XVF3000 固件基本框架 ASR 和 Comms 的选择 XVF3000 固件麦克风阵列算法DSP 运行后，可同时提供两路前端处理后的声音信号输出，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。用户根据产品需求，可以选择ASR信号和Comms信号同时输出，或者选择其中一个输出。\nASR\nASR信号主要是用于语音识别，接入类似Alexa等各大语音识别引擎平台，做语音交互使用。ASR信号整体的特征是人声清晰，频谱比较丰满，降噪系数较小，以满足语音高识别率。\nComms\nComms信号主要是用于会议通话使用，类似接入微软的teams, skype和企业微信或者钉钉等会议产品使用。Comms信号整体的特征是底噪比较小，由于降噪系数比较大，其频谱比较干净明显。\nAEC参考信号选择 XVF3000仅支持mono（单声道）参考信号，固件中默认选择立体声中的右声道(Right channel)作为AEC的参考信号，所以产品中的喇叭建议使用1个喇叭，或者2个喇叭都由右声道(Right channel)输出。AEC回音消除所需要的参考信号有两种方式提供给XVF3000\n选择 USB UAC 提供AEC参考信号\nUSB UAC作为声卡播放的时候，播放的声音信号经过XVF3000时，XVF3000已经copy了参考信号提供给AEC算法模块使用。但是，后级的DAC和功放都需要保持线性输出，喇叭播放出的声音不能有EQ处理。如有EQ处理，则喇叭播放出来的声音跟已提供的参考信号已经失去了线性的对比，结果会导致AEC性能发挥不好。\n选择 I2S(ADC)模拟提供AEC参考信号\n需要增加I2S接口接入数字参考信号或者增加ADC接入模拟参考信号提供给XVF3000 AEC算法模块使用。建议在功放前选择右声道信号提供给ADC。同理，功放后级不能有EQ处理。\n烧录方式的选择 XVF3000芯片可以使用XMOS专用XTAG进行烧录，也可以使用QSPI flash 烧录器进行PCBA烧录和裸片烧录factory固件。同时可以通过dfu_usb工具更新dfu固件。根据产线实际情况，进行评估和选择。\n木瓜电子通常会提供3种后缀命名的固件，分别为xxx.xe, xxx_factory.bin和xxx.dfu。这三者中，xxx.xe和xxx_factory.bin都统称为factory固件，xxx.dfu称为更新固件。其中\n xxx.xe固件由XMOS IDE编译生成，仅能通过XTAG调试工具烧录到XVF3000芯片，其烧录时间上，效率很低。 xxx_factory.bin固件由xxx.xe通过XMOS IDE导出，仅能通过spi flash烧录器烧录，效率较高。 xxx.dfu更新固件由xxx.xe通过XMOS IDE结合QSPI Flash型号信息来导出，仅能通过USB dfu_usb工具进行更新固件。更新固件后，需要重启XVF3000才会正常运作更新后的固件。  使用dfu_usb工具进行更新固件的前提是:XVF3000已经烧录了factory固件，XVF3000能够正常运作，USB能够在操作系统枚举成功， xxx.xe的烧录方式 用户需要拥有XMOS的专用XTAG调试工具，并且下载和安装xTimecomposer IDE。\n运行其Command prompt 工具，确保上电XVF3000硬件和接好XTAG，键入指令如下, Enter键后，查看XVF3000和XTAG是否握手成功\n1  xflash -l   键入类似如下的XTAG指令，Enter键后烧录完毕即可\n1  xflash xxx.xe   xxx_factory.bin的烧录方式 无论是XVF3000板载烧录还是裸片烧录，都需要留出XVF3000的flash point，以便spi flash烧录器能够访问XVF3000内置的QSPI Flash。同时需要确保XVF3000的3V3和1V0供电正常，并且XVF3000的RST_N引脚提前拉低，确保XVF3000在整个烧录过程处于复位状态\n用户需要拥有支持QSPI Flash芯片的flash烧录器，在其上位机选择使用QE=1的烧录方式，操作参考下图：\n 检测芯片型号或者选择IS25LP016D(旧版本的XVF3000内置flash的信号为IS25LQ16B) 加载xxx_factoy.bin固件 打开配置选项 选择QE=1,后确定 勾选写入配置 开始烧录  固件开发 木瓜电子可以为用户提供factory固件和DFU更新固件，用户采购一些XVF3000样品，可以申请由木瓜电子预烧录factory固件，在样机阶段，都可以使用DFU进行更新固件。\n如用户需要整个固件源代码，可以在XMOS官网下载，或者发邮件到pxvf3000@pawpaw.hk向木瓜电子申请。提供源代码之后，客户结合文件包内的文档和XMOS官方的文档自行编程，木瓜电子不考虑在XVF3000的代码问题上提供技术解答。\n声学要求 XVF3000 圆形麦克风阵列的DSP性能跟声学和结构设计有很大关系。在硬件设计前，须提前先了解声学设计的要求。PDM MEMS麦克风有两种拾音孔，分为顶部拾音和底部拾音，这两种麦克风的声学电气特性几乎一致。XVF3000 算法对麦克风电气参数要求不高，通常选择的特性在如下范围左右即可\n Sensitivity: -26 dB FS SNR: 64 dBA AOP: 120 dB SPL  麦克风密封性 密封主要是为了确保麦克风的拾音孔仅在结构外壳的拾音腔孔获取外界的声音，避免声音进入到结构内部来回反射产生较严重的混响。声学设计参考下图\n在硬件设计时，需要提前考虑麦克风的密封性的设计，通常产品是增加密封胶套来实现密封性能，并且在硬件上需要预留密封胶套的位置以吻合产品结构声学需求。\n麦克风避震性 避震主要是为了喇叭播放声音时音腔产生的震动不传导到麦克风板，进而避免影响麦克风的拾音。建议在设计喇叭音腔跟麦克风有足够的距离，并且有绝对的隔绝。\n麦克风声压 麦克风的AOP通常在120 dB左右，如果声音信号超过该值，则会导致麦克风拾音出现截幅，导致声音失真。\nXVF3000的AEC性能做到最高50dB抑制，建议喇叭的声音在麦克风端录音不超过100dB。 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。体现的结果是AEC性能不好\n喇叭和麦克风尽量避免同一朝向，建议形成90度或者180度的朝向\n麦克风一致性 4路麦克风拾音信号需要保持高一致性，在组装结构外壳是，需要统一录制4路麦克风原始信号，进行分析去一致性，重点是体现在幅值和频谱特性。\n4路麦克风信号的一致性要求为整个XVF3000项目的基本要求，阵列麦克风才能发挥其应有的性能\n产线测试 XVF3000导入试产量产阶段,须要确认产线具备XVF3000烧录以及录音测试。设计XVF3000烧录固件的治具,预留出的flash point能够访问XVF3000进行flash写入。建议使用6通道的固件, 确保4个麦克风正常运作,以及做信号一致性分析。\n ch0:Comms; ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref\n 在确定无硬件问题之后,使用dfu_usb更新最终的1通道或者2通道的dfu固件以实现最终产品。\n ch0:Comms; ch1:ASR\n 产品过认证 XVF3000解决方案能够通过Alexa 的ASR认证和微软的Skype等Comms认证。如产品确定需要过认证, 在产品处于basic版本时, 用户需要有足够熟悉和了解XVF3000 DSP的参数以及阵列的各项知识。根据认证产商的要求, 在产品调整XVF3000 DSP参数以实现过认证。由于每个产品的声学结构都会影响XVF3000 DSP参数的指示, 所以木瓜电子无法在认证方面提供XVF3000 的DSP 参考值,并且不参与整个过认证流程。\n","description":"XVF3000项目导入落地实施步骤，了解硬件设计，固件设计，功能选择，以及量产测试等指引","id":15,"section":"docs","tags":null,"title":"XVF3000项目导入","uri":"https://docs.pawpaw.ltd/docs/pxvf3000-kit/xvf3000_project_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了pxvf3500-KIT 已详细了解XVF3500 内置的前端算法AEC , BF , NS, AGC等 已使用pxvf3500-KIT已经通过vfctrl_usb工具调试出理想的参数 已确认XMOS XVF3500 4路麦克风阵列方案性能可满足导入项目产品中  概要 使用XVF3500作为线条形4麦阵列方案的主控，需要了解硬件设计和软件设计，结合结构设计，才能使得产品顺利落地。并且根据我司现有的XMOS麦克风阵列方案，建议使用XVF3500来做视频通话产品(Comms 方向)\n如需要做语音识别（ASR方向）建议使用我们2麦阵列方案XVF3510方案。 XVF3500项目导入前，根据下文的描述需要了解以下几点:\n XVF3500的硬件框架的确定 熟悉USB的对产测和测试的作用 XVF3500的固件获取, 烧录和更新 XVF3500 DSP算法参数 麦克风阵列的外壳结构的声学设计 XVF3500的产测需具备的设备和测试的流程 XVF3500过认证需要提前准备的工作  XVF3500 硬件基本框架 XVF3500芯片基本特性如下:\n 商用温度等级（0 °C to 70 °C） FBGA 167 封装 685mA典型工作电流，1W左右（固件运行） I/O 驱动能力为4mA 订购型号：XVF3500-FB167-C； 丝印：VSM05C  XVF3500 硬件系统最小系统如下图。XVF3500 线形4路麦克风阵列根据音频传输接口的不同，大体分为如下三种硬件框架。用户根据项目需求选择其一，并且以确定硬件上是否需要设计ADC和DAC。\n使用USB连接Host | USB_in\u0026amp;out Host主机的音频传输都通过XVF3500的USB来输入输出，XVF3500作为一个USB Audio声卡设备，产品应用一般为外置的拾音设备。\n其框架如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host播放声音时通过USB声卡播放输出，XVF3500为声卡设备，XVF3500的AEC参考信号在USB音频播放传输过程中获取 XVF3500 USB UAC1.0包含传输音频输入输出、vfctrl_usb和dfu_usb，UAC输入输出的音频格式为16KHz/48KHz\n  使用USB连接Host | Analog_ref XVF3500通过USB输入声音给host主控，Host主控提供模拟AEC参考信号给XVF3500。\n其框架如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host提供播放声音的参考信号给XVF3500做回音消除的参考信号，ADC采集Host端的模拟声音传输给XVF300 XVF3500 USB UAC1.0包含传输音频输入、vfctrl_usb和dfu_usb，UAC输入的音频格式为16KHz/48KHz  使用I2S连接Host| I2S_in\u0026amp;out 该框图不常用，仅推荐XVF3500需要连接WiFi/蓝牙时使用，并且建议Host(无线模组)的I2S需要做I2S slave模式，因为XVF3500需要音频时钟做16KHz的音频算法处理\n其框图如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过I2S接口输入给Host Host提供播放声音的参考信号给XVF3500做回音消除的参考信号，Host通过I2S传输给XVF3500 I2S协议要求16KHz/48KHz 16bit，64fs, 标准I2S，其两路I2S共用时钟线MCLK，BCLK，LRCLK 预留USB接口，方便工程样机的调试和产测。  XVF3500 固件基本框架 ASR 和 Comms 的选择 XVF3500 固件麦克风阵列算法DSP 运行后，可同时提供两路前端处理后的声音信号输出，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。用户根据产品需求，可以选择ASR信号和Comms信号同时输出，或者选择其中一个输出。\nASR\nASR信号主要是用于语音识别，接入类似Alexa等各大语音识别引擎平台，做语音交互使用。ASR信号整体的特征是人声清晰，频谱比较丰满，降噪系数较小，以满足语音高识别率。\nComms\nComms信号主要是用于会议通话使用，类似接入微软的teams, skype和企业微信或者钉钉等会议产品使用。Comms信号整体的特征是底噪比较小，由于降噪系数比较大，其频谱比较干净明显。\nAEC参考信号选择 XVF3500支持立体声(stereo)AEC ,所以需要左声道和右声道的同时输入给XVF3500作为AEC的参考信号。AEC回音消除所需要的参考信号有两种方式提供给XVF3500\n选择 USB UAC 提供AEC参考信号\nUSB UAC作为声卡播放的时候，播放的声音信号经过XVF3500的时候，XVF3500已经copy了参考信号提供给内部AEC算法模块使用。但是，后级的DAC和功放都需要保持线性输出，喇叭播放出的声音不能有EQ处理。如有EQ处理，则喇叭播放出来的声音跟已提供的参考信号已经失去了线性的对比，结果会导致AEC性能发挥不好。\n选择 I2S(ADC)模拟提供AEC参考信号\n需要增加I2S接口接入数字参考信号或者增加ADC接入模拟参考信号提供给XVF3500 AEC算法模块使用。建议在功放前提供左右声道信号提供给ADC。同理，功放后级不能有EQ处理。\n烧录方式的选择 XVF3500芯片需要外置QSPI Flash来存储固件，XVF3500上电读取QSPI Flash的固件后，便不再需要继续读取QSPI Flash的内容，XVF3500可以使用XMOS专用XTAG进行烧录，也可以使用flash 烧录器进行QSPI Flash 芯片烧录XVF3500的factory固件。同时可以通过dfu_usb工具更新dfu固件。根据产线实际情况，进行评估和选择。\n木瓜电子通常会提供3种后缀命名的固件，分别为xxx.xe, xxx_factory.bin和xxx.dfu。这三者中，xxx.xe和xxx_factory.bin都统称为factory固件，xxx.dfu称为更新固件。其中\n xxx.xe固件由XMOS IDE编译生成，仅能通过XTAG调试工具烧录到XVF3500芯片，其烧录时间上，效率很低，调试时可使用 xxx_factory.bin固件由xxx.xe通过XMOS IDE导出，仅能通过spi flash烧录器烧录，效率较高，量产推荐使用 xxx.dfu更新固件由xxx.xe通过XMOS IDE结合QSPI Flash型号信息来导出，仅能通过USB dfu_usb工具进行更新固件。更新固件后，需要重启XVF3500才会正常运作更新后的固件。  使用dfu_usb工具进行更新固件的前提是:XVF3500已经烧录了factory固件，XVF3500能够正常运作，USB能够在操作系统枚举成功， xxx.xe的烧录方式 用户需要拥有XMOS的专用XTAG调试工具，并且下载和安装xTimecomposer IDE。\n运行其Command prompt 工具，确保上电XVF3500硬件和接好XTAG，键入指令如下, Enter键后，查看XVF3500和XTAG是否握手成功\n1  xflash -l   键入类似如下的XTAG指令，Enter键后烧录完毕即可\n1  xflash xxx.xe --spi-spec xx_flash.spec   xxx_factory.bin的烧录方式 建议直接烧录flash芯片，尽量避免PCBA烧录flash芯片。直接烧录flash芯片是最高效，且良率最高。\n用户需要拥有支持QSPI Flash芯片的flash烧录器，在其上位机选择使用QE=1的烧录方式，类似操作参考下图：\n 检测芯片型号或者选择GD25Q16C(其他的QSPI flash芯片也可以,不够需要结合芯片型号导出xxx_factory.bin) 加载xxx_factoy.bin固件 打开配置选项 选择QE=1,后确定 勾选写入配置 开始烧录  固件开发 木瓜电子可以为用户提供factory固件和DFU更新固件，用户采购一些XVF3500样品，可以申请由木瓜电子预烧录factory固件的QSPI flash芯片，在样机阶段，都可以使用DFU进行更新固件。\n如用户需要整个固件源代码，可以在XMOS官网下载，或者发邮件到pxvf3500@pawpaw.hk向木瓜电子申请。提供源代码之后，客户结合文件包内的文档和XMOS官方的文档自行编程，木瓜电子不考虑在XVF3500的代码细节问题上提供技术解答。\n声学要求 XVF3500 线形麦克风阵列的DSP性能跟声学和结构设计有很大关系。在硬件设计前，须提前先了解声学设计的要求。PDM MEMS麦克风有两种拾音孔，分为顶部拾音和底部拾音，这两种麦克风的声学电气特性几乎一致。XVF3500 算法对麦克风电气参数要求不高，通常选择的特性在如下范围左右即可\n Sensitivity: -26 dB FS SNR: 64 dBA AOP: 120 dB SPL  麦克风密封性 密封主要是为了确保麦克风的拾音孔仅在结构外壳的拾音腔孔获取外界的声音，避免声音进入到结构内部来回反射产生较严重的混响。声学设计参考下图\n在硬件设计时，需要提前考虑麦克风的密封性的设计，通常产品是增加密封胶套来实现密封性能，并且在硬件上需要预留密封胶套的位置以吻合产品结构声学需求。\n麦克风避震性 避震主要是为了喇叭播放声音时音腔产生的震动不传导到麦克风板，进而避免影响麦克风的拾音。建议在设计喇叭音腔跟麦克风有足够的距离，并且有绝对的隔绝。\n麦克风声压 麦克风的AOP通常在120 dB左右，如果声音信号超过该值，则会导致麦克风拾音出现截幅，导致声音失真。\nXVF3500的AEC性能做到最高50dB抑制，建议喇叭的声音在麦克风端录音不超过100dB。 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。体现的结果是AEC性能不好\n喇叭和麦克风尽量避免同一朝向，建议形成90度或者180度的朝向\n麦克风一致性 4路麦克风拾音信号需要保持高一致性，在组装结构外壳是，需要统一录制4路麦克风原始信号，进行分析去一致性，重点是体现在幅值和频谱特性。\n4路麦克风信号的一致性要求为整个XVF3500项目的基本要求，阵列麦克风才能发挥其应有的性能\n产线测试 XVF3500导入试产量产阶段,须要确认产线具备QSPI Flash芯片的烧录以及录音测试。建议使用8通道的factoy固件, 确保4个麦克风正常运作,以及做信号一致性分析。\n ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r\n 在确定无硬件问题之后,再使用dfu_usb工具更新最终的1通道或者2通道的dfu固件以实现最终产品。\n ch0:Comms; ch1:ASR\n 产品过认证 XVF3500解决方案能够通过Alexa 的ASR认证和微软的Skype等Comms认证。如产品确定需要过认证, 在产品处于basic版本时, 用户需要有足够熟悉和了解XVF3500 DSP的参数以及阵列的各项知识。根据认证平台商的要求, 在产品调整XVF3500 DSP参数以实现过认证。由于每个产品的声学结构都会影响XVF3500 DSP参数的指示, 所以木瓜电子无法在认证方面提供XVF3500 的DSP 参考值,并且不参与整个产品过认证流程。\n","description":"XVF3500项目导入落地实施步骤，了解硬件设计，固件设计，功能选择，以及量产测试等指引","id":16,"section":"docs","tags":null,"title":"XVF3500项目导入","uri":"https://docs.pawpaw.ltd/docs/pxvf3500-kit/xvf3500_project_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT 已获取到PXVF3000-KIT的资料包 已能够进行使用dfu_usb和vfvtrl_usb工具， 已详细了解XMOS 的XVF3000-3100-DSP-Databrief文档 已详细了XVF3000 内置的前端算法AEC , BF , NS, AGC等  下文将不再对XVF3000-3100-DSP-Databrief里的专业术语进行解释，重点是描述DSP参数的意义和数值的方向\nPXVF3000-KIT DSP 初始参数 PXVF3000-KIT 使用XVF3000-3100-DSP-Databrief的默认参数，可以通过查阅文档和使用vfctrl_usb 可以读取PXVF3000-KIT的DSP参数。且PXVF3000-KIT每次重新上电，所有DSP 参数都重置为初始值\n1  vfctrl_usb HPFONOFF   其重新上电后首次打印输出的内容为初始值,\n1  HPFONOFF:1   其他参数使用vfctrl_usb工具读取方式同理\n查阅文档XVF3000-3100-DSP-Databrief的从page 15开始的参数描述中可以获取初始参数\nDSP 参数写入和认证 使用vfctrl_usb 工具进行写入DSP 参数，如键入指令：\n1  vfctrl_usb HPFONOFF 2   PXVF3000-KIT可以实时更改HPFONOFF参数为2，并且打印输出如下，\n1  HPFONOFF:2   键入指令时需要注意空格的输入，同时查阅XVF3000-3100-DSP-Databrief里HPFONOFF描述的的范围为[0..3] ，其值的类型为INT型(整数型)。\n确认写入完成了后，可以使用audaciy或者其他录音软件实时查看vfctril_usb工具修改DSP参数的效果。同时建议使用系统声卡监听功能进行实时侦听修改效果。使用3.5mm耳机插入PC电脑的耳机孔后，参考下图，进行如下操作，\n 在录音栏项，右键 XMOS VocalFusion Spk(UAC1.0) -\u0026gt; 点击属性 选中侦听此设备 在通过此设备中播放下拉栏中-\u0026gt;选择PC电脑内置的播放声卡 必须使用耳机插入PC的3.5mm耳机口进行侦听，否正会产生啸叫  DSP 参数简单介绍 HP 高通滤波 XVF3000-3100-DSP-Databrief文档描述的高通滤波器仅有一组参数HPFONOFF，其最高值为是180Hz，如将PXVF3000-KIT作为会议设备（Comms输出）使用，建议设置HPFONOFF为3。如作为语音识别（ASR）,该值可以使用初始值\n1  vfctrl_usb HPFONOFF 3   AEC 回音消除 PC电脑将XMOS VocalFusion Spk（UAC 1.0）作为播放设备时，电脑声音播放则通过PXVF3000-KIT Line-out接口（3.5mm耳机孔）播放输出，后级需要接一个有源音箱，并且有源音箱是必须是线性放大，不能存在EQ处理。\nPXVF3000-KIT的AEC ref参考信号则由UAC1.0播放时，经过XVF3000就已经拷贝AEC参考信号提供给XVF3000 的AEC 算法模块。\nAECFREEZEONOFF\n查看到AECFREEZEONOFF的初始值为0，意味着改变有源音箱到PXVF3000-KIT的距离或者路径，XVF3000的AEC性能可以通过少些时间自适应恢复。如产品已经有结构，并且保持了音箱（喇叭）和XVF3000 4路麦克风相对位置没有任何改变，可以设置为1，以确保产品的AEC性能\n1  vfctrl_usb AECFREEZEONOFF 1   AECFREEZEONOFF与AECPATHCHANGE参数有关联，如XVF3000检测到音箱（喇叭）和XVF3000 4路麦克风相对位置已改变，明显出现的现象是AEC性能很差，可以使用vfctrl_usb读出AECPATHCHANGE 为1时，则说明位置已改变。\nACE 其他\n其他参数需要结合产品接口调整，如作为简单测试，则兼容PXVF3000-KIT无需调整其他参数\n需要了解XVF3000的AEC性能最高为50dB抑制，确保喇叭的声压到达PXVF3000-KIT的尽量小于100dBA, 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。\nAGC 自动增益 AGCONOFF为AGC的总开关，初始值为1。使用vfctrl_usb工具能够实时读出AGC的增益值AGCGAIN,同时能够修改实时写入修改AGCGAIN的值。\n1  vfctrl_usb AGCGAIN   1  vfctrl_usb AGCGAIN 100   AGCGAIN的值为实时变化，其主要是围绕着AGCDESIREDLEVEL这个参数。\nAGCDESIREDLEVEL\nAGC重点的调试DSP参数为AGCDESIREDLEVEL，该参数的值决定了ASR / Comms output的整体水平大小，值的选取同时也决定了拾音距离。\n设置AGCDESIREDLEVEL的值为整体ASR / Comms output的信噪比不变，即输出的人声和噪声比例保持线性不变，同时增大，所以建议AGCDESIREDLEVEL不能设置太大，避免引入过大的噪声。\n使用AGCMAXGAIN作为AGC的阈值能够限制AGC无限增大，避免ASR/Comms output的过大，出现截幅和失真。\nNS 噪声抑制 STATNOISEONOFF为稳态噪声抑制开关，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NS 和MIN_NS的调整有效。\nNONSTATNOISEONOFF为非稳态噪声抑制开关，主要是对非规律性或者突如其来的噪声抑制，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NN 和MIN_NN的调整有效。\nGAMMA_NS和GAMMA_NN\nGAMMA_NS和GAMMA_NN这两个参数的值的范围为[0.0 .. 3.0] ，可以理解为评估环境的稳态或者非稳态的噪声量最大值3.0。设置改参数的值，即提供相应比例的噪声量给MIN_NS和MIN_NN设值来实现噪声抑制。\n通常建议参数GAMMA_NS和GAMMA_NN的值不能设置太大，提供过多的噪声量，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nMIN_NS和MIN_NN\nMIN_NS和MIN_NN 可以理解为需要把ASR/Comms output的环境噪声抑制到一个目标底噪，取值范围为[0.0 .. 1.0]，其值越小，则ASR/Comms output的底噪越小。\n该参数受前面参数GAMMA_NS和GAMMA_NN影响，如提供出来的噪声量越多，则MIN_NS和MIN_NN 更容易实现目标值（目标底噪）。\n通常建议参数MIN_NS和MIN_NN的值不能设置太小，过度的噪声抑制，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nASR 参数 DSP参数带有“SR”部分的仅针对ASR信号输出的调试有效，其他基础的参数和Comms信号输出共用。\n","description":"PXVF3000-KIT_dsp_描述，主要介绍XMOS xvf3000芯片内置的圆形麦克风阵列算法及其参数的取值，涉及到如AGC, AEC, Beaforming, NS 等麦克风阵列算法，使用XMOS vfctrol_usb进行调试，","id":17,"section":"docs","tags":null,"title":"PXVF3000-KIT_dsp_描述","uri":"https://docs.pawpaw.ltd/docs/pxvf3000-kit/pxvf3000-kit_dsp_desc/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3500-KIT 已获取到PXVF3500-KIT的资料包 已能够进行使用dfu_usb和vfvtrl_usb工具， 已详细了解XMOS 的XVF3500-DSP-Databrief文档 已详细了XVF3500 内置的前端算法AEC , BF , NS, AGC等  下文将不再对XVF3500-DSP-Databrief里的专业术语进行解释，重点是描述DSP参数的意义和数值的方向\nPXVF3500-KIT DSP 初始参数 PXVF3500-KIT 使用XVF3500-DSP-Databrief的默认参数，可以通过查阅文档和使用vfctrl_usb 可以读取PXVF3500-KIT的DSP参数。且PXVF3500-KIT每次重新上电，所有DSP 参数都重置为初始值\n1  vfctrl_usb HPFONOFF   其重新上电后首次打印输出的内容为初始值,\n1  HPFONOFF:3   其他参数使用vfctrl_usb工具读取方式同理\n查阅文档XVF3500-DSP-Databrief的从page 14开始的参数描述中可以获取初始参数\nDSP 参数写入和认证 使用vfctrl_usb 工具进行写入DSP 参数，如键入指令：\n1  vfctrl_usb HPFONOFF 2   PXVF3500-KIT可以实时更改HPFONOFF参数为3，并且打印输出如下，\n1  HPFONOFF:3   键入指令时需要注意空格的输入，同时查阅XVF3500-DSP-Databrief里HPFONOFF描述的的范围为[0..3] ，其值的类型为INT型(整数型)。\n确认写入完成了后，可以使用audaciy或者其他录音软件实时查看vfctril_usb工具修改DSP参数的效果。同时建议使用系统声卡监听功能进行实时侦听修改效果。使用3.5mm耳机插入PC电脑的耳机孔后，参考下图，进行如下操作，\n 在录音栏项，右键 XMOS VocalFusion St(UAC1.0) -\u0026gt; 点击属性 选中侦听此设备 在通过此设备中播放下拉栏中-\u0026gt;选择PC电脑内置的播放声卡 必须使用耳机插入PC的3.5mm耳机口进行侦听，否正会产生啸叫  DSP 参数简单介绍 HP 高通滤波 XVF3500-DSP-Databrief文档描述的高通滤波器仅有一组参数HPFONOFF，其最高值为是180Hz，如将PXVF3500-KIT作为会议设备（Comms输出）使用，建议设置HPFONOFF为3。如作为语音识别（ASR）,该值可以使用初始值\n1  vfctrl_usb HPFONOFF 3   AEC 回音消除 PC电脑将XMOS VocalFusion St（UAC 1.0）作为播放设备时，电脑声音播放则通过PXVF3500-KIT Line-out接口（3.5mm耳机孔）播放输出，后级需要接一个有源音箱，并且有源音箱是必须是线性放大，不能存在EQ处理。\nPXVF3500-KIT的AEC ref参考信号则由UAC1.0播放时，经过XVF3500就已经拷贝AEC参考信号提供给XVF3500 的AEC 算法模块。\nAECFREEZEONOFF\n查看到AECFREEZEONOFF的初始值为0，意味着改变有源音箱到PXVF3500-KIT的距离或者路径，XVF3500的AEC性能可以通过少些时间自适应恢复。如产品已经有结构，并且保持了音箱（喇叭）和XVF3500 4路麦克风相对位置没有任何改变，可以设置为1，以确保产品的AEC性能\n1  vfctrl_usb AECFREEZEONOFF 1   AECFREEZEONOFF与AECPATHCHANGE参数有关联，如XVF3500检测到音箱（喇叭）和XVF3500 4路麦克风相对位置已改变，明显出现的现象是AEC性能很差，可以使用vfctrl_usb读出AECPATHCHANGE 为1时，则说明位置已改变。\nACE 其他\n其他参数需要结合产品接口调整，如作为简单测试，则兼容PXVF3500-KIT无需调整其他参数\n需要了解XVF3500的AEC性能最高为50dB抑制，确保喇叭的声压到达PXVF3500-KIT的尽量小于100dBA, 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。\nAGC 自动增益 AGCONOFF为AGC的总开关，初始值为1。使用vfctrl_usb工具能够实时读出AGC的增益值AGCGAIN,同时能够修改实时写入修改AGCGAIN的值。\n1  vfctrl_usb AGCGAIN   1  vfctrl_usb AGCGAIN 100   AGCGAIN的值为实时变化，其主要是围绕着AGCDESIREDLEVEL这个参数。\nAGCDESIREDLEVEL\nAGC重点的调试DSP参数为AGCDESIREDLEVEL，该参数的值决定了ASR / Comms output的整体水平大小，值的选取同时也决定了拾音距离。\n设置AGCDESIREDLEVEL的值为整体ASR / Comms output的信噪比不变，即输出的人声和噪声比例保持线性不变，同时增大，所以建议AGCDESIREDLEVEL不能设置太大，避免引入过大的噪声。\n使用AGCMAXGAIN作为AGC的阈值能够限制AGC无限增大，避免ASR/Comms output的过大，出现截幅和失真。\nNS 噪声抑制 STATNOISEONOFF为稳态噪声抑制开关，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NS 和MIN_NS的调整有效。\nNONSTATNOISEONOFF为非稳态噪声抑制开关，主要是对非规律性或者突如其来的噪声抑制，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NN 和MIN_NN的调整有效。\nGAMMA_NS和GAMMA_NN\nGAMMA_NS和GAMMA_NN这两个参数的值的范围为[0.0 .. 3.0] ，可以理解为评估环境的稳态或者非稳态的噪声量最大值3.0。设置改参数的值，即提供相应比例的噪声量给MIN_NS和MIN_NN设值来实现噪声抑制。\n通常建议参数GAMMA_NS和GAMMA_NN的值不能设置太大，提供过多的噪声量，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nMIN_NS和MIN_NN\nMIN_NS和MIN_NN 可以理解为需要把ASR/Comms output的环境噪声抑制到一个目标底噪，取值范围为[0.0 .. 1.0]，其值越小，则ASR/Comms output的底噪越小。\n该参数受前面参数GAMMA_NS和GAMMA_NN影响，如提供出来的噪声量越多，则MIN_NS和MIN_NN 更容易实现目标值（目标底噪）。\n通常建议参数MIN_NS和MIN_NN的值不能设置太小，过度的噪声抑制，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nASR 参数 DSP参数带有“SR”部分的仅针对ASR信号输出的调试有效，其他基础的参数和Comms信号输出共用。\n","description":"PXVF3500-KIT_dsp_描述，主要介绍XMOS xvf3500芯片内置的线型麦克风阵列算法及其参数的取值，涉及到如AGC, AEC, Beaforming, NS 等麦克风阵列算法，使用XMOS vfctrl_usb进行调试，","id":18,"section":"docs","tags":null,"title":"PXVF3500-KIT_dsp_描述","uri":"https://docs.pawpaw.ltd/docs/pxvf3500-kit/pxvf3500-kit_dsp_desc/"},{"content":"概要 P3510-2MIC是针对XMOS的XK-XVF3510-L71 开发板的硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-XVF3510-L71 开发板，所用的DSP芯片为XVF3510.pdf)。XMOS最新更新发布的XVF3510的UA固件完全适用于P3510-2MIC。\nP3510-2MIC为2麦阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nP3510-2MIC内置了立体声回音消除（AEC） , 点噪消除（IC），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入语音产品中。\n版本    产品版本 修改 发布时间     P3510-2MIC V1 初次发布 2020年10月15日    特点   远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB HID 调试\n  2路麦克风阵列\n  支持3.5mm耳机孔作为模拟AEC参考信号\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, stereo, Acoustic Echo Cancellation(AEC)\n· The Automatic Delay Estimation Control (ADEC)\n· Interference Cancellation (IC)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3510 主控，内置2麦阵列算法\n  2路PDM 数字麦克风：MSM261D4030H1AP\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64 dBA\n  供电：USB 5V 或者FPC 端子\n  尺寸：90mmx18mm\n  模拟AEC参考信号输入\n· ADC: AKM AK5720\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入输出，AEC可选使用3.5mm耳机孔模拟输入\n· 采样率：16KHz/48KHz（默认）\n  功耗: 5V, 130mA （Max）\n  硬件概述  XMOS DSP ：XVF3510 主控，集成了UAC1.0和2MIC阵列算法，包含了立体声回音消除（AEC） , 点噪消除（IC），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，调试 ADC AK5720：外接AEC模拟参考信号时，通过I2S传输参考信号给XVF3510(如果AEC 参考信号不是通过USB提供时使用) Flash AT25SF161:存储XVF3510的固件及数据分区 FPC Header: 作为代替了Micro USB端子选项，10Pin，包含了USB引脚，AEC Ref. ，Mute，Reset等。如使用了Micro USB连接操作系统，则无需使用FPC Header  系统连接框图 引脚映射 FPC Header一般使用不上，因为已经有了Micro USB端子和3.5mm耳机输入端子，FPC Header作为高级选项使用，以便代替Micro USB端子和3.5mm耳机端子，以及要用到Mute和RST时使用\nXMOS JTAG一般使用不上，因为用户需要购买拥有XMOS 专用调试工具XTAG3，且在需要深入开发XVF3510内部固件及factocy烧录时使用\n尺寸 应用场合  导航机器人（ASR） 医疗设备（ASR） 健身设备（ASR） 大屏广告机（ASR） 授课直播（Comms） 摄像头麦克风（Comms）  开始 第一个Demo 通常情况下，用户拿到P3510-2MIC PCBA板后，建议先在Windows系统做初步认证。使用Micro USB 数据线来连接P3510-2MIC和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了P3510-2MIC，并且打开声音控制面板进行设置\n在声音界面进行设置和确认\n1、在“播放”栏项，设置电脑自带播放声卡为默认设备（电脑自带的扬声器来播放声音）\n2、在“录制”栏项，右键选择显示禁用的设备，然后右键点击立体声混音，启用后并且再选择设置为默认设备。\n3、双击立体声混音来打开它的属性窗口，或者右键点击“立体声混音”的“属性”进入属性窗口。\n4、在“侦听“栏项，勾选框中勾选侦听此设备\n5，在“通过此设备播放的”的下拉选项中，选择XVF3510（UAC1.0）Adaptive，点击右下角的应用并确认按键即可完成设置。\n如果没有录制-\u0026gt;立体声混音，可以升级一下声卡驱动，在录制栏目，选择显示禁用的设备；右击立体声混音；选择启用\n由于P3510-2MIC没有播放输出的3.5mm耳机孔，需要将操作系统的默认声卡作为播放输出声卡设备\n 其他操作系统如MAC OSX和Linux操作系统用法跟Windows类似，文中引用XMOS文档XVF3510 Dev Kit Quick Start_en.pdf进行说明\n MAC OSX\n Open Audio MIDI setup. Click + symbol to add a new device; select Create MultiOutput Device. Select Built-in Output and XVF3510 device. Select new Multi-Output Device in device list. Click at bottom of window to open Options menu; select Use This Device For Sound Output. Select XVF3510 from Master Device drop-down list. Select Drift Correction for Built-in Output. Close Audio Devices window.  LINUX\n  Install paprefs using package manager.\n  Open paprefs and click Simultaneous Output tab.\n  Select Add virtual output device for simultaneous output on all local sound cards option.\n  Close paprefs.\n  Open Terminal; restart pulseaudio server:\npulseaudio -k   Check for the sink named combined.\npactl list sinks   Set combined output as default output.\necho “set-default-sink combined” | pacmd\r   录制和Demo 使用Audacity（点击下载）录音软件在Windows系统进行录音设置，接着使用Audacity录音。\n如图所示，P3510-2MIC配套默认固件USB 输出为2ch 立体声的 48KHz采样率声音信号，其中：\nch0为ASR输出，属于前端减噪和语音增强的音频输出，提供给语音识别云端引擎进行识别使用；\nch1为Comms输出，属于前端减噪和语音增强的音频输出，为用户进行会议语音通话使用；\n通常windows操作系统中会默认使用ch0声音信号作为系统麦克风声卡，用于ASR语音识别引擎，类似微软的小娜。并且用于P3510-2MIC的ASR声音信号处理需保留极高的人声频谱，以确保语音识别的高识别率。\n固件和升级 如果P3510-2MIC的出厂默认固件满足不了用户的配置需求，可以在Firmware固件列表中选择其他配套的固件，使用配套提供的dfu_usb工具(Device Firmware Update)进行更新固件。\n安装驱动 在Windows系统：\nP3510-2MIC在操作系统中都能免安装驱动并且识别成XVF3510 (UAC1.0) Adaptive作为UAC1.0声卡输入输出，即P3510-2MIC使用USB传输音频时，是不需要安装任何声卡驱动的。如图所示的音频输入和输出-\u0026gt;XVF3510 (UAC1.0) Adaptive的设备枚举。\n如果需要对P3510-2MIC进行DSP参数调整和固件更新时，Windows系统中的设备管理器显示的XMOS Control需要安装驱动，才能使用的dfu_usb工具进行更新P3510-2MIC固件和使用vfcrtl_usb工具进行DSP 参数控制。推荐使用工具zadig（点击下载）对XMOS Control进行USB驱动安装。运行zadig，按照以下步骤进行：\n1、在下拉列表中选择 XMOS Control (Interface 3)\n2、在Driver的第二项，选择lbusb-win2（v1.2.6.0）\n3、单击 Install Driver进行确认安装\nLinux系统：不需要安装XMOS Contorl驱动\nMac 系统：不需要安装XMOS Contorl驱动\n 固件列表 P3510-2MIC配套提供了4个固件，主要是AEC的参考信号提供方式和USB输出音频采样率作为区别，参考下表。\n如配套的固件仍未满足使用，用户可以自行自制固件进行更新。\n   ID Firmware 采样率 Description     1 data_xvf3510_usb_aec_ref_48K_v4_4_0.dfu 48000Hz 出厂默认固件，使用USB输入输出，同时使用USB提供AEC参考信号，音频格式为48KHz采样率   2 data_xvf3510_I2S_aec_ref_48K_v4_4_0.dfu 48000Hz 使用3.5mm耳机孔接入模拟参考信号，或者是FPC的AEC_R和AEC_L的作为参考信号，音频格式为48KHz采样率   3 data_xvf3510_usb_aec_ref_16K_v4_4_0.dfu 16000Hz 使用USB输入输出，同时使用USB提供AEC参考信号，音频格式为16KHz采样率。   4 data_xvf3510_I2S_aec_ref_16K_v4_4_0.dfu 16000Hz 使用3.5mm耳机孔接入模拟参考信号，或者是FPC的AEC_R和AEC_L的作为参考信号，音频格式为16KHz采样率。    DFU升级 使用配套的dfu_usb工具进行固件更新，在Windows系统打开cmd命令行终端工具，cd进入p3510/firmware的绝对路径，键入升级指令且加入所需的data_xxx.dfu固件运行升级，如下：\n1  dfu_usb --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_xvf3510_usb_aec_ref_16K_v4_4_0.dfu   执行完之后，打印出以下信息代表固件DFU升级成功\npoll timeout 0 msec\rHAL: read command: GETSTATE (134), 4 bytes\rwrite upgrade successful\rHAL: reboot\rHAL: write command: REBOOT (5), 0 bytes\r其他操作系统如MAC和Linux为使用Terminal，键入指令和打印的内容一致 深入使用 在现有的固件仍不能满足用户的现有的需求，可以尝试使用在P3510-2MIC配套提供XMOS官方的原始文件夹（XVF3510-UA-Unqualified-Release_4.4.0），进行在线调试和生成用户自值的DFU配置固件（data_xxx.dfu），而这些用户新的需求一般可以列为如下几个分类\n 修改USB枚举信息，如USB 字符串，和USB的VID和PID 修改DSP算法参数，如AGC增益，以更加吻合用户的使用环境，以达到更高的识别率和更远的距离 修改USB输入输出的通道映射，如ch0和ch1都输出ASR信号，AEC的参考信号的提供方式 修改输出音频采样率参数，如修改为16KHz/16bit的音频输出格式  在进行这一部分操作，用户需要认真阅读XMOS的文档资料[XVF3510-User-Guide_4.2]，才能了解XVF3510的寄存器的参数，以便在线调试和生成DFU配置固件。并且下文描述内容跟XMOS提供的文档一致。\n以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值。或者另外参考我司文档P3510-2MIC_调试笔记 , 加深理解\n Acoustic Echo Cancellation (AEC)\nAutomatic Delay Estimation \u0026amp; Control (ADEC)\nInterference Cancellation (IC)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 确保P3510-2MIC的XMOS Control驱动已经安装（仅windows系统需要）\n在windows系统，运行cmd，并且cd进入*/p3510/XVF3510-UA-Unqualified-Release_4.4.0/host/Win32/bin*的绝对路径，键入类似指令，便可进行在线调试。\n键入以下命令，可以设置ch1音频输出为的AGC自动增益为自适应方式。其中vfctrl_usb工具通过USB接口实时对P3510-2MIC进行读写，用户根据自身再需要键入其他具体的命令。\nvfctrl_usb SET_ADAPT_CH1_AGC 1\r验证调试是否实时有效改变，可通过以下命令\nvfctrl_usb GET_ADAPT_CH1_AGC\r打印输出的信息如下：\nGET_ADAPT_CH1_AGC: 1\r更多的在线调试参数用户自行详细查看XMOS的文档资料[XVF3510-User-Guide_4.2]。\n其他操作系统则运行Terminal终端，cd进入对应路径的bin文件夹，并且执行同样的指令便可\n在线调试的参数仅存在XVF310 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 生成DFU自制固件 为了每次断电保存已调试的P3510-2MIC参数，用户需要生成自制的dfu配置固件才能生效。以下描述指引用户如何自行自制dfu固件。\n安装python 3 生成DFU配置固件需要用到python 3工具（推荐v3.7 以上版本，Python 下载连接 http://python.org/downloads.\n在Windows系统上需要自行配置Python的环境变量，运行cmd且键入python已确认是否python已经配置了环境变量。如果没有如下打印，在windows系统的，编辑系统环境变量-\u0026gt;高级-\u0026gt;环境变量-\u0026gt;找到“path”后双击打开-\u0026gt;新建-\u0026gt;复制Python安装路径-\u0026gt;保存确定。\npython\rPython 3.8.5 (tags/v3.8.5:580fbb0, Jul 20 2020, 15:57:54) [MSC v.1924 64 bit (AMD64)] on win32\rType \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information.\r\u0026gt;\u0026gt;\u0026gt;\r生成步骤 在Windows系统上，用户需要根据自行调试P3510-2MIC的参数进行固化时，我们梳理了简易的生成步骤流程，整理出一个批处理文件，及其路径。\nP3510-2MIC_user_define_dfu_upgrade_cmd.bat\r路径：XVF3510-UA Unqualified Release_4.4.0/P3510-2MIC_user_define_dfu_upgrade_cmd.bat\r先在user_define_xvf3510.txt（路径如下）文件编写上在线调试已确定的XVF3510 DSP参数\nXVF3510-UA Unqualified Release_4.4.0/data-partition/input/user_define_xvf3510.txt\r保存user_define_xvf3510.txt后，双击运行P3510-2MIC_user_define_dfu_upgrade_cmd.bat便可直接使用USB成功升级固件, 并且用户自制的固件名称为data_upgade_v440.dfu,其存放的路径为:\nXVF3510-UA Unqualified Release_4.4.0\\host\\Win32\\\r自制固件批处理过程解析\n如下内容如用户需要Linux搭建批处理文件时需要了解, 非必要, 可以不了解。\n先初步了解批处理P3510-2MIC_user_define_dfu_upgrade_cmd.bat的内容如下:\ncd data-partition\rpython xvf3510_data_partition_generator.py user_define_xvf3510.json\rcd ../host/Win32/bin\rdfu_suffix_generator.exe 0x20B1 0x0014 ../../../bin/app_xvf3510_ua_v4_4_0_xe_to_dfu.bin boot.dfu\rdfu_suffix_generator.exe 0x20B1 0x0014 ../../../data-partition/output/data_partition_upgrade_user_define_xvf3510_v4_4_0.bin data_upgade_v440.dfu\rdfu_usb.exe --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_upgade_v440.dfu\rpause\r同时查看user_define_xvf3510.json的内容, 其已指定访问相对路径*”path“：*为*\u0026ldquo;input/user_define_xvf3510.txt\u0026rdquo;*\n路径为：XVF3510-UA-Unqualified-Release_4.4.0/data-partition/user_define_xvf3510.json\r1 2 3 4 5 6 7 8 9 10 11 12  { \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;spispec_path\u0026#34;: \u0026#34;16mbit_12.5mhz_sector_4kb.spispec\u0026#34;, \u0026#34;regular_sector_size\u0026#34;: \u0026#34;4096\u0026#34;, \u0026#34;hardware_build\u0026#34;: \u0026#34;0xFFFFFFFF\u0026#34;, \u0026#34;item_files\u0026#34;: [ { \u0026#34;path\u0026#34;: \u0026#34;input/user_define_xvf3510.txt\u0026#34;, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34; } ] }   即用户在user_define_xvf3510.txt文件中填写在线调试已确认的XVF3510参数或者需要修改的USB描述信息，类似如下,保存并且关闭。\nSET_DEVICE_TO_USB_RATE 16000\rSET_IO_MAP 5 10\rSET_IO_MAP 4 9\r以下是P3510-2MIC_user_define_dfu_upgrade_cmd.bat执行步骤解析说明：\n1 , 运行了如下指令, 便会生成输出文件data_partition_upgrade_user_define_xvf3510_v4_4_0.bin在/output/路径中。\npython xvf3510_data_partition_generator.py user_define_xvf3510.json\r2 , 使用dfu_suffix_generator工具利用上一步骤生成的bin文件进一步生成data_upgade_v440.dfu，这是dfu_usb升级最终需要的自制固件。生成boot.dfu固件同理。\ndfu_suffix_generator工具是把用户固件和设定的USB的VID和PID信息进行交叉校验 其简化（路径）的执行的指令如下，其中 0x20B1 0x0014分别为USB VID和PID。\ndfu_suffix_generator 0x20B1 0x0014 data_partition_upgrade_user_define_xvf3510_v4_4_0.bin data_upgade_v440.dfu\r3 , 利用上述生成的两个固件, 通过dfu_usb工具进行DFU升级固件,\nboot.dfu\rdata_upgade_v440.dfu\r其简化（路径）的运行指令如下，其中 0x20B1 0x0014分别为USB VID和PID。\ndfu_usb --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_upgade_v440.dfu\r在其他操作系统中，可以结合上文提供的Windows提供的批处理文件，制作类似Linux需要的shell脚本。\n资源 P3510-2MIC.zip全部的资料(点击下载)（如链接无效，可向淘宝客服索要）\n支持和商务 P3510-2MIC支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：p3510-2mic@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: boot.dfu和data_xxx.dfu的区别？\nboot.dfu是XVF3510的基础固件，内含DSP算法和控制等基础程序，data_xxx.dfu为配置固件，修改boot.dfu里面的参数。所以在DFU的时候，两个固件都需要添加进去\nQ2: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上P3510-2MIC和windows PC，运行usbdeview，点击Connected栏项以列出XVF3510相关枚举情况；逐一选择XVF3510的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\nQ3：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了P3510-2MIC和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\nQ4：把P3510-2MIC装上产品的结构外壳上，有哪些声学方面需要注意的吗？\n我们建议使用裸板进行使用，这样的性能效果是最佳的，如果确实需要组装到产品结构上，我们建议在麦克风上（顶部拾音）加个密封胶套，以确保声音不进入到结构里面进行不断的反射形成混响。同时我们考虑在下个硬件版本配套提供密封胶套\n","description":"P3510-2MIC 是基于XMOS  XVF3510 DSP 设计的高性能2路麦克风阵列PCBA","id":19,"section":"docs","tags":null,"title":"P3510-2MIC_硬件使用","uri":"https://docs.pawpaw.ltd/docs/p3510-2mic/p3510-2mic_usage/"},{"content":"概要 本文档主要是指引用户在使用P3510-2MIC配套提供的固件不能满足需求时，如何进行自行配置P3510-2MIC的参数（寄存器），如何自行更新自制的固件。\nP3510-2MIC预留了较多的控制和DSP算法参数可供用户进行配置，以实现用户最终需求。这些可以参数都体现在XMOS官方文档XVF3510-User-Guide中，本文档鉴于官方文档，根据木瓜电子内部技术工程师和其他的用户的真实案例，整理调试笔记，提供给用户作为参考借鉴。\n前提  用户需拥有P3510-2MIC评估板，并且根据查阅P3510-2MIC的硬件使用文档能够实现使用Audacity进行录音 用户在windows系统上已经安装了XMOS Control的驱动，XMOS Control设备枚举主要是用来对P3510-2MIC进行指令控制，包含了DSP算法参数调整和XVF3510的固件更新 用户已经获取了P3510-2MIC评估板的资料包，并且已经自行下载安装python 3, 用户生成自制的XVF3510固件需要有python的环境支持。 用户需要明确需求，使用P3510-2MIC评估板是作为语音识别（ASR，Automatic Speech Recognition ）还是会议通话（Comms, communication and conferencing）测试使用，还是两者都需要。  DSP 概念 AEC（Acoustic Echo Cancellation, 回音消除），回音消除的作用主要是消除本设备（类似P3510-2MIC）麦克风拾取到来自远端的声音在本设备扬声器（喇叭）播放出来的声音，即形同于扬声器播放的声音不要再被麦克风设备重新采集。AEC算法过程中需要远端音频声源作为参考信号给到P3510-2MIC设备，才能消除扬声器播放的回声声音，形象理解为需要消除哪些声音，就提供对应声音信号作为参考信号给P3510-2MIC设备。\nVAD (Voice Activity Detection , 人声活动检测)，人声检测的作用是实时判断环境中是否有人声存在。\nIC（Interference Cancellation，干扰源消除），干扰源消除的作用主要是消除环境中固定的位置点发出的干扰声音信号，该信号视为为干扰信号被P3510-2MIC消除。IC算法不需要接入参考信号，但会存在一个收敛时间过程，在干扰源信号的位置和P3510-2MIC的位置相对固定，并且有VAD人声检测后即可实现收敛消除。\nNS (Noise Suppression, 噪声抑制)，噪声抑制的作用主要是抑制抑制来自其频率特性不会随时间瞬时变化的噪声源。其中包括散射的背景噪声和固定噪声源，类似于稳态噪声和非稳态噪声。\nAGC（Automatic Gain Control，自动增益控制），自动增益的作用主要是可以动态调整音频增益，或设定固定增益，使声音保持所需的输出电平。\n工具 vfctrl_usb工具是使用来进行写入和读取P3510-2MIC的DSP参数(寄存器)或者其他控制参数，如XVF3510内置的立体声回音消除（AEC） , 点噪消除（IC），噪声抑制（NS）和自动增益（AGC）算法参数数值，或者设定具体的功能与参数，最终达到所需要的音频效果。\ndfu_usb工具是使用来进行对P3510-2MIC进行固件DFU更新（Device Firmware Update ）,如更新P3510-2MIC的配套固件和用户自制的固件。\n在windows系统上，以上两个工具的使用前提都需要安装XMOS Control的驱动，依托windows系统的cmd工具运行。快捷键WIN+R ,输入cmd ,确认打开cmd界面，使用cd指令进入到vfcrtl_usb工具的存放路径，类似键入指令如下后，进行使用vfctrol_usb工具\ncd /d D:\\XVF3510\\XVF3510-UA Unqualified Release_4.4.0\\host\\Win32\\bin\rDSP算法及声音流框图 参考XMOS官方文档XVF3510-User-Guide可以得到其DSP和声源流框图如下：\n上图所示，PDM MIC，AEC，IC，NS, AGC都是可以通过使用vfctrol_usb工具进行调整其对应的DSP参数的，并且整体XVF3510的DSP算法音频流程如下：\n 两路PDM麦克风音频信号进行输入XVF3510 对采集到的信号传输给回音消除（AEC）来消除扬声器的回声 再经过干扰源消除（IC）对干扰源噪声（如洗衣机，收音机的噪声）进行消除 经过噪声抑制（NS）抑制环境稳态噪声（例如空调声） 通过自动增益（AGC）实现远距离拾音，或者调整声音大小 最终输出两种音频效果，分别为语音识别（ASR）和会议通话（Comms），可选其一。  需要注意的是，在默认的固件下，我们是使用USB立体声音轨中的ch0音轨输出ASR音频效果，使用ch1音轨输出Comms音频效果。在下文的算法调整中，ch0的相关参数代表与ASR输出有关，ch1的相关参数代表与Comms输出有关。如下图\nAGC 算法参数调整示例 P3510-2MIC评估板的AGC对应参数数值的设置直接影响了拾音距离，也是用户较关注的算法板块。其中AGC算法参数说明如下表，初步看评估板可以调整的参数有如下。\nSET_GAIN_CH1_AGC\rSET_ADAPT_CH1_AGC\rSET_LC_ENABLED_CH1_AGC\rSET_MAX_GAIN_CH1_AGC\rSET_UPPER_THRESHOLD_CH1_AGC\rSET_LOWER_THRESHOLD_CH1_AGC\rSET_INCREMENT_GAIN_STEPSIZE_CH1_AGC\rSET_DECREMENT_GAIN_STEPSIZE_CH1_AGC\rP3510-2MIC USB输出的立体声中，其中在ch0输出ASR音频效果，在ch1输出Comms音频效果。在下文的算法调整中，ch0的相关参数代表与ASR输出有关，ch1的相关参数代表与Comms输出有关。 这里以ch1为例，所以调整所列的参数与Comms输出有关。在设定每个AGC参数值前，都是可以使用GET 来代替SET来读出当时的状态值。如想要设定配置AGC最大增益值（SET_MAX_GAIN_CH1_AGC）前，先看下当前状态（GET_MAX_GAIN_CH1_AGC），键入指令如下和打印出获取结果如下。\nvfctrl_usb GET_MAX_GAIN_CH1_AGC\rGET_MAX_GAIN_CH1_AGC: 999.9847\r通过下面分类讲解来阐述上述的列出的8个参数的相互关联关系。\n设定为固定增益\n设定固定增益则代表AGC增益不需要变动，那么关联的参数有，通过SET_ADAPT_CH1_AGC来关闭自适应调整（幅值为0），通过SET_GAIN_CH1_AGC的值来确定所需的增益值。示例如下操作，和得到的录音效果。\nvfctrl_usb SET_ADAPT_CH1_AGC 0\rvfctrl_usb SET_GAIN_CH1_AGC 100\r设定为自适应增益（远距离拾音）\n设定为自适应增益，则代表AGC的增益值时刻在变动，期望最终是输出的音频信号保持平缓，保持声音大小在同一水平上。\n首先需要设定 SET_ADAPT_CH1_AGC 打开自适应调整（幅值为1），并且 SET_GAIN_CH1_AGC 将会失效，无论设置什么值都会被调整。由于是远距离拾音，设定 SET_MAX_GAIN_CH1_AGC 为1000，以确保有足够的增益值。\n然后通过设定 SET_UPPER_THRESHOLD_CH1_AGC 和 SET_LOWER_THRESHOLD_CH1_AGC 音频信号的上限阈值和下限阈值来保持输出期望的声音水平。其中UPPER和LOWER示例如下，在upper和lower 扶着的框内就是用户期望的输出声音信号大小水平（desired level），如果输出的声音不在该框内，则会不断自动调整增益值，使其达到框内的输出水平。\nAGC增益值变动是步进的方式，使其声音大小变化处于渐变的方式。所以XVF3510提供了AGC增益上升和减小的的步进参数。该参数一般情况下建议使用默认值，使声音大小变动是平缓过度的。但是，步进过小，则意味者收敛的时间过长。\nSET_INCREMENT_GAIN_STEPSIZE_CH1_AGC\rSET_DECREMENT_GAIN_STEPSIZE_CH1_AGC\r所以设定为远距离拾音的自适应增益，如下的参数值为提供参考，键入如下指令，与其效果如下。其中需要说明的是： SET_LC_ENABLED_CH1_AGC 需要赋值为1，以确保人声之后的声音底噪保持尽可能小。\nUpper_thereshold的值一定要大于Lower_threshold的值，不建议设置upper过大，使用Lower_threshold来保持声音不小于范围即可, 同时不建议Lower_threshold过大，否则把底噪同样增大。\nvfctrl_usb SET_ADAPT_CH1_AGC 1\rvfctrl_usb SET_LC_ENABLED_CH1_AGC 1\rvfctrl_usb SET_MAX_GAIN_CH1_AGC 1000\rvfctrl_usb SET_UPPER_THRESHOLD_CH1_AGC 0.7\rvfctrl_usb SET_LOWER_THRESHOLD_CH1_AGC 0.4\rvfctrl_usb SET_INCREMENT_GAIN_STEPSIZE_CH1_AGC 2\rvfctrl_usb SET_DECREMENT_GAIN_STEPSIZE_CH1_AGC 0.98\r附参数说明如下表，详细深入的说明，则建议用户查看XVF3510-User-Guide的章节4.4.6（page 55）\n   命令 值 描述说明     SET_ADAPT_CH0_AGC SET_ADAPT_CH1_AGC [0,1] 是否需要打开AGC自适应调整，如没有打开，AGC的值为固定\n0：代表关闭AGC增益值自适应调整\n1：代表打开AGC增益值会自适应调整（默认值）   SET_LC_ENABLED_CH0_AGC SET_LC_ENABLED_CH1_AGC [0,1] 是否需要打开损失控制，主要体现在是否需要丢弃人声之后的底噪\n0：代表关闭(ch0默认值)\n1：代表打开损失控制（ch1默认值）   SET_GAIN_CH0_AGC SET_GAIN_CH1_AGC [0~32767] 设定AGC的增益值，值越大，则输出的声音信号越大，默认值为 500   SET_MAX_GAIN_CH0_AGC SET_MAX_GAIN_CH1_AGC [0~32767] 设定AGC的最大的增益值，要求AGC的值永远不会超过该设定的最大增益值，默认值为 1000   SET_UPPER_THRESHOLD_CH0_AGC SET_UPPER_THRESHOLD_CH1_AGC [0~1] 设定输出声音大小期望水平的上限阈值，满口框为1，默认值为0.6   SET_LOWER_THRESHOLD_CH0_AGC SET_LOWER_THRESHOLD_CH1_AGC [0~1] 设定输出声音大小期望水平的下限阈值，默认值为0.3   SET_INCREMENT_GAIN_STEPSIZE_ CH0_AGC SET_INCREMENT_GAIN_STEPSIZE_ CH1_AGC [0~32767] 设定AGC值在增加时的步进值大小，值越大，则AGC值变大越快。   SET_DECREMENT_GAIN_STEPSIZE_ CH0_AGC SET_INCREMENT_GAIN_STEPSIZE_ CH1_AGC [0~1] 设定AGC值在减小时的步进值大小，值越大，则AGC值变小越快。    为AEC 选择参考信号 ACE算法板块的作用类似等同于防止P3510-2MIC的麦克风再录制到本地扬声器（喇叭）播放的声音，AEC回音消除需要有参考信号（Ref）才能起效果，类似copy一份扬声器的声源给到P3510-2MIC。其效果举例如下\nP3510-2MIC为其AEC算法板块提供所需的参考信号（Ref）有两种方式：\n USB侦听方式：Host(电脑操作系统) 通过USB 输出的方式提供给P3510-2MIC 模拟回采方式：通过模拟回采（copy）喇叭的模拟信号提供给插入P3510-2MIC的3.5mm耳机孔  该两种方式都可以通过vfctrl_usb工具去配置XVF3510的参数实现。在配置之前，\n通过指令先读取现在的音频流的矩阵映射情况，键入指令与查看其打印结果如下：\nvfctrl_usb get_io_map_and_shift\rGET_IO_MAP_AND_SHIFT:\rtarget: USB_FROM_DEVICE_0, source: PIPELINE_OUT_0 output shift: NONE\rtarget: USB_FROM_DEVICE_1, source: PIPELINE_OUT_1 output shift: NONE\rtarget: I2S_FROM_DEVICE_0, source: PIPELINE_OUT_0 output shift: NONE\rtarget: I2S_FROM_DEVICE_1, source: USB_TO_DEVICE_0 output shift: NONE\rtarget: REF_TO_PIPELINE_0, source: USB_TO_DEVICE_0 output shift: NONE\rtarget: REF_TO_PIPELINE_1, source: USB_TO_DEVICE_1 output shift: NONE\r由上的打印情况的最后两行可以得知，USB_TO_DEVICE（电脑USB输出到P3510-2MIC）的声音源，给到REF_TO_PIPELINE（参考信号）作为AEC的参考信号（Ref）。\nUSB侦听方式\nUSB侦听方式，我们也称为通过USB提供AEC的参考信号。其硬件连接仅只有USB线即可，同时需要在windows进行音频声卡设备设置，查看P3510-2MIC的声卡设备设置。\n完成配置之后，即说明电脑自带的声卡播放的声音会copy传递一份到“立体声混音”中，勾选侦听“立体声混音”的声音，通过XVF3510（UAC1.0）Adaptive声卡通过USB输送到P3510-2MIC作为AEC参考信号 P3510-2MIC出厂配套默认固件中已经支持了通过USB侦听方式获取AEC参考信号，支持的固件如下：\ndata_xvf3510_usb_aec_ref_48K_v4_4_0.dfu\rdata_xvf3510_usb_aec_ref_16K_v4_4_0.dfu\r通过vfctrl_usb工具去实现USB提供AEC的参考信号，键入指令如下即可。至于为什么是SET_IO_MAP指令和4，5，7，8这些数字，参考XVF3510-User-Guide的章节Table 4-9 I/O Mapping Destination Indexes（page 42）说明。\nvfctrl_usb SET_IO_MAP 4 7\rvfctrl_usb SET_IO_MAP 5 8\r如果测试的时候，发现AEC回音消除没有效果，确保window系统声卡设备是否设置正确，同时可以通过vfctrl_usb工具键入指令实现查看REF_TO_PIPELINE的声音是否有获取到声音查看（将USB播放的声音又通过USB录制回去），键入的指令和效果如下图。\nvfctrl_usb SET_IO_MAP 0 7\r模拟回采方式\n模拟回采方式，我们也称为通过I2S的方式获取到AEC的参考信号。其硬件连接除了USB线连接电脑，仍需要喇叭信号分出一路通过AUX音频接入到P3510-2MIC的3.5mm耳机孔，这次不需要在windows进行音频声卡设备设置了。\nP3510-2MIC配套固件中已经支持了通过模拟回采方式获取AEC参考信号，支持的固件如下：\ndata_xvf3510_I2S_aec_ref_48K_v4_4_0.dfu\rdata_xvf3510_I2S_aec_ref_16K_v4_4_0.dfu\r通过通过vfctrl_usb工具去实现I2S获取AEC的参考信号\nvfctrl_usb SET_IO_MAP 4 9\rvfctrl_usb SET_IO_MAP 5 10\rASR和Comms输出选择说明 P3510-2MIC在USB立体声音轨中可以同时输出ASR音频效果和Comms音频效果，其中这两者的区别如下。\nASR输出，提供给语音识别云端引擎进行识别使用；ASR音频前端处理主要是为了提高云端语音识别率，所以其处理后，频谱会偏向饱满，这样尽大可能减小了音频失真。同事增强了人声，抑制了背景省和噪声。\nComms输出，提供给用户进行会议语音通话使用；Comms音频前端处理主要是为了提高人声的清晰度，同时做了较大的背景声和噪声抑制，频谱较为干净，相对ASR输出有较大的失真，不建议做语音识别用。\n综上，ASR输出是属于提供给语音识别服务器使用，不需要人体感官去判断，所以整体体现噪声偏大或者背景声偏大，这样的目的主要是为了保留更加完善的频谱信息和减小失真度，以提高语音识别的识别率，所以建议做语音识别用途的话，建议选择ASR输出\n而Comms输出主要是提供用户进行语音会议通话使用，所以需要较为干净的声音频谱和较低的底噪，以提高人声辨识度。所以建议做会议通话使用，建议现在Comms输出。\n如果在会议通话的应用产品中，又同时需要语音识别作为语音转录文字，则ASR输出和Comms输出都需要保留。在P3510-2MIC的USB输出中，默认是在ch0作为ASR输出，ch1作为Comms输出。但是可以通过调整音频流的参数，使其ch0和ch1都输出Comms。\n如下示例为设置ch0和ch1都Comms输出, 打印信息如下说明成功，也表明Comms输出在USB的ch0音轨上。\nvfctrl_usb SET_IO_MAP 0 6\r******* set_io_map USB_FROM_DEVICE_0 PIPELINE_OUT_1 ******\r其测试情况如下图 ,可以看到USB输出的ch0和ch1都为Comms的输出内容。同时键入指令也可以查看到结果。\nvfctrl_usb get_io_map_and_shift\rGET_IO_MAP_AND_SHIFT:\rtarget: USB_FROM_DEVICE_0, source: PIPELINE_OUT_1 output shift: NONE\rtarget: USB_FROM_DEVICE_1, source: PIPELINE_OUT_1 output shift: NONE\rtarget: I2S_FROM_DEVICE_0, source: PIPELINE_OUT_0 output shift: NONE\rtarget: I2S_FROM_DEVICE_1, source: USB_TO_DEVICE_0 output shift: NONE\rtarget: REF_TO_PIPELINE_0, source: USB_TO_DEVICE_0 output shift: NONE\rtarget: REF_TO_PIPELINE_1, source: USB_TO_DEVICE_1 output shift: NONE\r如果需要USB输出的ch0和ch1都为ASR输出，则键入指令为：\nvfctrl_usb SET_IO_MAP 0 5\rvfctrl_usb SET_IO_MAP 1 6\r参考XVF3510-User-Guide的章节Table 4-9 I/O Mapping Destination Indexes（page 42）说明。\n固件DFU更新 需要注意的是，使用vfctrl_usb工具调试的参数输入运行在XVF3510的RAM中，断电不保存，重上电恢复到默认值。如果用户经过vfctrl_usb工具调试到自身满意的参数时，需要通过生成用户自制的固件xx.dfu，进行DFU更新到P3510-2MIC板上，才能重新上电有效，参数已经得以固化了。\n在windows系统上，用户需要确保pyphon 3和XMOS Control驱动已经正确安装了。可以通过，快捷键WIN+R ,输入cmd ,确认打开cmd界面，键入指令，pyphon 3已经正确安装版本的打印结果。\npython\rPython 3.8.5 (tags/v3.8.5:580fbb0, Jul 20 2020, 15:57:54) [MSC v.1924 64 bit (AMD64)] on win32\rType \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information.\r\u0026gt;\u0026gt;\u0026gt;\rP3510-2MIC配套的资料包中的文件XVF3510-UA Unqualified Release_4.4.0有一键操作的DFU更新用户自制的固件的文件P3510-2MIC_user_define_dfu_upgrade_cmd.bat。参考DFU升级和生成DFU自制固件便可完成固件升级。\n","description":"P3510-2MIC 调试麦克风阵列DSP参数示例指引和自制固件DFU更新指引","id":20,"section":"docs","tags":null,"title":"P3510-2MIC_调试笔记","uri":"https://docs.pawpaw.ltd/docs/p3510-2mic/p3510-2mic_debug_note/"},{"content":"概要 PXVF3500-KIT是针对XMOS的XK-VF3500-L33 开发板的硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-VF3500-L33 开发板，所用的DSP芯片为XVF3500。XMOS最新更新发布的XVF3500的固件完全适用于PXVF3500-KIT。\nPXVF3500-KIT为4麦线条型阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nPXVF3500-KIT内置了立体声回音消除（AEC） , 波束程序（BF），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入语音产品中。\n版本    产品版本 修改 发布时间     PXVF3500-KIT v1 初次发布 2018年8月6日    特点   前向180度远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB Control 调试\n  线条型（Linear）4路麦克风阵列\n  支持3.5mm耳机孔作为模拟AEC参考信号\n  支持3.5mm耳机孔作为USB声卡播放\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, stereo, Acoustic Echo Cancellation(AEC)\n· Beamforming(BF)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3500 主控，内置4麦阵列算法\n  4路PDM 数字麦克风： SPH0641LM4H-1\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64 dBA\n  供电：USB 5V\n  尺寸：\n· 86mmx45mm (main board)\n· 110mmx8.2mm (mic board) \u0026amp; 33.3mm 麦克风间距\n  可选模拟AEC参考信号输入\n  · ADC: ES7243\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入，ASR and Comms\n· USB UAC 1.0 输出，可选在UAC playback作为AEC 参选信号，3.5mm耳机孔模拟输出\n· 采样率：16KHz/48KHz（默认）\n  功耗: 5V, 260mA （Max）\n  硬件概述  XMOS XVF3500 ：集成了UAC1.0和4 麦阵列算法，包含了立体声回音消除（Steroe AEC） , 波束成形（BF），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 QSPI Flash：存储XVF3500固件 DAC ES7154：USB 声卡（UAC1）音频输出解码芯片 ADC ES7243：选择模拟信号作为AEC参考信号时，转I2S数字信号给XVF3500(可选项) XMOS XTAG：XMOS专用调试工具XA-XTAG接口 Line-out Phone-jack：DAC的芯片的line-out 3.5mm耳机孔 LIne-in Phone-jack：ADC芯片的Line-in 3.5mm耳机孔 MIC0~4：PDM 数字麦克风，线条型等距（33.3mm）分布 FPC interface: 通过FPC线把XVF3500的4路麦克风扩展出一个独立麦板 Buffer logic IC: PDM 麦克风data和CLK pin驱动能力加强和MUTE控制  系统连接框图 尺寸 应用场合  视频通话（Comms） 机顶盒（ASR） Soundbar（ASR） 智能电视（ASR）  开始 第一个Demo 通常情况下，用户拿到PXVF3500-KIT PCBA板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXVF3500-KIT和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXVF3500-KIT，并且打开声音控制面板进行设置\n确认设备管理器-\u0026gt;音频输入和输出是否存在\nXMOS VoclalFusion St(uac1.0)是否成功枚举，PXVF3500-KIT作为USB Audio Class 1.0设备\n关于XMOS Control可以在后面需要调试时在安装驱动，初次使用时可以先跳过 在声音界面进行设置和确认\n1，在播放栏项，设置XMOS VoclalFusion St(UAC1.0)为默认设备\n2，在录制栏项，设置XMOS VoclalFusion St(UAC1.0)为默认设备\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nDemo 和录音 使用Audacity第三方开源录音软件在Windows系统进行录音设置，运行Audacity进行录音。\nPXVF3500-KIT出厂默认固件为USB输入8ch 16kHz采样率处理后的声源，其中ch0为Comms信号，ch1为ASR信号ch[2-5]为mic[0-3] 麦克风的原始信号，ch[6-7]为回音消除的立体声参考信号。\n在通常的操作系统中，系统都会默认使用ch0作为ASR或者Comms来当作麦克风输入，所以PXVF3500-KIT输入8ch并不会影响实际上的使用。 在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n固件和DFU升级 如果PXVF3500-KIT的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n安装驱动 Windows系统：\nPXVF3500-KIT在操作系统中都能识别成XMOS VoclalFusion St(uac1.0)作为声卡输入输出，而Windows系统中的设备管理器显示的XMOS Control需要安装USB驱动，才能使用XMOS提供的dfu_usb工具进行升级和使用vfcrtol_usb工具进行DSP 参数控制。推荐使用第三方工具zadig进行安装XMOS Control的USB驱动。\n运行zadig，\n 在列表中选择 XMOS Control (Interface 3) 然后选择 libusb-win32 点击 Reinstall Driver 安装完成了后，则会出现类似如下图片显示  Linux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n固件列表 这里配套提供了7个固件，主要是USB的音频的通道数，算法方向和采样率作为区别，参考下表。\n   Firmware ch0 ch1 采样率 Description     app_vf_stereo_base_usb_1i1o2.dfu Comms - 16000Hz Comms output   app_vf_stereo_base_usb_1i1o2_asr.dfu ASR - 16000Hz ASR output   app_vf_stereo_base_usb_1i1o2_48k.dfu ASR - 48000Hz 48kHz Comms output   app_vf_stereo_base_usb_1i2o2.dfu Comms ASR 16000Hz ch0:ASR; ch1:Comms   app_vf_stereo_base_usb_1i2o2_48k.dfu Comms ASR 48000Hz ch0:ASR; ch1:Comms   app_vf_stereo_base_usb_1i8o2.dfu Comms ASR 16000Hz default firmware ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r   app_vf_stereo_base_usb_1i8o2_analog_ref.dfu ASR ASR 16000Hz ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r    DFU升级 Windows系统：\nPXVF3500-KIT的使用USB进行DFU升级的工具为dfu_usb.exe，打开cmd命令行终端工具，cd进入pvf3500/xvf3500_dfu文件夹，键入如下指令或者或者复制其中对于固件的指令进行运行。\ndfu_usb write_upgrade ../firmware/app_vf_stereo_base_usb_1i1o2.dfu\r执行完之后，打印出一下信息说明固件DFU升级成功\n Attempting to connect via USB: connected\rSending file size: 0x38800 padded to 0x38800\rWritten bytes: 0x38800\rdone\r其他操作系统如Mac OS和Linux的使用Terminal，键入指令和打印的内容一致。DFU升级成功后，需要对板子重启或者重新上电\ndfu_usb reboot\r在通常情况下，在windows系统DFU升级成功后，PXVF3500-KIT会遇到无法录制使用，问题可以在[FAQ](# FAQ):Q1找到答案 DSP control 在线调试 上文提供的所有固件都是使用XMOS Vocal Fusion默认的DSP参数，其实PXVF3500-KIT也支持在线调试麦克风阵列DSP 算法参数。使用DSP Control工具为vfctrol_usb（exe）。在进行在线调试工作前，建议用户认真阅读XMOS的文档资料[XVF3500 DSP Databrief.pdf](pxvf3500/doc/XVF3500 DSP Databrief.pdf)。足够了解麦克风阵列相关算法名称和DSP 参数，才方便进行在线调试。并且下文描述内容跟XMOS提供的文档一致。\n以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值\nAcoustic Echo Cancellation (AEC)\nBeamforming(BF)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 windows系统\n确保PXVF3500-KIT在设备管理器中的XMOS Control驱动已经安装（仅windows系统需要）\nwindows系统，运行cmd，并且cd进入pxvf3500/xvf3500_control，键入类似指令以运行vfctrol_usb，便可进行在线调试\nvfctrl_usb MIN_NS\r打印输出的信息如下：\nMIN_NS:0.15\r其他操作操作系统运行Terminal终端，但是同时需要提前编译出vfctrol_usb工具，进行同样的操作即可。cd进入路径pxvf3500/xvf3500_control/host/control。\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rXVF3500里面有很多DSP参数可配置，用户根据[XVF3500_DSP_Databrief.pdf](pxvf3500/doc/XVF3500 DSP Databrief.pdf )\n的介绍，可以实现通过USB HID（XMOS Control）进行在线调试参数\n在线调试的参数仅存在XVF3500 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 资源下载 PXVF3500-KIT.zip全部的资料(点击下载)\n支持和商务 PXVF3500-KIT支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：pxvf3500@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上PXVF3500-KIT和windows PC，运行usbdeview，点击Connected栏项以列出XVF3500相关枚举情况；逐一选择XVF3500的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\nQ2：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了PXVF3500-KIT和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\n","description":"PXVF3500-KIT_硬件使用","id":21,"section":"docs","tags":null,"title":"PXVF3500-KIT_硬件使用","uri":"https://docs.pawpaw.ltd/docs/pxvf3500-kit/pxvf3500-kit_usage/"},{"content":"本子系统(docs.pawpaw.ltd)是木瓜电子(www.pawpaw.cn)的文档系统网址的补充，为协助用户对木瓜电子开发的开发板评估板的快速使用而生\n关于我们 深圳市木瓜电子科技有限公司（“木瓜电子”）是一家专注于提供音频技术和音频芯片供应服务的芯片代理商和音频方案商。\n木瓜电子(www.pawpaw.cn)是XMOS的代理商和技术提供商，于2015年，经过多方资源整合打造国内最专业的XMOS技术支持团队，拥有国内最专业的XMOS技术人才，英国XMOS原厂授权麦克风阵列产品线国内唯一的合作伙伴。\n关于XMOS XMOS(www.xmos.ai)是音频领域芯片供应的领导者，专注提供音频接口(USB AUDIO)和音频DSP算法，目前已经成熟向市场提供了XVF3000和XVF3500 4路麦克风阵列，以及XVF3510 2路麦克风阵列完整解决方案，应用语音识别和会议通话等产品中。\n在XMOS网址找到木瓜电子 XMOS网站链接如下可以找到木瓜电子网站入库：https://www.xmos.ai/design-support\n","description":"深圳市木瓜电子科技有限公司的文档系统 docs.pawpaw.ltd的使用说明和主网站的区分","id":22,"section":"about","tags":null,"title":"公司介绍","uri":"https://docs.pawpaw.ltd/about/about_us/"},{"content":"深圳市木瓜电子科技有限公司\n地址：深圳市福田区车公庙天安创新科技广场一期B座507B\n通讯号码     号码 类型     座机 0755-83249131 USB AUDIO, 麦克风阵列    0755-83972095 USB AUDIO, 麦克风阵列   手机 13714668010 USB AUDIO, 麦克风阵列，离线语音    15013658786 USB AUDIO, 麦克风阵列    商务邮箱      类型     邮箱 sales@pawpaw.hk USB AUDIO, 麦克风阵列，离线语音，芯片    ","description":"PCBA定制商务合作，芯片供应商务合作，供应商商务合作","id":23,"section":"about","tags":null,"title":"商务合作","uri":"https://docs.pawpaw.ltd/about/business/"},{"content":"深圳市木瓜电子科技有限公司\n地址：深圳市福田区车公庙天安创新科技广场一期B座507B\n技术支持号码     号码 类型     座机 0755-83996485 USB Audio ,XMOS , Savetech   座机 0755-82815115 麦克风阵列，离线语音    技术支持邮箱      类型     邮箱 support@pawpaw.hk USB AUDIO, 麦克风阵列，离线语音，芯片    ","description":"","id":24,"section":"about","tags":null,"title":"技术支持","uri":"https://docs.pawpaw.ltd/about/support/"},{"content":"工具和软件 以下工具均为第三方的免费工具，木瓜电子不对这些工具软件有任何商业行为    工具名 描述 下载     Audacity Audacity是一款开源免费录音播放工具软件，用于测试音频使用，能够实现多通道录音和播放 audacity-win-2.4.2.zip   usbdeview Usbdeview是一款免费的查看windows操作系统的USB设备枚举信息的工具软件 usbdeview.zip   Zadig zadig是是一款安装windows USB 驱动免费工具软件 zadig-2.5.zip    评估板资料包 每个评估板对应的资料在硬件使用说明都能下载\n   评估板/开发板 描述 下载     P3510-2MIC XMOS XVF3510 DSP 主控芯片，开源 , 内置麦阵算法 p3510.zip   PXVF3500-KIT XMOS XVF3500 DSP 主控芯片，开源 , 内置麦阵算法 pxvf3500.zip   PXVF3000-KIT XMOS XVF3000 DSP 主控芯片，开源 , 内置麦阵算法 pxvf3000.zip   PXUA216MB-DL2 USB 16路数字麦克风采集，不开源，无内置麦阵算法 pxua216mb.zip   PXUA08QF48 USB Audio 多功能评估，开源 pxua08qf48.zip   US516P6-KIT 云知声离线语音控制方案，定制，内置语音识别算法 us516p6.zip    ","description":"PXVF3000-KIT, P3510-2MIC, P3500-KIT ,PXUA216MB-DL2-M等工具（windows系统）下载","id":25,"section":"download","tags":null,"title":"评估板资料下载页","uri":"https://docs.pawpaw.ltd/download/tool_and_app_download/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了pxvf3500-KIT，且查阅pxvf3500-KIT_硬件使用 已详细了解XVF3500 内置的前端算法AEC , BF , NS, AGC,，且已查阅pxvf3500-KIT_dsp_描述 已查阅本站XVF3500项目实施落地 已查阅了XVF3500的datasheet和参考设计 已确认XMOS XVF3500 4路麦克风阵列方案性能可满足导入项目产品中  XVF3500 datasheet 导读 查看XVF3500-FB167-Datasheet_1.2.pdf，其描述的为XVF3500裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（0 °C to 70 °C） FBGA 167 封装 685mA典型工作电流，1W左右（固件运行） I/O 驱动能力为4mA 订购型号：XVF3500-FB167-C； 丝印：VSM05C  电源 根据datasheet的最小系统框图，XVF3500的需要两路电压供应，3V3和1V0, 其中3V3提供给I/O, USB , Flash等外设使用，1V0提供给XVF3500逻辑核心使用。\n其两路电压时序要求为3V3先上电，稳定后，1V0后上电。\n复位检测 XVF3500需要外部有复位检测芯片，可以选择单独侦测 3V3或者1V0，以避免在电压不正常时，芯片无法复位来运行固件。\nQSPI Flash XVF3500需要外置QSPI Flash（类似GD25Q16或者IS25LP016D），其主要是存储XVF3500固件，所以XVF3500项目得预先烧录固件才能启动运行4路麦克风阵列算法。\n使用QSPI Flash烧录器烧录XVF3500需要配置QE=1的烧录方式。\nBOOT MODE XVF3500的需要读取QSPI Flash芯片程序来启动，根据框图连接XVF3500和Flash时，需要确保QSPI_CS引脚上拉1K电阻，以实现boot mode是由XVF3500芯片读取加载内部的QSPI Flash固件。\nI/O 映射 XVF3500的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子或者XMOS官方提供的的原理来选择使用特定的I/O map。\n时钟信号 XVF3500外部需要24MHz有源晶振接入作为启动晶振，接入到CLK 引脚，而音频时钟16KHz 和48KHz采样率仍需要一个外部的12.2888MHz音频时钟或者晶体接入作为I2S或者PDM麦克风的MCLK时钟使用。\n原理图和PCB 根据我司或者XMOS官方的提供的参考原理，结合XVF3500的datasheet最小系统。用户可以比较轻易完成XVF3500的最小系统设计，包含了电源，时钟，启动上拉等。\n原理图设计 USB 接口设计 在XVF3500 条形4路麦克风阵列方案中，USB接口除了提供5V电源供应，USB接口仍需要用来作为音频传输，DFU固件，vfctrl调试参数。\nXVF3500 芯片内部集成了USB PHY收发器，可以直接使用芯片引脚USB_DM,USB_DP,USB_VBUS,USB_RTUNE连接外部USB端子。\n遵循XVF3500 datasheet说明，USB的设计分为USB供电或者外部电源作为XVF3500芯片供电两种情况，如图为USB作为整个XVF3500系统供电原理设计\n根据XVF3500 datasheet的描述\n USB_RTUNE 需要下拉43.2 R电阻 USB_VBUS 不能连接，需悬空 USB_VBUS提供5V给DC-DC 转换3V3和1V0电源提供给XVF3500和外围芯片 因为XVF3500 的ESD压力为2KV,建议用户在USB端子设计加入ESD保护电路芯片  如内部有电池或者外部供应5V给整个电源系统，则USB_VBUS的设计需要参考XVF3500 datasheet（page 19）的USB_VBUS设计。\n The 10k series resistor and 0.1uF capacitor ensure than any input transient is filtered and does not reach the device. The 47k resistor to ground is a bleeder resistor to discharge the input capacitor when VBus is not present. The 1-10uF input capacitor is required as part of the USB specification. A typical value would be 2.2uF to ensure the 1uF minimum requirement is met even under voltage bias conditions\n 如用户决定使用XVF3500使用I2S输入输出来连接host主控（ARM,BT,WiFi等芯片）代替USB作为音频传输，同时强烈建议前期保留USB端子以便进行dfu_usb和vfctrl_usb使用。后期确定量产时再去掉USB部分。\n电源设计 XVF3500 内部无DC-DC和LDO集成，需要外部提供3V3和1V0的供电。其中3V3提供给XVF3500及其集成的部分的 I/O供电，1V0供应XVF3500核心及其集成组件的核心使用。查看datasheet的5 Example Application Diagram的框图，得到XVF3500电源的需求情况。\n3V3 供应部分\n3V3电压范围（3.135 ~ 3.465 V）\n VDDIO (3V3) : Digital I/O power OTP_VCC (3V3) :pins for OTP USB_VDD33 (3V3) : USB Analog power,analog supply to the USB-PHY  1V0 供应部分\n1V0电压范围（0.95 ~ 1.05 V）\n VDD pins (1V0)：Digital tile power ，for the core logic PLL_AVDD (1V0) : Analog power for PLL, pins for the PLL USB_VDD (1V0) : USB Digital tile power , supply to the USB-CORE  查看datasheet的Power Consumption 部分得到XVF3500的核心供电需求电流为600 mA左右（700mA MAX）, 确保DC-DC电源芯片1V0输出需要大于700mA，建议值1A的输出能力,且不能使用LDO电源芯片输出1v0,导致损耗过大。\n根据datasheet所述的3V3和1V0的上电时序要求，我们建议整体电源设计的时序为3V3先上电，然后使能（enable）1v0后上电\n其电源设计如下图，其中\n 3V3由5V DC-DC转换得到，3V3先稳定后，使能另一个DC-DC转换得到1V0 ; 形成 3V3先上电，1V0后上电的时序 3V3和1V0分别供应相应的电源输入引脚，尽量保证每个电源输入引脚有个104的滤波电容，且这些电容在layout的时候，尽量靠近相应的电源引脚。 pin 50 和 pin 65 必须悬空，不能接任何电气 PLL_AVDD 需要一个高品质的电源，在PLL_AVDD引脚加入RC 低通滤波器，且在layout的时候，4R7电阻和104电容需要尽可能靠近PLL_AVDD引脚  系统设置 XVF3500外围需要两个有源晶振，24 MHz 和 12.288 MHz：\n 24 MHz时钟为XVF3500起振时钟，提供给内部PLL产生芯片主频，24 MHz有源晶振输出接入XVF3500的CLK 引脚。 12.288 MHz时钟为XVF3500核心（Tile 1 和Tile 2）处理音频传输协议需要的音频时钟，XVF3500核心将12.288 MHz进行分频，分别生成I2S 的 LRCLK , BCLK 和 PDM 协议的CLK。 所以12.288 MHz需要分出多路时钟出来，作为MCLK分别输入到XVF3500 Tile 1 ,Tile 2 和ADC/DAC使用。  XTAG接口为XMOS专用的调试和烧录工具，XVF3500需要下使用XTAG烧录factoy固件到外置的QSPI Flash芯片了后，XVF3500才能正常运行麦克风阵列算法，在原理设计时，需要引出XTAG接口，以便样机时调试和烧录XVF3500固件。\nXVF3500外部需要有个复位检测芯片，避免供电电压不正常时导致固件运行紊乱，根据datasheet的描述，其复位时间必须为1ms~10ms之间的拉低时间\n If your design is powered by VBUS,then RST_N should go high within 10 ms of attaching to VBUS in order to ensure that USB timings are met. RST_N should be at least 1 ms after VDDIO good to enable the built-in flash to settle.\n 由于XVF3500的级联特殊要求（XMOS的芯片的Tile2与Til1 级联，共同访问外部QSPI Flash芯片），XVF3500的X2D06必须上拉电阻，\n其整体设计为, 其中：\n XTAG 建议接一个2x5 1.27mm的母座端子引出，方便烧录和调试,且脚位排序不变 QSPI_CS_N需要上拉1K电阻, 确保XVF3500上电时能够访问外部的QSPI Flash 12.288 MHz有源晶振时钟分出3路时钟，分别提供Tile 0，Tile 1和Codec作为MCLK使用，如果PCBA板子布线较长，建议加个buffer logic器件加以增大驱动能力  音频I/O XVF3500 支持多路PDM麦克风，但是XMOS官方vocal Fusion算法仅支持4路麦克风阵列算法。多路PDM麦克风接口复用1个clk 时钟信号线，以确保多路麦克风信号高一致性。多路麦克风data信号线各自独立，不分L/R时序。\nXVF3500 支持2路I2S 接口，其I2S协议为标准I2S, 64fs, 有效位可以实现16bit/24bit。 如果I2S连接ADC或者DAC, 则XVF3500 的I2S为master模式 ; 如果XVF3500 连接蓝牙/wifi/CPU, 则XVF3500都可以选择master/slave模式。两路I2S都复用MCLK , LRCLK , BCLK。\n其中XVF3500的音频接口PDM和I2S的时钟频率为：\nPDM_CLK: 3.072 MHz\nI2S_MCLK: 12.288 MHz\nI2S_BCLK: 1.024 MHz(@16KHz sample rate) I2s_LRCLK: 16 KHz(@16KHz sample rate)\nXVF3500的DAC和ADC选型设计，根据用户项目框架的需要，参考本站XVF3500项目实施落地的应用框架而确定是否都需要ADC和DAC的设计。可以简单理解为：\n 需要XVF3500作为UAC设备播放声音，则需要加上DAC 需要接模拟信号作为XVF3500作为AEC参考信号，则需要加上ADC  选择相应的DAC和ADC需要吻合XVF3500的I2S时序，且尽量免I2C配置，为I2S自适应的Codec，避免XVF3500固件有过多的I2C配置造成软件工程师过多投入。\n其整体设计如下图，其中:\n  X2D06(pin N13)为上章提到的XVF3500所需的上拉，在下图体现出来。\n  每个所用到的I/O都是XVF3500软件定义，由于需要配合现成的固件，所以I/O不建议更换\n  4个PDM 麦克风的LR 引脚都需要统一拉低接地。如成本允许，单独生成3V3A干净电源提供给麦克风供电。\n  pxvf3500-KIT评估板麦克风布局为33.3mm的条线均匀分布，如需其他条形尺寸，麦克风的间距不小于30 mm,其最大间距由TTL受干扰限制，不建议太大，XVF3500 I/O驱动能力仅为4mA。如更改了麦克风的间距尺寸，需要通知固件方修改软件以匹配阵型\n  用户根据项目框架需要是否DAC\n  用户根据项目框架需要是否ADC，并且建议模拟参考信号（analog AEC ref）在播放的运放前端接入，同时建议设计分压电路，查看ADC的满框输入水平（Full Scale Input Level ）,以确定模拟信号进行分压时，匹配相应的电阻值\n  用户尽量选择免I2C配置的ADC和DAC，选择I2S自适应的Codec，则不需要通知固件方进行I2C配置来吻合XVF3500的I2S协议和驱动Codec\n  控制I/O XVF3500固件内部仍有小些逻辑控制资源，可以实现控制LED，按键等功能。LED的控制主要VAD(人声检测)指示使用。\n按键控制建议仅用在麦克风的静音（MUTE信号）。如功能上需要用到麦克风静音功能，建议在4路PDM复用的CLK引脚加上逻辑器件，实现电气上的静音。\n其整体设计如下图，其中：\n  补充MCLK_Tile 1 接入到X1D10, XVF3500 Til0 运行16 KHz的麦克风阵列算法，需要外部提供音频时钟信号。\n  LED为VAD（人声检测）指示使用，如不需要LED指示，可全部去掉\n  MIC_CLK拉高拉低都可以实现麦克风信号静音（MUTE）,这里建议用户增加逻辑logic器件来实现物理上MUTE。不建议在XVF3500固件来时间音量+，音量—，会涉及投入比较大的固件开发。如需要，建议直接控制运放。\n  检查表 Check List 框架检查  USB 需要做保留设计，无论是是否有使用I2S作为音频传输，USB的dfu_usb和vfctrl_usb仍需要使用 XVF3500的XTAG设计建议使用2x5母座端子，间距1.27mm；或者2x10的2.54mm的母端子，避免留出测试点接线麻烦的方式。木瓜电子可提供转接板，同时用户需要购买XTAG烧录器 XVF3500需要置了QSPI Flash，样机或者量产前，需提前烧录XVF3500的固件到QSPI Flash芯片上，同时确保使用QSPI flash烧录方式QE=1的配置烧录。要求用户需要拥有flash烧录器，类似硕飞的SP8-B等设备。 确认好AEC ref的提供给XVF3500的方式，以便确认是否ADC和DAC  原理图和PCB检查  查阅XVF35000的datasheet的Check list(page 74) 查阅XVF35000的VocalFusion Speaker Hardware Manual.pdf 复位芯片是必须要的，可以选择侦测3V3和1V0 麦克风layout布局，建议每个麦克风间距不小于30mm Layout时，USB型号尽量并行走线且不靠近I2S/PDM的时钟线 Layout时，需要考虑量产时，麦克风需要加上密封胶套来配合结构外壳，达到声学要求  PCBA问题排查 USB不能正常枚举出声卡设备\n 确认硬件的电源3V3和1V0是否正常; 确认24 MHz时钟正常进入XVF3500; 确认复位检查芯片是否拉住了XVF3500的复位 确认XVF3500是否已有固件；确认使用QSPI Flash烧录器烧录固件时，配置QE=1，并且烧录时已把配置烧录进去。XVF3500已烧录固件时，板载5V电源会在大于150mA  判断麦克风是否良好\n 烧录或者dfu_usb一个8通道固件，把4个麦克风原始信号在audactiy录制查看，或者使用AP分析  AEC 性能不好\n 如是模拟参考信号到ADC提供给XVF3500的方式，确认ADC接收到的模拟参考信号是否正常，是否有作为分压输入水平不超过ADC的满框输入水平 如是USB提供参考信号给XVF3500的方式，确保DAC或者功放不能有EQ处理再喇叭播放。 确认整个过程中喇叭和麦克风的相对位置没有任何变动 确认喇叭到麦克风声压不大于100dB 确认麦克风有足够好的密封性  服务 XVF3500的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计（pxvf3500-KIT 评估板），XVF3500 datasheet和VocalFusion Speaker Hardware Manual文档完成设计。\n木瓜电子可以为用户提供XVF3500 固件，整体设计如有技术问题，可以发邮件发pxvf3500@pawpaw.hk咨询。\n木瓜电子可以提供XMOS XVF3500 , 麦克风和Code芯片供应服务。\n","description":"介绍XMOS  vocal Fusion麦克风阵列的XVF3500硬件设计，涉及到sch和PCB方面的内容，包含XVF3500最小系统，AEC的ADC，DAC设计，4路麦克风阵列摆放，以及麦克风阵列量产指导","id":26,"section":"docs","tags":null,"title":"XVF3500硬件设计","uri":"https://docs.pawpaw.ltd/docs/pxvf3500-kit/xvf3500_hw_deseign/"}]